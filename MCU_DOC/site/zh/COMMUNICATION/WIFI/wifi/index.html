<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Shuaiwen Cui"><link href=https://shuaiwen-cui.github.io/ESP_STUDY/zh/COMMUNICATION/WIFI/wifi/ rel=canonical><link href=../../BLUETOOTH/bluetooth/ rel=prev><link href=../../MQTT/mqtt/ rel=next><link rel=alternate type=application/rss+xml title="RSS 订阅" href=../../../../feed_rss_created.xml><link rel=alternate type=application/rss+xml title="已更新内容的 RSS 订阅" href=../../../../feed_rss_updated.xml><link rel=icon href=../../../../static/images/logo.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.45"><title>WIFI - ESP_STUDY</title><link rel=stylesheet href=../../../../assets/stylesheets/main.0253249f.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.06af60db.min.css><style>.md-tag.md-tag--default-tag{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 80v149.5c0 17 6.7 33.3 18.7 45.3l176 176c25 25 65.5 25 90.5 0l133.5-133.5c25-25 25-65.5 0-90.5l-176-176c-12-12-28.3-18.7-45.3-18.7L48 32C21.5 32 0 53.5 0 80m112 32a32 32 0 1 1 0 64 32 32 0 1 1 0-64"/></svg>');}.md-tag.md-tag--hardware-tag{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M176 24c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c-35.3 0-64 28.7-64 64H24c-13.3 0-24 10.7-24 24s10.7 24 24 24h40v56H24c-13.3 0-24 10.7-24 24s10.7 24 24 24h40v56H24c-13.3 0-24 10.7-24 24s10.7 24 24 24h40c0 35.3 28.7 64 64 64v40c0 13.3 10.7 24 24 24s24-10.7 24-24v-40h56v40c0 13.3 10.7 24 24 24s24-10.7 24-24v-40h56v40c0 13.3 10.7 24 24 24s24-10.7 24-24v-40c35.3 0 64-28.7 64-64h40c13.3 0 24-10.7 24-24s-10.7-24-24-24h-40v-56h40c13.3 0 24-10.7 24-24s-10.7-24-24-24h-40v-56h40c13.3 0 24-10.7 24-24s-10.7-24-24-24h-40c0-35.3-28.7-64-64-64V24c0-13.3-10.7-24-24-24s-24 10.7-24 24v40h-56V24c0-13.3-10.7-24-24-24s-24 10.7-24 24v40h-56zm-16 104h192c17.7 0 32 14.3 32 32v192c0 17.7-14.3 32-32 32H160c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32m192 32H160v192h192z"/></svg>');}.md-tag.md-tag--software-tag{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 96c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256h-64V96H128v256H64zM0 403.2C0 392.6 8.6 384 19.2 384h601.6c10.6 0 19.2 8.6 19.2 19.2 0 42.4-34.4 76.8-76.8 76.8H76.8C34.4 480 0 445.6 0 403.2M281 209l-31 31 31 31c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-48-48c-9.4-9.4-9.4-24.6 0-33.9l48-48c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9zm112-34 48 48c9.4 9.4 9.4 24.6 0 33.9l-48 48c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l31-31-31-31c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0z"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#wifi class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../../ title=ESP_STUDY class="md-header__button md-logo" aria-label=ESP_STUDY data-md-component=logo> <img src=../../../../static/images/mainboard.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ESP_STUDY </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> WIFI </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__option> <div class=md-select> <button class="md-header__button md-icon" aria-label=选择当前语言> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg> </button> <div class=md-select__inner> <ul class=md-select__list> <li class=md-select__item> <a href=../../../../COMMUNICATION/WIFI/wifi/ hreflang=en class=md-select__link> English </a> </li> <li class=md-select__item> <a href=./ hreflang=zh class=md-select__link> 简体中文 </a> </li> </ul> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 320 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/Shuaiwen-Cui/ESP_STUDY.git title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> Shuaiwen-Cui/ESP_STUDY </div> </a> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../ class=md-tabs__link> ESP32 </a> </li> <li class=md-tabs__item> <a href=../../../GET_STARTED/HARDWARE/hardware/ class=md-tabs__link> 入门 </a> </li> <li class=md-tabs__item> <a href=../../../TUTORIAL_STUDY/DURUOFU/duruofu/ class=md-tabs__link> 教程学习 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../communication/ class=md-tabs__link> 通信 </a> </li> <li class=md-tabs__item> <a href=../../../FREERTOS/quickstart/ class=md-tabs__link> FreeRTOS </a> </li> <li class=md-tabs__item> <a href=../../../MATH-DSP-AI/math-dsp-ai/ class=md-tabs__link> 数学、信号处理和人工智能 </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../ title=ESP_STUDY class="md-nav__button md-logo" aria-label=ESP_STUDY data-md-component=logo> <img src=../../../../static/images/mainboard.png alt=logo> </a> ESP_STUDY </label> <div class=md-nav__source> <a href=https://github.com/Shuaiwen-Cui/ESP_STUDY.git title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> Shuaiwen-Cui/ESP_STUDY </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ class=md-nav__link> <span class=md-ellipsis> ESP32 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> 入门 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 入门 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../GET_STARTED/HARDWARE/hardware/ class=md-nav__link> <span class=md-ellipsis> 硬件 </span> </a> </li> <li class=md-nav__item> <a href=../../../GET_STARTED/ENVIRONMENT/environment/ class=md-nav__link> <span class=md-ellipsis> 环境配置 </span> </a> </li> <li class=md-nav__item> <a href=../../../GET_STARTED/HANDS-ON/hands-on/ class=md-nav__link> <span class=md-ellipsis> 上手实践 </span> </a> </li> <li class=md-nav__item> <a href=../../../GET_STARTED/TEMPLATE/template/ class=md-nav__link> <span class=md-ellipsis> 项目模板 </span> </a> </li> <li class=md-nav__item> <a href=../../../GET_STARTED/COMMON-COMMAND/common-command/ class=md-nav__link> <span class=md-ellipsis> 常用命令 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> 教程学习 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> 教程学习 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../TUTORIAL_STUDY/DURUOFU/duruofu/ class=md-nav__link> <span class=md-ellipsis> 杜若甫教程 </span> </a> </li> <li class=md-nav__item> <a href=../../../TUTORIAL_STUDY/MORNINGCORE/morningcore/ class=md-nav__link> <span class=md-ellipsis> 晨芯教程 </span> </a> </li> <li class=md-nav__item> <a href=../../../TUTORIAL_STUDY/LICHUANG/lichuang/ class=md-nav__link> <span class=md-ellipsis> 立创教程 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> 通信 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 通信 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../communication/ class=md-nav__link> <span class=md-ellipsis> 通信 </span> </a> </li> <li class=md-nav__item> <a href=../../BLUETOOTH/bluetooth/ class=md-nav__link> <span class=md-ellipsis> 蓝牙 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> WIFI </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> WIFI </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 一、介绍 </span> </a> <nav class=md-nav aria-label=一、介绍> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-esp32 class=md-nav__link> <span class=md-ellipsis> 1.1 ESP32事件机制 </span> </a> </li> <li class=md-nav__item> <a href=#12-esp32-wifistaap class=md-nav__link> <span class=md-ellipsis> 1.2 ESP32 WIFI的STA和AP模式 </span> </a> <nav class=md-nav aria-label="1.2 ESP32 WIFI的STA和AP模式"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#121-ap class=md-nav__link> <span class=md-ellipsis> 1.2.1 AP </span> </a> </li> <li class=md-nav__item> <a href=#122-sta class=md-nav__link> <span class=md-ellipsis> 1.2.2 STA </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 二、使用 </span> </a> <nav class=md-nav aria-label=二、使用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-wifi-ap class=md-nav__link> <span class=md-ellipsis> 2.1 WIFI AP模式 </span> </a> <nav class=md-nav aria-label="2.1 WIFI AP模式"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#211-wi-fi class=md-nav__link> <span class=md-ellipsis> 2.1.1 Wi-Fi准备阶段（图上没有） </span> </a> </li> <li class=md-nav__item> <a href=#212-wi-fi class=md-nav__link> <span class=md-ellipsis> 2.1.2 Wi-Fi 初始化阶段 </span> </a> </li> <li class=md-nav__item> <a href=#213-wi-fi class=md-nav__link> <span class=md-ellipsis> 2.1.3 Wi-Fi 配置阶段 </span> </a> </li> <li class=md-nav__item> <a href=#214-wi-fi class=md-nav__link> <span class=md-ellipsis> 2.1.4 Wi-Fi 启动阶段 </span> </a> </li> <li class=md-nav__item> <a href=#215 class=md-nav__link> <span class=md-ellipsis> 2.1.5 事件循环 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#22-wifi-sta class=md-nav__link> <span class=md-ellipsis> 2.2 WIFI STA </span> </a> <nav class=md-nav aria-label="2.2 WIFI STA"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#221-wi-fiap class=md-nav__link> <span class=md-ellipsis> 2.2.1 Wi-Fi准备阶段（与上文AP相同） </span> </a> </li> <li class=md-nav__item> <a href=#222-wi-fi class=md-nav__link> <span class=md-ellipsis> 2.2.2 Wi-Fi初始化阶段 </span> </a> </li> <li class=md-nav__item> <a href=#223-wi-fi class=md-nav__link> <span class=md-ellipsis> 2.2.3 Wi-Fi配置阶段 </span> </a> </li> <li class=md-nav__item> <a href=#224-wi-fi class=md-nav__link> <span class=md-ellipsis> 2.2.4 Wi-Fi 启动阶段 </span> </a> </li> <li class=md-nav__item> <a href=#225 class=md-nav__link> <span class=md-ellipsis> 2.2.5 事件循环 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#23 class=md-nav__link> <span class=md-ellipsis> 2.3 补充 </span> </a> <nav class=md-nav aria-label="2.3 补充"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#231-wifi class=md-nav__link> <span class=md-ellipsis> 2.3.1 WIFI的省电模式 </span> </a> </li> <li class=md-nav__item> <a href=#232-ip class=md-nav__link> <span class=md-ellipsis> 2.3.2 静态IP配置 </span> </a> </li> <li class=md-nav__item> <a href=#233-wifi-scan class=md-nav__link> <span class=md-ellipsis> 2.3.3 WIFI Scan </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 三、实例 </span> </a> <nav class=md-nav aria-label=三、实例> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-wifi-ap class=md-nav__link> <span class=md-ellipsis> 3.1 WIFI AP模式 </span> </a> </li> <li class=md-nav__item> <a href=#32-wifi-sta class=md-nav__link> <span class=md-ellipsis> 3.2 WIFI STA模式 </span> </a> </li> <li class=md-nav__item> <a href=#33-wifi-sta- class=md-nav__link> <span class=md-ellipsis> 3.3 WIFI STA模式 - 连接校园网 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../MQTT/mqtt/ class=md-nav__link> <span class=md-ellipsis> MQTT </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> FreeRTOS </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> FreeRTOS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../FREERTOS/quickstart/ class=md-nav__link> <span class=md-ellipsis> 快速入门 </span> </a> </li> <li class=md-nav__item> <a href=../../../FREERTOS/MULTITASK/multitask/ class=md-nav__link> <span class=md-ellipsis> 多任务管理 </span> </a> </li> <li class=md-nav__item> <a href=../../../FREERTOS/QUEUE/queue/ class=md-nav__link> <span class=md-ellipsis> 队列 </span> </a> </li> <li class=md-nav__item> <a href=../../../FREERTOS/SEMAPHORE/semaphore/ class=md-nav__link> <span class=md-ellipsis> 信号量 </span> </a> </li> <li class=md-nav__item> <a href=../../../FREERTOS/MUTEX/mutex/ class=md-nav__link> <span class=md-ellipsis> 互斥量 </span> </a> </li> <li class=md-nav__item> <a href=../../../FREERTOS/EVENT-GROUP/event-group/ class=md-nav__link> <span class=md-ellipsis> 事件组 </span> </a> </li> <li class=md-nav__item> <a href=../../../FREERTOS/TASK-NOTIFICATION/task-notification/ class=md-nav__link> <span class=md-ellipsis> 任务通知 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> 数学、信号处理和人工智能 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> 数学、信号处理和人工智能 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../MATH-DSP-AI/math-dsp-ai/ class=md-nav__link> <span class=md-ellipsis> 数学 数字信号处理 人工智能 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 一、介绍 </span> </a> <nav class=md-nav aria-label=一、介绍> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-esp32 class=md-nav__link> <span class=md-ellipsis> 1.1 ESP32事件机制 </span> </a> </li> <li class=md-nav__item> <a href=#12-esp32-wifistaap class=md-nav__link> <span class=md-ellipsis> 1.2 ESP32 WIFI的STA和AP模式 </span> </a> <nav class=md-nav aria-label="1.2 ESP32 WIFI的STA和AP模式"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#121-ap class=md-nav__link> <span class=md-ellipsis> 1.2.1 AP </span> </a> </li> <li class=md-nav__item> <a href=#122-sta class=md-nav__link> <span class=md-ellipsis> 1.2.2 STA </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 二、使用 </span> </a> <nav class=md-nav aria-label=二、使用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-wifi-ap class=md-nav__link> <span class=md-ellipsis> 2.1 WIFI AP模式 </span> </a> <nav class=md-nav aria-label="2.1 WIFI AP模式"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#211-wi-fi class=md-nav__link> <span class=md-ellipsis> 2.1.1 Wi-Fi准备阶段（图上没有） </span> </a> </li> <li class=md-nav__item> <a href=#212-wi-fi class=md-nav__link> <span class=md-ellipsis> 2.1.2 Wi-Fi 初始化阶段 </span> </a> </li> <li class=md-nav__item> <a href=#213-wi-fi class=md-nav__link> <span class=md-ellipsis> 2.1.3 Wi-Fi 配置阶段 </span> </a> </li> <li class=md-nav__item> <a href=#214-wi-fi class=md-nav__link> <span class=md-ellipsis> 2.1.4 Wi-Fi 启动阶段 </span> </a> </li> <li class=md-nav__item> <a href=#215 class=md-nav__link> <span class=md-ellipsis> 2.1.5 事件循环 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#22-wifi-sta class=md-nav__link> <span class=md-ellipsis> 2.2 WIFI STA </span> </a> <nav class=md-nav aria-label="2.2 WIFI STA"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#221-wi-fiap class=md-nav__link> <span class=md-ellipsis> 2.2.1 Wi-Fi准备阶段（与上文AP相同） </span> </a> </li> <li class=md-nav__item> <a href=#222-wi-fi class=md-nav__link> <span class=md-ellipsis> 2.2.2 Wi-Fi初始化阶段 </span> </a> </li> <li class=md-nav__item> <a href=#223-wi-fi class=md-nav__link> <span class=md-ellipsis> 2.2.3 Wi-Fi配置阶段 </span> </a> </li> <li class=md-nav__item> <a href=#224-wi-fi class=md-nav__link> <span class=md-ellipsis> 2.2.4 Wi-Fi 启动阶段 </span> </a> </li> <li class=md-nav__item> <a href=#225 class=md-nav__link> <span class=md-ellipsis> 2.2.5 事件循环 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#23 class=md-nav__link> <span class=md-ellipsis> 2.3 补充 </span> </a> <nav class=md-nav aria-label="2.3 补充"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#231-wifi class=md-nav__link> <span class=md-ellipsis> 2.3.1 WIFI的省电模式 </span> </a> </li> <li class=md-nav__item> <a href=#232-ip class=md-nav__link> <span class=md-ellipsis> 2.3.2 静态IP配置 </span> </a> </li> <li class=md-nav__item> <a href=#233-wifi-scan class=md-nav__link> <span class=md-ellipsis> 2.3.3 WIFI Scan </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 三、实例 </span> </a> <nav class=md-nav aria-label=三、实例> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-wifi-ap class=md-nav__link> <span class=md-ellipsis> 3.1 WIFI AP模式 </span> </a> </li> <li class=md-nav__item> <a href=#32-wifi-sta class=md-nav__link> <span class=md-ellipsis> 3.2 WIFI STA模式 </span> </a> </li> <li class=md-nav__item> <a href=#33-wifi-sta- class=md-nav__link> <span class=md-ellipsis> 3.3 WIFI STA模式 - 连接校园网 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/Shuaiwen-Cui/ESP_STUDY.git/edit/master/docs/COMMUNICATION/WIFI/wifi.zh.md title=编辑此页 class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/Shuaiwen-Cui/ESP_STUDY.git/raw/master/docs/COMMUNICATION/WIFI/wifi.zh.md title=查看本页的源代码 class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1 id=wifi>WIFI 基础<a class=headerlink href=#wifi title="Permanent link">&para;</a></h1> <div class="admonition note"> <p class=admonition-title>参考出处</p> <p>本文档参考了DURUOFU的<a href=https://github.com/DuRuofu/ESP32-Guide>ESP32-教程</a>。 </p> </div> <p>本节将介绍如何在 ESP32 上使用 WiFi 功能，包括WIFI AP 和WIFI STA。</p> <h2 id=_1>一、介绍<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <p>在开始使用WIFI之前，我们需要掌握一些基本的概念和前置知识：</p> <blockquote> <p>最基本的一点：Wi-Fi是物理层和数据链路层的东西,Wi-Fi取代的是以太网的网线和交换机上的口，通过无线电波来收发信息。换句话说，这里说的WIFI暂时不涉及网络层协议。</p> </blockquote> <h3 id=11-esp32>1.1 ESP32事件机制<a class=headerlink href=#11-esp32 title="Permanent link">&para;</a></h3> <blockquote> <p>如果对FreeRTOS的多线程没有任何了解，请先了解一下，可以参考：<a href="https://www.bilibili.com/video/BV1au411E7K1?p=7">线程是什么</a></p> </blockquote> <p>关于事件循环可以参考下面的链接、大致了解即可。</p> <ol> <li><a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/system/esp_event.html>ESP32事件循环</a></li> <li><a href="https://www.bilibili.com/video/BV1FD4y1j79J/?spm_id_from=333.788&vd_source=ef5a0ab0106372751602034cdd9ab98e">Event Loop 大白话版</a></li> </ol> <h3 id=12-esp32-wifistaap>1.2 ESP32 WIFI的STA和AP模式<a class=headerlink href=#12-esp32-wifistaap title="Permanent link">&para;</a></h3> <h4 id=121-ap>1.2.1 AP<a class=headerlink href=#121-ap title="Permanent link">&para;</a></h4> <p>AP(Access Point)也就是无线接入点，是一个无线网络的创建者,是网络的中心节点。一般家庭或办公室使用的无线路由器就是一个AP。</p> <p><img alt src=../../../../COMMUNICATION/WIFI/20240313184111.png></p> <h4 id=122-sta>1.2.2 STA<a class=headerlink href=#122-sta title="Permanent link">&para;</a></h4> <p>站点(STA，Station)就是每一个连接到无线网络中的终端(如笔记本电脑、PDA及其它可以联网的用户设备)都可称为一个站点。</p> <p><img alt src=../../../../COMMUNICATION/WIFI/20240313184132.png></p> <h2 id=_2>二、使用<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <blockquote> <p>参考：<a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-guides/wifi.html>ESP-IDF:Wi-Fi 驱动程序</a></p> </blockquote> <p>ESP-IDFWiFi库提供的功能如下：</p> <ul> <li>支持仅 station 模式、仅 AP 模式、station/AP 共存模式</li> <li>支持使用 IEEE 802.11b、IEEE 802.11g、IEEE 802.11n 和 API 配置协议模式</li> <li>支持 WPA/WPA2/WPA3/WPA2-企业版/WPA3-企业版/WAPI/WPS 和 DPP</li> <li>支持 AMSDU、AMPDU、HT40、QoS 以及其它主要功能</li> <li>支持乐鑫专属协议，可实现 <strong>1 km</strong> 数据通信量</li> <li>空中数据传输最高可达 20 MBit/s TCP 吞吐量和 30 MBit/s UDP 吞吐量</li> <li>支持快速扫描和全信道扫描</li> <li>支持获取信道状态信息</li> </ul> <div class="admonition tip"> <p class=admonition-title>校园网WIFI</p> <p>注意，很多单位或者学校的校园网和家庭wifi一样，以南洋理工为例，学校校园使用的模式是WPA2-Enterprise，所以在连接校园网时，需要使用WPA2-Enterprise模式。</p> </div> <h3 id=21-wifi-ap>2.1 WIFI AP模式<a class=headerlink href=#21-wifi-ap title="Permanent link">&para;</a></h3> <blockquote> <p>官方示例程序位于：</p> <p><code>Espressif\frameworks\esp-idf-v4.4.3\examples\wifi\getting_started\softAP</code></p> </blockquote> <p>配置流程如下：</p> <ul> <li><code>nvs_flash_init</code>，初始化默认 NVS 分区。</li> <li><code>esp_netif_init</code>，初始化底层TCP/IP堆栈（创建一个 LwIP 核心任务，并初始化 LwIP 相关工作。）</li> <li><code>esp_event_loop_create_default</code>，创建默认事件循环。</li> <li><code>esp_netif_create_default_wifi_ap</code>，使用默认WiFi AP配置创建esp_netif对象，将netif连接到WiFi并注册默认WiFi处理程序。</li> <li><code>esp_wifi_init</code>，为 WiFi 驱动初始化 WiFi 分配资源，如 WiFi 控制结构、RX/TX 缓冲区、WiFi NVS 结构等，这个 WiFi 也启动 WiFi 任务。必须先调用此API，然后才能调用所有其他WiFi API</li> <li><code>esp_event_handler_instance_register</code>，监听WIFI_EVENTWiFi 任意事件，触发事件后，进入回调函数</li> <li><code>esp_wifi_set_mode</code>，设置WiFi工作模式为station、soft-AP或station+soft-AP，默认模式为soft-AP模式。本程序设置为AP</li> <li><code>esp_wifi_set_config</code>，设置 ESP32 STA 或 AP 的配置</li> <li><code>esp_wifi_start</code>，根据配置，启动WiFi</li> </ul> <p>工作流程如下图所示：(看不懂可以忽略，毕竟先用起来慢慢就学会了，也可以看<a href=https://space.bilibili.com/1338335828>Michael_ee</a>老师的教程:<a href="https://www.bilibili.com/video/BV1ye4y1r7XK/?spm_id_from=333.788&vd_source=ef5a0ab0106372751602034cdd9ab98e">WIFI热点工作流程</a>)</p> <p><img alt src=../../../../COMMUNICATION/WIFI/20240313190734.png></p> <p>主要的流程分为下面几个部分（图来自官方教程）：</p> <p><img alt src=../../../../COMMUNICATION/WIFI/20240313191730.png></p> <h4 id=211-wi-fi>2.1.1 Wi-Fi准备阶段（图上没有）<a class=headerlink href=#211-wi-fi title="Permanent link">&para;</a></h4> <p>这个阶段我们需要初始化NVS,因为WiFi库内部是依赖这个东西的，NVS的相关知识可以看这篇博客：<a href=https://www.duruofu.top/2024/03/06/4.%E7%A1%AC%E4%BB%B6%E7%9B%B8%E5%85%B3/MCU/ESP32/04.ESP32%E5%AD%98%E5%82%A8%E5%99%A8%E5%85%A5%E9%97%A8/4.3-ESP32%E5%AD%98%E5%82%A8-VFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/ESP32%E5%AD%98%E5%82%A8-VFS%E8%99%9A%E6%8B%9F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%85%A5%E9%97%A8/ >ESP32存储-3.VFS虚拟文件系统</a></p> <p>下面直接贴出代码： <div class="language-c highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1>// Initialize NVS</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=n>esp_err_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>();</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ret</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>ESP_ERR_NVS_NO_FREE_PAGES</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>ESP_ERR_NVS_NEW_VERSION_FOUND</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>nvs_flash_erase</span><span class=p>());</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>    </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>();</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=p>}</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=p>);</span>
</span></code></pre></div></p> <h4 id=212-wi-fi>2.1.2 Wi-Fi 初始化阶段<a class=headerlink href=#212-wi-fi title="Permanent link">&para;</a></h4> <p>这个阶段主要有下面几个步骤：</p> <ul> <li>主任务通过调用函数 <a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/network/esp_netif.html#_CPPv414esp_netif_initv title=esp_netif_init><code>esp_netif_init()</code></a> 创建一个 LwIP 核心任务，并初始化 LwIP 相关工作。</li> <li>主任务通过调用函数 <a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/system/esp_event.html#_CPPv421esp_event_loop_createPK21esp_event_loop_args_tP23esp_event_loop_handle_t title=esp_event_loop_create><code>esp_event_loop_create()</code></a> 创建一个系统事件任务，并初始化应用程序事件的回调函数。在此情况下，该回调函数唯一的动作就是将事件中继到应用程序任务中。</li> <li>主任务通过调用函数 <a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/network/esp_netif.html#_CPPv432esp_netif_create_default_wifi_apv title=esp_netif_create_default_wifi_ap><code>esp_netif_create_default_wifi_ap()</code></a> 或 <a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/network/esp_netif.html#_CPPv433esp_netif_create_default_wifi_stav title=esp_netif_create_default_wifi_sta><code>esp_netif_create_default_wifi_sta()</code></a> 创建有 TCP/IP 堆栈的默认网络接口实例绑定 station 或 AP。</li> <li>主任务通过调用函数 <a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/network/esp_wifi.html#_CPPv413esp_wifi_initPK18wifi_init_config_t title=esp_wifi_init><code>esp_wifi_init()</code></a> 创建 Wi-Fi 驱动程序任务，并初始化 Wi-Fi 驱动程序。</li> <li>主任务通过调用 OS API 创建应用程序任务。</li> </ul> <p>代码：</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_netif_init</span><span class=p>());</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_loop_create_default</span><span class=p>());</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=c1>// *esp_netif_ap 可以用来修改AP设置</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=n>esp_netif_t</span><span class=w> </span><span class=o>*</span><span class=n>esp_netif_ap</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>esp_netif_create_default_wifi_ap</span><span class=p>();</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=cm>/*Initialize WiFi */</span><span class=w> </span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=n>wifi_init_config_t</span><span class=w> </span><span class=n>cfg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WIFI_INIT_CONFIG_DEFAULT</span><span class=p>();</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=c1>// WIFI_INIT_CONFIG_DEFAULT 是一个默认配置的宏</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_init</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cfg</span><span class=p>));</span>
</span></code></pre></div> <p>到这里就完成了wifi初始化。</p> <h4 id=213-wi-fi>2.1.3 Wi-Fi 配置阶段<a class=headerlink href=#213-wi-fi title="Permanent link">&para;</a></h4> <p>Wi-Fi 驱动程序初始化成功后，可以进入到配置阶段。</p> <p>通过函数<code>esp_wifi_set_mode</code>可以设置WiFi工作模式为station、soft-AP或station+soft-AP。</p> <p>通过函数<code>esp_wifi_set_config</code>，设置 ESP32 STA 或 AP 的具体配置（参数很多，可以去官方文档仔细看看，下面只配置几个基本参数）。</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1>// 设置为AP模式</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=w> </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_set_mode</span><span class=p>(</span><span class=n>WIFI_MODE_AP</span><span class=p>));</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=c1>// AP详细配置</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=n>wifi_config_t</span><span class=w> </span><span class=n>wifi_ap_config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=w>    </span><span class=p>.</span><span class=n>ap</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=w>        </span><span class=p>.</span><span class=n>ssid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ESP_WIFI_AP_SSID</span><span class=p>,</span><span class=w>             </span><span class=c1>// WIFI名称</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=w>        </span><span class=p>.</span><span class=n>ssid_len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strlen</span><span class=p>(</span><span class=n>ESP_WIFI_AP_SSID</span><span class=p>),</span><span class=w> </span><span class=c1>// 名称长度</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=w>        </span><span class=p>.</span><span class=n>channel</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w>                         </span><span class=c1>// WIFI信道</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=w>        </span><span class=p>.</span><span class=n>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ESP_WIFI_AP_PASSWD</span><span class=p>,</span><span class=w>       </span><span class=c1>// WiFi密码</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=w>        </span><span class=p>.</span><span class=n>max_connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>,</span><span class=w>                  </span><span class=c1>// 最大连接数，默认值是 10</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=w>        </span><span class=p>.</span><span class=n>authmode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WIFI_AUTH_WPA2_PSK</span><span class=p>,</span><span class=w>       </span><span class=c1>// WiFi认证方式</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=p>};</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_set_config</span><span class=p>(</span><span class=n>WIFI_IF_AP</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>wifi_ap_config</span><span class=p>));</span>
</span></code></pre></div> <p>这里只配配置了基本参数。</p> <h4 id=214-wi-fi>2.1.4 Wi-Fi 启动阶段<a class=headerlink href=#214-wi-fi title="Permanent link">&para;</a></h4> <p>使用<code>esp_wifi_start</code>，根据配置，启动WiFi</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=cm>/* Start WiFi */</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_start</span><span class=p>());</span>
</span></code></pre></div> <p>这样就完成了一个基本的WIFI AP。</p> <p>但是这样仅仅是最基本的程序，当有外部STA设备接入和断开我们如何在程序里得知呢？这就需要使用之前创建的默认事件循环，</p> <h4 id=215>2.1.5 事件循环<a class=headerlink href=#215 title="Permanent link">&para;</a></h4> <p>调用 <a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/system/esp_event.html#_CPPv431esp_event_handler_register_with23esp_event_loop_handle_t16esp_event_base_t7int32_t19esp_event_handler_tPv title=esp_event_handler_register_with><code>esp_event_handler_instance_register</code></a> 将事件处理函数注册到默认的事件循环中。它与 <code>esp_event_handler_instance_register_with</code>函数的功能相同，唯一的区别是将处理器注册到默认事件循环中。</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>esp_err_t</span><span class=w> </span><span class=nf>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>esp_event_base_t</span><span class=w> </span><span class=n>event_base</span><span class=p>,</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=w>                                             </span><span class=kt>int32_t</span><span class=w> </span><span class=n>event_id</span><span class=p>,</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>                                             </span><span class=n>esp_event_handler_t</span><span class=w> </span><span class=n>event_handler</span><span class=p>,</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>                                             </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_handler_arg</span><span class=p>,</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=w>                                             </span><span class=n>esp_event_handler_instance_t</span><span class=w> </span><span class=o>*</span><span class=n>instance</span><span class=p>);</span>
</span></code></pre></div> <p>参数如下：</p> <ul> <li>参数 event_base 是要为其注册处理程序的事件的基本ID。</li> <li>参数 event_id 是要注册处理程序的事件的ID。</li> <li>参数 event_handler 是当事件被分发时调用的处理函数。</li> <li>参数 event_handler_arg 是传递给处理函数的除事件数据以外的数据。</li> <li>参数 instance 是与注册的事件处理器和数据相关的事件处理器实例对象</li> </ul> <p>可以在espidf文件里看到相关事件描述：</p> <p><img alt src=../../../../COMMUNICATION/WIFI/20240314165844.png></p> <p>我们可以在默认事件循环创建后，添加事件处理：</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=kt>void</span><span class=w> </span><span class=nf>WIFI_CallBack</span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_handler_arg</span><span class=p>,</span><span class=n>esp_event_base_t</span><span class=w> </span><span class=n>event_base</span><span class=p>,</span><span class=kt>int32_t</span><span class=w> </span><span class=n>event_id</span><span class=p>,</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_data</span><span class=p>)</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=p>{</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>    </span><span class=c1>// 连接事件</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT_AP_STAIPASSIGNED</span><span class=p>)</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>        </span><span class=c1>// 解析数据</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>        </span><span class=n>ip_event_ap_staipassigned_t</span><span class=o>*</span><span class=w> </span><span class=n>event_info</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>ip_event_ap_staipassigned_t</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=n>event_data</span><span class=p>;</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>        </span><span class=n>ESP_LOGW</span><span class=p>(</span><span class=s>&quot;WIFI_AP&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;设备已连接 MAC:&quot;</span><span class=n>MACSTR</span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=n>MAC2STR</span><span class=p>(</span><span class=n>event_info</span><span class=o>-&gt;</span><span class=n>mac</span><span class=p>));</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>    </span><span class=c1>// 断开连接事件</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT_AP_STADISCONNECTED</span><span class=p>)</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=w>        </span><span class=n>wifi_event_ap_stadisconnected_t</span><span class=o>*</span><span class=w> </span><span class=n>event_info</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>wifi_event_ap_stadisconnected_t</span><span class=o>*</span><span class=p>)</span><span class=n>event_data</span><span class=p>;</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=w>        </span><span class=n>ESP_LOGW</span><span class=p>(</span><span class=s>&quot;WIFI_AP&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;设备已断开 MAC:&quot;</span><span class=n>MACSTR</span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=n>MAC2STR</span><span class=p>(</span><span class=n>event_info</span><span class=o>-&gt;</span><span class=n>mac</span><span class=p>));</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=p>}</span>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a><span class=kt>void</span><span class=w> </span><span class=nf>app_main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a><span class=p>{</span>
</span><span id=__span-5-21><a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=w>    </span><span class=c1>// ......</span>
</span><span id=__span-5-22><a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a>
</span><span id=__span-5-23><a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a><span class=w>    </span><span class=c1>// 初始化默认事件循环</span>
</span><span id=__span-5-24><a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_loop_create_default</span><span class=p>());</span>
</span><span id=__span-5-25><a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a><span class=w>    </span><span class=c1>// 注册设备连接事件回调</span>
</span><span id=__span-5-26><a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a><span class=w>    </span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>IP_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>IP_EVENT_AP_STAIPASSIGNED</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>);</span>
</span><span id=__span-5-27><a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a><span class=w>    </span><span class=c1>// 注册设备断开连接设备回调</span>
</span><span id=__span-5-28><a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a><span class=w>    </span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>WIFI_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_EVENT_AP_STADISCONNECTED</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>);</span>
</span><span id=__span-5-29><a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a>
</span><span id=__span-5-30><a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a>
</span><span id=__span-5-31><a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a><span class=w>    </span><span class=c1>// ......</span>
</span><span id=__span-5-32><a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a><span class=p>}</span>
</span></code></pre></div> <p>我们在这里注册了IP_EVENT_AP_STAIPASSIGNED事件，当STA设备连接和断开后就会调用WIFI_CallBack回调函数,打印连接设备的MAC信息。</p> <h3 id=22-wifi-sta>2.2 WIFI STA<a class=headerlink href=#22-wifi-sta title="Permanent link">&para;</a></h3> <blockquote> <p>官方示例代码位于（与热点流程相似，但是细节有所不同）: `Espressif\frameworks\esp-idf-v4.4.3\examples\wifi\getting_started\station</p> </blockquote> <p>前面几步配配置方式基本相同</p> <p>下面是官方的程序宏观流程：</p> <p><img alt src=../../../../COMMUNICATION/WIFI/20240314220947.png></p> <h4 id=221-wi-fiap>2.2.1 Wi-Fi准备阶段（与上文AP相同）<a class=headerlink href=#221-wi-fiap title="Permanent link">&para;</a></h4> <p>初始化NVS：</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1>// Initialize NVS</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=n>esp_err_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>();</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ret</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>ESP_ERR_NVS_NO_FREE_PAGES</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>ESP_ERR_NVS_NEW_VERSION_FOUND</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>nvs_flash_erase</span><span class=p>());</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>    </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>();</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=p>}</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=p>);</span>
</span></code></pre></div> <h4 id=222-wi-fi>2.2.2 Wi-Fi初始化阶段<a class=headerlink href=#222-wi-fi title="Permanent link">&para;</a></h4> <p>这里与AP的配置不同了，我们需要配置设备为STA模式，</p> <p>这里唯一的区别是把<code>esp_netif_create_default_wifi_ap()</code>修改为<code>esp_netif_create_default_wifi_sta()</code>配置为STA模式</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_netif_init</span><span class=p>());</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_loop_create_default</span><span class=p>());</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=c1>// *esp_netif_ap 可以用来修改AP设置</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=n>esp_netif_t</span><span class=w> </span><span class=o>*</span><span class=n>esp_netif_sta</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>esp_netif_create_default_wifi_sta</span><span class=p>();</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=cm>/*Initialize WiFi */</span><span class=w> </span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=n>wifi_init_config_t</span><span class=w> </span><span class=n>cfg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WIFI_INIT_CONFIG_DEFAULT</span><span class=p>();</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=c1>// WIFI_INIT_CONFIG_DEFAULT 是一个默认配置的宏</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_init</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cfg</span><span class=p>));</span>
</span></code></pre></div> <h4 id=223-wi-fi>2.2.3 Wi-Fi配置阶段<a class=headerlink href=#223-wi-fi title="Permanent link">&para;</a></h4> <p>这里与AP模式类似，但是配置结构体里的内容有差异</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=p>...............</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=cp>#define ESP_WIFI_STA_SSID &quot;duruofu_win10&quot;</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=cp>#define ESP_WIFI_STA_PASSWD &quot;1234567890&quot;</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=p>.................</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=c1>// 设置为STA模式</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_set_mode</span><span class=p>(</span><span class=n>WIFI_MODE_STA</span><span class=p>));</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=c1>// STA详细配置</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=n>wifi_config_t</span><span class=w> </span><span class=n>sta_config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=w>    </span><span class=p>.</span><span class=n>sta</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=w>        </span><span class=p>.</span><span class=n>ssid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ESP_WIFI_STA_SSID</span><span class=p>,</span>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=w>        </span><span class=p>.</span><span class=n>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ESP_WIFI_STA_PASSWD</span><span class=p>,</span>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=w>        </span><span class=p>.</span><span class=n>bssid_set</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>,</span>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=p>}</span><span class=w> </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_set_config</span><span class=p>(</span><span class=n>WIFI_IF_STA</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>sta_config</span><span class=p>));</span>
</span></code></pre></div> <p>这里的配置信息顾名思义就是要连接的wifi名称和密码（当然还有更多参数，可以参考ESP-IDF参数说明）。</p> <h4 id=224-wi-fi>2.2.4 Wi-Fi 启动阶段<a class=headerlink href=#224-wi-fi title="Permanent link">&para;</a></h4> <p>和AP模式不同，这里多了一个<code>esp_wifi_connect()</code>用于连接wifi。</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1>//----------------启动阶段-------------------</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_start</span><span class=p>());</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_connect</span><span class=p>());</span>
</span></code></pre></div> <h4 id=225>2.2.5 事件循环<a class=headerlink href=#225 title="Permanent link">&para;</a></h4> <p>同样的，我们可以像前面一样添加事件回调函数</p> <p>这里监听了启动事件，连接失败事件，连接成功事件，代码很简单就不展开解释了。</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=kt>void</span><span class=w> </span><span class=nf>WIFI_CallBack</span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_handler_arg</span><span class=p>,</span><span class=n>esp_event_base_t</span><span class=w> </span><span class=n>event_base</span><span class=p>,</span><span class=kt>int32_t</span><span class=w> </span><span class=n>event_id</span><span class=p>,</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_data</span><span class=p>)</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=p>{</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=w>    </span><span class=k>static</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>connect_count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>    </span><span class=c1>// WIFI 启动成功</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT_STA_START</span><span class=p>)</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>        </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;WIFI_EVENT_STA_START&quot;</span><span class=p>);</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>        </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_connect</span><span class=p>());</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=w>    </span><span class=c1>// WIFI 连接失败</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT_STA_DISCONNECTED</span><span class=p>)</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=w>        </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;WIFI_EVENT_STA_DISCONNECTED&quot;</span><span class=p>);</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=w>        </span><span class=n>connect_count</span><span class=o>++</span><span class=p>;</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>connect_count</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>6</span><span class=p>)</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=w>            </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_connect</span><span class=p>());</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=w>        </span><span class=k>else</span><span class=p>{</span>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=w>            </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;WIFI_EVENT_STA_DISCONNECTED 10 times&quot;</span><span class=p>);</span>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a><span class=w>    </span><span class=c1>// WIFI 连接成功(获取到了IP)</span>
</span><span id=__span-10-24><a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT_STA_GOT_IP</span><span class=p>)</span>
</span><span id=__span-10-25><a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-10-26><a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a><span class=w>        </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;WIFI_EVENT_STA_GOT_IP&quot;</span><span class=p>);</span>
</span><span id=__span-10-27><a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a><span class=w>        </span><span class=n>ip_event_got_ip_t</span><span class=w> </span><span class=o>*</span><span class=n>info</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>ip_event_got_ip_t</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=n>event_data</span><span class=p>;</span>
</span><span id=__span-10-28><a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a><span class=w>        </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;got ip:&quot;</span><span class=w> </span><span class=n>IPSTR</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=n>IP2STR</span><span class=p>(</span><span class=o>&amp;</span><span class=n>info</span><span class=o>-&gt;</span><span class=n>ip_info</span><span class=p>.</span><span class=n>ip</span><span class=p>));</span>
</span><span id=__span-10-29><a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-10-30><a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a><span class=p>}</span>
</span><span id=__span-10-31><a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a>
</span><span id=__span-10-32><a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a><span class=kt>void</span><span class=w> </span><span class=nf>app_main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span><span id=__span-10-33><a id=__codelineno-10-33 name=__codelineno-10-33 href=#__codelineno-10-33></a><span class=p>{</span>
</span><span id=__span-10-34><a id=__codelineno-10-34 name=__codelineno-10-34 href=#__codelineno-10-34></a><span class=w>    </span><span class=c1>// ......</span>
</span><span id=__span-10-35><a id=__codelineno-10-35 name=__codelineno-10-35 href=#__codelineno-10-35></a>
</span><span id=__span-10-36><a id=__codelineno-10-36 name=__codelineno-10-36 href=#__codelineno-10-36></a><span class=w>    </span><span class=c1>// 初始化默认事件循环</span>
</span><span id=__span-10-37><a id=__codelineno-10-37 name=__codelineno-10-37 href=#__codelineno-10-37></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_loop_create_default</span><span class=p>());</span>
</span><span id=__span-10-38><a id=__codelineno-10-38 name=__codelineno-10-38 href=#__codelineno-10-38></a><span class=w>    </span><span class=c1>// 注册事件(wifi启动成功)</span>
</span><span id=__span-10-39><a id=__codelineno-10-39 name=__codelineno-10-39 href=#__codelineno-10-39></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>WIFI_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_EVENT_STA_START</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>))</span>
</span><span id=__span-10-40><a id=__codelineno-10-40 name=__codelineno-10-40 href=#__codelineno-10-40></a><span class=w>    </span><span class=c1>// 注册事件(wifi连接失败)</span>
</span><span id=__span-10-41><a id=__codelineno-10-41 name=__codelineno-10-41 href=#__codelineno-10-41></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>WIFI_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_EVENT_STA_DISCONNECTED</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>))</span>
</span><span id=__span-10-42><a id=__codelineno-10-42 name=__codelineno-10-42 href=#__codelineno-10-42></a><span class=w>    </span><span class=c1>// 注册事件(wifi连接失败)</span>
</span><span id=__span-10-43><a id=__codelineno-10-43 name=__codelineno-10-43 href=#__codelineno-10-43></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>IP_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>IP_EVENT_STA_GOT_IP</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>))</span>
</span><span id=__span-10-44><a id=__codelineno-10-44 name=__codelineno-10-44 href=#__codelineno-10-44></a>
</span><span id=__span-10-45><a id=__codelineno-10-45 name=__codelineno-10-45 href=#__codelineno-10-45></a><span class=w>    </span><span class=c1>// ......</span>
</span><span id=__span-10-46><a id=__codelineno-10-46 name=__codelineno-10-46 href=#__codelineno-10-46></a><span class=p>}</span>
</span></code></pre></div> <h3 id=23>2.3 补充<a class=headerlink href=#23 title="Permanent link">&para;</a></h3> <h4 id=231-wifi>2.3.1 WIFI的省电模式<a class=headerlink href=#231-wifi title="Permanent link">&para;</a></h4> <p>可以使用<code>esp_wifi_set_ps()</code>函数来配置WIFI的省电模式。</p> <p>这个函数可以有三个参数可选： <div class="language-c highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=k>typedef</span><span class=w> </span><span class=k>enum</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=w>    </span><span class=n>WIFI_PS_NONE</span><span class=p>,</span><span class=w>        </span><span class=cm>/**&lt; No power save */</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=w>    </span><span class=n>WIFI_PS_MIN_MODEM</span><span class=p>,</span><span class=w>   </span><span class=cm>/**&lt; Minimum modem power saving. In this mode, station wakes up to receive beacon every DTIM period */</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>    </span><span class=n>WIFI_PS_MAX_MODEM</span><span class=p>,</span><span class=w>   </span><span class=cm>/**&lt; Maximum modem power saving. In this mode, interval to receive beacons is determined by the listen_interval parameter in wifi_sta_config_t */</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=p>}</span><span class=w> </span><span class=n>wifi_ps_type_t</span><span class=p>;</span>
</span></code></pre></div></p> <p>关于省电模式可以参考：<a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-guides/low-power-mode.html#id8 title=永久链接至标题>Wi-Fi场景如何选择低功耗模式</a></p> <h4 id=232-ip>2.3.2 静态IP配置<a class=headerlink href=#232-ip title="Permanent link">&para;</a></h4> <p>在<code>esp_netif_create_default_wifi_sta()</code>创建好DHCP客户端后使用函数<code>esp_err_t esp_netif_dhcpc_stop(esp_netif_t *esp_netif)</code>停止DHCP客户端。</p> <p>使用<code>esp_netif_set_ip_info()</code>配置我们想要的静态IP,如下：</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1>// 初始化STA设备</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=n>esp_netif_t</span><span class=w> </span><span class=o>*</span><span class=n>esp_netif</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>esp_netif_create_default_wifi_sta</span><span class=p>();</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=c1>// ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=c1>//*******************配置静态IP*************************</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=n>esp_netif_dhcpc_stop</span><span class=p>(</span><span class=n>esp_netif</span><span class=p>);</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=n>esp_netif_ip_info_t</span><span class=w> </span><span class=n>ipInfo</span><span class=p>;</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=n>ipInfo</span><span class=p>.</span><span class=n>ip</span><span class=p>.</span><span class=n>addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>inet_addr</span><span class=p>(</span><span class=s>&quot;192.168.138.2&quot;</span><span class=p>);</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=n>ipInfo</span><span class=p>.</span><span class=n>netmask</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>inet_addr</span><span class=p>(</span><span class=s>&quot;255.255.255.0&quot;</span><span class=p>);</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=n>ipInfo</span><span class=p>.</span><span class=n>gw</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>inet_addr</span><span class=p>(</span><span class=s>&quot;192.168.138.2&quot;</span><span class=p>);</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=n>esp_netif_set_ip_info</span><span class=p>(</span><span class=n>esp_netif</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>ipInfo</span><span class=p>);</span>
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=n>esp_netif_dhcpc_start</span><span class=p>(</span><span class=n>esp_netif</span><span class=p>);</span>
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=c1>//*******************配置静态IP*************************</span>
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=c1>// ↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span>
</span></code></pre></div> <h4 id=233-wifi-scan>2.3.3 WIFI Scan<a class=headerlink href=#233-wifi-scan title="Permanent link">&para;</a></h4> <p>我们使用<code>esp_wifi_start</code>后，会根据配置，启动WiFI。如果不立即连接到设定的WIFI热点，我们也可以使用WIFI Scan来寻找可连接的设备。</p> <p><code>esp_wifi_scan_start</code>，扫描所有有效的AP <code>esp_wifi_scan_get_ap_records</code>，获取上次扫描中找到的AP列表 <code>esp_wifi_scan_get_ap_num</code>，获取上次扫描中找到的AP数</p> <p>这里也没什么复杂的，建议直接参考IDF官方文档：<a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-guides/wifi.html#id17 title=永久链接至标题>ESP32 Wi-Fi 扫描</a></p> <h2 id=_3>三、实例<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <h3 id=31-wifi-ap>3.1 WIFI AP模式<a class=headerlink href=#31-wifi-ap title="Permanent link">&para;</a></h3> <p>下面基于第二部分的教程实现了WIFI AP模式 代码链接：</p> <blockquote> <p><a href=https://github.com/DuRuofu/ESP32_Learning/tree/master/05.wifi/wifi_ap>https://github.com/DuRuofu/ESP32_Learning/tree/master/05.wifi/wifi_ap</a></p> </blockquote> <div class="language-c highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;string.h&gt;</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;freertos/FreeRTOS.h&quot;</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;freertos/event_groups.h&quot;</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_wifi.h&quot;</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_log.h&quot;</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_event.h&quot;</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;nvs_flash.h&quot;</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_mac.h&quot;</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=cp>#define ESP_WIFI_AP_SSID &quot;CSW@CEE&quot;</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=cp>#define ESP_WIFI_AP_PASSWD &quot;88888888&quot;</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=kt>void</span><span class=w> </span><span class=nf>WIFI_CallBack</span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_handler_arg</span><span class=p>,</span><span class=n>esp_event_base_t</span><span class=w> </span><span class=n>event_base</span><span class=p>,</span><span class=kt>int32_t</span><span class=w> </span><span class=n>event_id</span><span class=p>,</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_data</span><span class=p>)</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=p>{</span>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=w>    </span><span class=c1>// 连接事件</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT_AP_STAIPASSIGNED</span><span class=p>)</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=w>        </span><span class=c1>// 解析数据</span>
</span><span id=__span-13-19><a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a><span class=w>        </span><span class=n>ip_event_ap_staipassigned_t</span><span class=o>*</span><span class=w> </span><span class=n>event_info</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>ip_event_ap_staipassigned_t</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=n>event_data</span><span class=p>;</span>
</span><span id=__span-13-20><a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a><span class=w>        </span><span class=n>ESP_LOGW</span><span class=p>(</span><span class=s>&quot;WIFI_AP&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;设备已连接 MAC:&quot;</span><span class=n>MACSTR</span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=n>MAC2STR</span><span class=p>(</span><span class=n>event_info</span><span class=o>-&gt;</span><span class=n>mac</span><span class=p>));</span>
</span><span id=__span-13-21><a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-13-22><a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a>
</span><span id=__span-13-23><a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a><span class=w>    </span><span class=c1>// 断开连接事件</span>
</span><span id=__span-13-24><a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT_AP_STADISCONNECTED</span><span class=p>)</span>
</span><span id=__span-13-25><a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-13-26><a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a><span class=w>        </span><span class=n>wifi_event_ap_stadisconnected_t</span><span class=o>*</span><span class=w> </span><span class=n>event_info</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>wifi_event_ap_stadisconnected_t</span><span class=o>*</span><span class=p>)</span><span class=n>event_data</span><span class=p>;</span>
</span><span id=__span-13-27><a id=__codelineno-13-27 name=__codelineno-13-27 href=#__codelineno-13-27></a><span class=w>        </span><span class=n>ESP_LOGW</span><span class=p>(</span><span class=s>&quot;WIFI_AP&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;设备已断开 MAC:&quot;</span><span class=n>MACSTR</span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=n>MAC2STR</span><span class=p>(</span><span class=n>event_info</span><span class=o>-&gt;</span><span class=n>mac</span><span class=p>));</span>
</span><span id=__span-13-28><a id=__codelineno-13-28 name=__codelineno-13-28 href=#__codelineno-13-28></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-13-29><a id=__codelineno-13-29 name=__codelineno-13-29 href=#__codelineno-13-29></a><span class=p>}</span>
</span><span id=__span-13-30><a id=__codelineno-13-30 name=__codelineno-13-30 href=#__codelineno-13-30></a>
</span><span id=__span-13-31><a id=__codelineno-13-31 name=__codelineno-13-31 href=#__codelineno-13-31></a><span class=kt>void</span><span class=w> </span><span class=nf>app_main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span><span id=__span-13-32><a id=__codelineno-13-32 name=__codelineno-13-32 href=#__codelineno-13-32></a><span class=p>{</span>
</span><span id=__span-13-33><a id=__codelineno-13-33 name=__codelineno-13-33 href=#__codelineno-13-33></a><span class=w>    </span><span class=c1>//----------------准备阶段-------------------</span>
</span><span id=__span-13-34><a id=__codelineno-13-34 name=__codelineno-13-34 href=#__codelineno-13-34></a><span class=w>    </span><span class=c1>// Initialize NVS</span>
</span><span id=__span-13-35><a id=__codelineno-13-35 name=__codelineno-13-35 href=#__codelineno-13-35></a><span class=w>    </span><span class=n>esp_err_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>();</span>
</span><span id=__span-13-36><a id=__codelineno-13-36 name=__codelineno-13-36 href=#__codelineno-13-36></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ret</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>ESP_ERR_NVS_NO_FREE_PAGES</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>ESP_ERR_NVS_NEW_VERSION_FOUND</span><span class=p>)</span>
</span><span id=__span-13-37><a id=__codelineno-13-37 name=__codelineno-13-37 href=#__codelineno-13-37></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-13-38><a id=__codelineno-13-38 name=__codelineno-13-38 href=#__codelineno-13-38></a><span class=w>        </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>nvs_flash_erase</span><span class=p>());</span>
</span><span id=__span-13-39><a id=__codelineno-13-39 name=__codelineno-13-39 href=#__codelineno-13-39></a><span class=w>        </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>();</span>
</span><span id=__span-13-40><a id=__codelineno-13-40 name=__codelineno-13-40 href=#__codelineno-13-40></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-13-41><a id=__codelineno-13-41 name=__codelineno-13-41 href=#__codelineno-13-41></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>ret</span><span class=p>);</span>
</span><span id=__span-13-42><a id=__codelineno-13-42 name=__codelineno-13-42 href=#__codelineno-13-42></a>
</span><span id=__span-13-43><a id=__codelineno-13-43 name=__codelineno-13-43 href=#__codelineno-13-43></a><span class=w>    </span><span class=c1>//---------------初始化阶段------------------</span>
</span><span id=__span-13-44><a id=__codelineno-13-44 name=__codelineno-13-44 href=#__codelineno-13-44></a>
</span><span id=__span-13-45><a id=__codelineno-13-45 name=__codelineno-13-45 href=#__codelineno-13-45></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_netif_init</span><span class=p>());</span>
</span><span id=__span-13-46><a id=__codelineno-13-46 name=__codelineno-13-46 href=#__codelineno-13-46></a>
</span><span id=__span-13-47><a id=__codelineno-13-47 name=__codelineno-13-47 href=#__codelineno-13-47></a><span class=w>    </span><span class=c1>// 初始化默认事件循环</span>
</span><span id=__span-13-48><a id=__codelineno-13-48 name=__codelineno-13-48 href=#__codelineno-13-48></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_loop_create_default</span><span class=p>());</span>
</span><span id=__span-13-49><a id=__codelineno-13-49 name=__codelineno-13-49 href=#__codelineno-13-49></a><span class=w>    </span><span class=c1>// 注册设备连接事件回调</span>
</span><span id=__span-13-50><a id=__codelineno-13-50 name=__codelineno-13-50 href=#__codelineno-13-50></a><span class=w>    </span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>IP_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>IP_EVENT_AP_STAIPASSIGNED</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>);</span>
</span><span id=__span-13-51><a id=__codelineno-13-51 name=__codelineno-13-51 href=#__codelineno-13-51></a><span class=w>    </span><span class=c1>// 注册设备断开连接设备回调</span>
</span><span id=__span-13-52><a id=__codelineno-13-52 name=__codelineno-13-52 href=#__codelineno-13-52></a><span class=w>    </span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>WIFI_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_EVENT_AP_STADISCONNECTED</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>);</span>
</span><span id=__span-13-53><a id=__codelineno-13-53 name=__codelineno-13-53 href=#__codelineno-13-53></a>
</span><span id=__span-13-54><a id=__codelineno-13-54 name=__codelineno-13-54 href=#__codelineno-13-54></a><span class=w>    </span><span class=c1>// *esp_netif_ap 可以用来修改AP设置</span>
</span><span id=__span-13-55><a id=__codelineno-13-55 name=__codelineno-13-55 href=#__codelineno-13-55></a><span class=w>    </span><span class=n>esp_netif_t</span><span class=w> </span><span class=o>*</span><span class=n>esp_netif_ap</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>esp_netif_create_default_wifi_ap</span><span class=p>();</span>
</span><span id=__span-13-56><a id=__codelineno-13-56 name=__codelineno-13-56 href=#__codelineno-13-56></a>
</span><span id=__span-13-57><a id=__codelineno-13-57 name=__codelineno-13-57 href=#__codelineno-13-57></a><span class=w>    </span><span class=cm>/*Initialize WiFi */</span>
</span><span id=__span-13-58><a id=__codelineno-13-58 name=__codelineno-13-58 href=#__codelineno-13-58></a><span class=w>    </span><span class=n>wifi_init_config_t</span><span class=w> </span><span class=n>cfg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WIFI_INIT_CONFIG_DEFAULT</span><span class=p>();</span>
</span><span id=__span-13-59><a id=__codelineno-13-59 name=__codelineno-13-59 href=#__codelineno-13-59></a><span class=w>    </span><span class=c1>// WIFI_INIT_CONFIG_DEFAULT 是一个默认配置的宏</span>
</span><span id=__span-13-60><a id=__codelineno-13-60 name=__codelineno-13-60 href=#__codelineno-13-60></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_init</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cfg</span><span class=p>));</span>
</span><span id=__span-13-61><a id=__codelineno-13-61 name=__codelineno-13-61 href=#__codelineno-13-61></a>
</span><span id=__span-13-62><a id=__codelineno-13-62 name=__codelineno-13-62 href=#__codelineno-13-62></a><span class=w>    </span><span class=c1>//---------------配置阶段--------------------</span>
</span><span id=__span-13-63><a id=__codelineno-13-63 name=__codelineno-13-63 href=#__codelineno-13-63></a><span class=w>    </span><span class=c1>// 设置为AP模式</span>
</span><span id=__span-13-64><a id=__codelineno-13-64 name=__codelineno-13-64 href=#__codelineno-13-64></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_set_mode</span><span class=p>(</span><span class=n>WIFI_MODE_AP</span><span class=p>));</span>
</span><span id=__span-13-65><a id=__codelineno-13-65 name=__codelineno-13-65 href=#__codelineno-13-65></a>
</span><span id=__span-13-66><a id=__codelineno-13-66 name=__codelineno-13-66 href=#__codelineno-13-66></a><span class=w>    </span><span class=c1>// AP详细配置</span>
</span><span id=__span-13-67><a id=__codelineno-13-67 name=__codelineno-13-67 href=#__codelineno-13-67></a><span class=w>    </span><span class=n>wifi_config_t</span><span class=w> </span><span class=n>wifi_ap_config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-68><a id=__codelineno-13-68 name=__codelineno-13-68 href=#__codelineno-13-68></a><span class=w>        </span><span class=p>.</span><span class=n>ap</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-69><a id=__codelineno-13-69 name=__codelineno-13-69 href=#__codelineno-13-69></a><span class=w>            </span><span class=p>.</span><span class=n>ssid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ESP_WIFI_AP_SSID</span><span class=p>,</span><span class=w>             </span><span class=c1>// WIFI名称</span>
</span><span id=__span-13-70><a id=__codelineno-13-70 name=__codelineno-13-70 href=#__codelineno-13-70></a><span class=w>            </span><span class=p>.</span><span class=n>ssid_len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strlen</span><span class=p>(</span><span class=n>ESP_WIFI_AP_SSID</span><span class=p>),</span><span class=w> </span><span class=c1>// 名称长度</span>
</span><span id=__span-13-71><a id=__codelineno-13-71 name=__codelineno-13-71 href=#__codelineno-13-71></a><span class=w>            </span><span class=p>.</span><span class=n>channel</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w>                         </span><span class=c1>// WIFI信道</span>
</span><span id=__span-13-72><a id=__codelineno-13-72 name=__codelineno-13-72 href=#__codelineno-13-72></a><span class=w>            </span><span class=p>.</span><span class=n>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ESP_WIFI_AP_PASSWD</span><span class=p>,</span><span class=w>       </span><span class=c1>// WiFi密码</span>
</span><span id=__span-13-73><a id=__codelineno-13-73 name=__codelineno-13-73 href=#__codelineno-13-73></a><span class=w>            </span><span class=p>.</span><span class=n>max_connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>,</span><span class=w>                  </span><span class=c1>// 最大连接数，默认值是 10</span>
</span><span id=__span-13-74><a id=__codelineno-13-74 name=__codelineno-13-74 href=#__codelineno-13-74></a><span class=w>            </span><span class=p>.</span><span class=n>authmode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WIFI_AUTH_WPA2_PSK</span><span class=p>,</span><span class=w>       </span><span class=c1>// WiFi认证方式</span>
</span><span id=__span-13-75><a id=__codelineno-13-75 name=__codelineno-13-75 href=#__codelineno-13-75></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-13-76><a id=__codelineno-13-76 name=__codelineno-13-76 href=#__codelineno-13-76></a><span class=w>    </span><span class=p>};</span>
</span><span id=__span-13-77><a id=__codelineno-13-77 name=__codelineno-13-77 href=#__codelineno-13-77></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_set_config</span><span class=p>(</span><span class=n>WIFI_IF_AP</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>wifi_ap_config</span><span class=p>));</span>
</span><span id=__span-13-78><a id=__codelineno-13-78 name=__codelineno-13-78 href=#__codelineno-13-78></a>
</span><span id=__span-13-79><a id=__codelineno-13-79 name=__codelineno-13-79 href=#__codelineno-13-79></a><span class=w>    </span><span class=c1>//---------------启动阶段--------------------</span>
</span><span id=__span-13-80><a id=__codelineno-13-80 name=__codelineno-13-80 href=#__codelineno-13-80></a><span class=w>    </span><span class=cm>/* Start WiFi */</span>
</span><span id=__span-13-81><a id=__codelineno-13-81 name=__codelineno-13-81 href=#__codelineno-13-81></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_start</span><span class=p>());</span>
</span><span id=__span-13-82><a id=__codelineno-13-82 name=__codelineno-13-82 href=#__codelineno-13-82></a><span class=p>}</span>
</span></code></pre></div> <p>效果展示：</p> <p><img alt src=../../../../COMMUNICATION/WIFI/20240314220318.png></p> <p>连接wifi会打印连接设备的信息。</p> <h3 id=32-wifi-sta>3.2 WIFI STA模式<a class=headerlink href=#32-wifi-sta title="Permanent link">&para;</a></h3> <p>下面基于第二部分的教程实现了WIFI STA模式 代码链接：</p> <blockquote> <p><a href=https://github.com/DuRuofu/ESP32_Learning/tree/master/05.wifi/wifi_sta>https://github.com/DuRuofu/ESP32_Learning/tree/master/05.wifi/wifi_sta</a></p> </blockquote> <div class="language-c highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;string.h&gt;</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;freertos/FreeRTOS.h&quot;</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;freertos/event_groups.h&quot;</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_wifi.h&quot;</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_log.h&quot;</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_event.h&quot;</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;nvs_flash.h&quot;</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_mac.h&quot;</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=cp>#define ESP_WIFI_STA_SSID &quot;CSW@CEE&quot;</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=cp>#define ESP_WIFI_STA_PASSWD &quot;88888888&quot;</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=kt>void</span><span class=w> </span><span class=nf>WIFI_CallBack</span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_handler_arg</span><span class=p>,</span><span class=w> </span><span class=n>esp_event_base_t</span><span class=w> </span><span class=n>event_base</span><span class=p>,</span><span class=w> </span><span class=kt>int32_t</span><span class=w> </span><span class=n>event_id</span><span class=p>,</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_data</span><span class=p>)</span>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=p>{</span>
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a><span class=w>    </span><span class=k>static</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>connect_count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a><span class=w>    </span><span class=c1>// WIFI 启动成功</span>
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT_STA_START</span><span class=p>)</span>
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-14-20><a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=w>        </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;WIFI_EVENT_STA_START&quot;</span><span class=p>);</span>
</span><span id=__span-14-21><a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=w>        </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_connect</span><span class=p>());</span>
</span><span id=__span-14-22><a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-14-23><a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a><span class=w>    </span><span class=c1>// WIFI 连接失败</span>
</span><span id=__span-14-24><a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT_STA_DISCONNECTED</span><span class=p>)</span>
</span><span id=__span-14-25><a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-14-26><a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a><span class=w>        </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;WIFI_EVENT_STA_DISCONNECTED&quot;</span><span class=p>);</span>
</span><span id=__span-14-27><a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a><span class=w>        </span><span class=n>connect_count</span><span class=o>++</span><span class=p>;</span>
</span><span id=__span-14-28><a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>connect_count</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>6</span><span class=p>)</span>
</span><span id=__span-14-29><a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-14-30><a id=__codelineno-14-30 name=__codelineno-14-30 href=#__codelineno-14-30></a><span class=w>            </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_connect</span><span class=p>());</span>
</span><span id=__span-14-31><a id=__codelineno-14-31 name=__codelineno-14-31 href=#__codelineno-14-31></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-14-32><a id=__codelineno-14-32 name=__codelineno-14-32 href=#__codelineno-14-32></a><span class=w>        </span><span class=k>else</span><span class=p>{</span>
</span><span id=__span-14-33><a id=__codelineno-14-33 name=__codelineno-14-33 href=#__codelineno-14-33></a><span class=w>            </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;WIFI_EVENT_STA_DISCONNECTED 10 times&quot;</span><span class=p>);</span>
</span><span id=__span-14-34><a id=__codelineno-14-34 name=__codelineno-14-34 href=#__codelineno-14-34></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-14-35><a id=__codelineno-14-35 name=__codelineno-14-35 href=#__codelineno-14-35></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-14-36><a id=__codelineno-14-36 name=__codelineno-14-36 href=#__codelineno-14-36></a><span class=w>    </span><span class=c1>// WIFI 连接成功(获取到了IP)</span>
</span><span id=__span-14-37><a id=__codelineno-14-37 name=__codelineno-14-37 href=#__codelineno-14-37></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT_STA_GOT_IP</span><span class=p>)</span>
</span><span id=__span-14-38><a id=__codelineno-14-38 name=__codelineno-14-38 href=#__codelineno-14-38></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-14-39><a id=__codelineno-14-39 name=__codelineno-14-39 href=#__codelineno-14-39></a><span class=w>        </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;WIFI_EVENT_STA_GOT_IP&quot;</span><span class=p>);</span>
</span><span id=__span-14-40><a id=__codelineno-14-40 name=__codelineno-14-40 href=#__codelineno-14-40></a><span class=w>        </span><span class=n>ip_event_got_ip_t</span><span class=w> </span><span class=o>*</span><span class=n>info</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>ip_event_got_ip_t</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=n>event_data</span><span class=p>;</span>
</span><span id=__span-14-41><a id=__codelineno-14-41 name=__codelineno-14-41 href=#__codelineno-14-41></a><span class=w>        </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;got ip:&quot;</span><span class=w> </span><span class=n>IPSTR</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=n>IP2STR</span><span class=p>(</span><span class=o>&amp;</span><span class=n>info</span><span class=o>-&gt;</span><span class=n>ip_info</span><span class=p>.</span><span class=n>ip</span><span class=p>));</span>
</span><span id=__span-14-42><a id=__codelineno-14-42 name=__codelineno-14-42 href=#__codelineno-14-42></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-14-43><a id=__codelineno-14-43 name=__codelineno-14-43 href=#__codelineno-14-43></a><span class=p>}</span>
</span><span id=__span-14-44><a id=__codelineno-14-44 name=__codelineno-14-44 href=#__codelineno-14-44></a>
</span><span id=__span-14-45><a id=__codelineno-14-45 name=__codelineno-14-45 href=#__codelineno-14-45></a><span class=kt>void</span><span class=w> </span><span class=nf>app_main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span><span id=__span-14-46><a id=__codelineno-14-46 name=__codelineno-14-46 href=#__codelineno-14-46></a><span class=p>{</span>
</span><span id=__span-14-47><a id=__codelineno-14-47 name=__codelineno-14-47 href=#__codelineno-14-47></a><span class=w>    </span><span class=c1>//----------------准备阶段-------------------</span>
</span><span id=__span-14-48><a id=__codelineno-14-48 name=__codelineno-14-48 href=#__codelineno-14-48></a><span class=w>    </span><span class=c1>// Initialize NVS</span>
</span><span id=__span-14-49><a id=__codelineno-14-49 name=__codelineno-14-49 href=#__codelineno-14-49></a><span class=w>    </span><span class=n>esp_err_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>();</span>
</span><span id=__span-14-50><a id=__codelineno-14-50 name=__codelineno-14-50 href=#__codelineno-14-50></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ret</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>ESP_ERR_NVS_NO_FREE_PAGES</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>ESP_ERR_NVS_NEW_VERSION_FOUND</span><span class=p>)</span>
</span><span id=__span-14-51><a id=__codelineno-14-51 name=__codelineno-14-51 href=#__codelineno-14-51></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-14-52><a id=__codelineno-14-52 name=__codelineno-14-52 href=#__codelineno-14-52></a><span class=w>        </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>nvs_flash_erase</span><span class=p>());</span>
</span><span id=__span-14-53><a id=__codelineno-14-53 name=__codelineno-14-53 href=#__codelineno-14-53></a><span class=w>        </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>();</span>
</span><span id=__span-14-54><a id=__codelineno-14-54 name=__codelineno-14-54 href=#__codelineno-14-54></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-14-55><a id=__codelineno-14-55 name=__codelineno-14-55 href=#__codelineno-14-55></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>ret</span><span class=p>);</span>
</span><span id=__span-14-56><a id=__codelineno-14-56 name=__codelineno-14-56 href=#__codelineno-14-56></a>
</span><span id=__span-14-57><a id=__codelineno-14-57 name=__codelineno-14-57 href=#__codelineno-14-57></a><span class=w>    </span><span class=c1>//----------------初始化阶段-------------------</span>
</span><span id=__span-14-58><a id=__codelineno-14-58 name=__codelineno-14-58 href=#__codelineno-14-58></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_netif_init</span><span class=p>());</span>
</span><span id=__span-14-59><a id=__codelineno-14-59 name=__codelineno-14-59 href=#__codelineno-14-59></a>
</span><span id=__span-14-60><a id=__codelineno-14-60 name=__codelineno-14-60 href=#__codelineno-14-60></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_loop_create_default</span><span class=p>());</span>
</span><span id=__span-14-61><a id=__codelineno-14-61 name=__codelineno-14-61 href=#__codelineno-14-61></a><span class=w>    </span><span class=c1>// 注册事件(wifi启动成功)</span>
</span><span id=__span-14-62><a id=__codelineno-14-62 name=__codelineno-14-62 href=#__codelineno-14-62></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>WIFI_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_EVENT_STA_START</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>));</span>
</span><span id=__span-14-63><a id=__codelineno-14-63 name=__codelineno-14-63 href=#__codelineno-14-63></a><span class=w>    </span><span class=c1>// 注册事件(wifi连接失败)</span>
</span><span id=__span-14-64><a id=__codelineno-14-64 name=__codelineno-14-64 href=#__codelineno-14-64></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>WIFI_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_EVENT_STA_DISCONNECTED</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>));</span>
</span><span id=__span-14-65><a id=__codelineno-14-65 name=__codelineno-14-65 href=#__codelineno-14-65></a><span class=w>    </span><span class=c1>// 注册事件(wifi连接失败)</span>
</span><span id=__span-14-66><a id=__codelineno-14-66 name=__codelineno-14-66 href=#__codelineno-14-66></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>IP_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>IP_EVENT_STA_GOT_IP</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>));</span>
</span><span id=__span-14-67><a id=__codelineno-14-67 name=__codelineno-14-67 href=#__codelineno-14-67></a>
</span><span id=__span-14-68><a id=__codelineno-14-68 name=__codelineno-14-68 href=#__codelineno-14-68></a><span class=w>    </span><span class=c1>// 初始化STA设备</span>
</span><span id=__span-14-69><a id=__codelineno-14-69 name=__codelineno-14-69 href=#__codelineno-14-69></a><span class=w>    </span><span class=n>esp_netif_create_default_wifi_sta</span><span class=p>();</span>
</span><span id=__span-14-70><a id=__codelineno-14-70 name=__codelineno-14-70 href=#__codelineno-14-70></a>
</span><span id=__span-14-71><a id=__codelineno-14-71 name=__codelineno-14-71 href=#__codelineno-14-71></a><span class=w>    </span><span class=cm>/*Initialize WiFi */</span>
</span><span id=__span-14-72><a id=__codelineno-14-72 name=__codelineno-14-72 href=#__codelineno-14-72></a><span class=w>    </span><span class=n>wifi_init_config_t</span><span class=w> </span><span class=n>cfg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WIFI_INIT_CONFIG_DEFAULT</span><span class=p>();</span>
</span><span id=__span-14-73><a id=__codelineno-14-73 name=__codelineno-14-73 href=#__codelineno-14-73></a><span class=w>    </span><span class=c1>// WIFI_INIT_CONFIG_DEFAULT 是一个默认配置的宏</span>
</span><span id=__span-14-74><a id=__codelineno-14-74 name=__codelineno-14-74 href=#__codelineno-14-74></a>
</span><span id=__span-14-75><a id=__codelineno-14-75 name=__codelineno-14-75 href=#__codelineno-14-75></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_init</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cfg</span><span class=p>));</span>
</span><span id=__span-14-76><a id=__codelineno-14-76 name=__codelineno-14-76 href=#__codelineno-14-76></a>
</span><span id=__span-14-77><a id=__codelineno-14-77 name=__codelineno-14-77 href=#__codelineno-14-77></a><span class=w>    </span><span class=c1>//----------------配置阶段-------------------</span>
</span><span id=__span-14-78><a id=__codelineno-14-78 name=__codelineno-14-78 href=#__codelineno-14-78></a><span class=w>    </span><span class=c1>// 设置为STA模式</span>
</span><span id=__span-14-79><a id=__codelineno-14-79 name=__codelineno-14-79 href=#__codelineno-14-79></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_set_mode</span><span class=p>(</span><span class=n>WIFI_MODE_STA</span><span class=p>));</span>
</span><span id=__span-14-80><a id=__codelineno-14-80 name=__codelineno-14-80 href=#__codelineno-14-80></a>
</span><span id=__span-14-81><a id=__codelineno-14-81 name=__codelineno-14-81 href=#__codelineno-14-81></a><span class=w>    </span><span class=c1>// STA详细配置</span>
</span><span id=__span-14-82><a id=__codelineno-14-82 name=__codelineno-14-82 href=#__codelineno-14-82></a><span class=w>    </span><span class=n>wifi_config_t</span><span class=w> </span><span class=n>sta_config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-83><a id=__codelineno-14-83 name=__codelineno-14-83 href=#__codelineno-14-83></a><span class=w>        </span><span class=p>.</span><span class=n>sta</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-84><a id=__codelineno-14-84 name=__codelineno-14-84 href=#__codelineno-14-84></a><span class=w>            </span><span class=p>.</span><span class=n>ssid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ESP_WIFI_STA_SSID</span><span class=p>,</span>
</span><span id=__span-14-85><a id=__codelineno-14-85 name=__codelineno-14-85 href=#__codelineno-14-85></a><span class=w>            </span><span class=p>.</span><span class=n>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ESP_WIFI_STA_PASSWD</span><span class=p>,</span>
</span><span id=__span-14-86><a id=__codelineno-14-86 name=__codelineno-14-86 href=#__codelineno-14-86></a><span class=w>            </span><span class=p>.</span><span class=n>bssid_set</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>,</span>
</span><span id=__span-14-87><a id=__codelineno-14-87 name=__codelineno-14-87 href=#__codelineno-14-87></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-14-88><a id=__codelineno-14-88 name=__codelineno-14-88 href=#__codelineno-14-88></a><span class=w>    </span><span class=p>};</span>
</span><span id=__span-14-89><a id=__codelineno-14-89 name=__codelineno-14-89 href=#__codelineno-14-89></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_set_config</span><span class=p>(</span><span class=n>WIFI_IF_STA</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>sta_config</span><span class=p>));</span>
</span><span id=__span-14-90><a id=__codelineno-14-90 name=__codelineno-14-90 href=#__codelineno-14-90></a>
</span><span id=__span-14-91><a id=__codelineno-14-91 name=__codelineno-14-91 href=#__codelineno-14-91></a><span class=w>    </span><span class=c1>//----------------启动阶段-------------------</span>
</span><span id=__span-14-92><a id=__codelineno-14-92 name=__codelineno-14-92 href=#__codelineno-14-92></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_start</span><span class=p>());</span>
</span><span id=__span-14-93><a id=__codelineno-14-93 name=__codelineno-14-93 href=#__codelineno-14-93></a>
</span><span id=__span-14-94><a id=__codelineno-14-94 name=__codelineno-14-94 href=#__codelineno-14-94></a><span class=p>}</span>
</span></code></pre></div> <p>效果如下：</p> <p><img alt src=../../../../COMMUNICATION/WIFI/20240315084947.png></p> <h3 id=33-wifi-sta->3.3 WIFI STA模式 - 连接校园网<a class=headerlink href=#33-wifi-sta- title="Permanent link">&para;</a></h3> <div class="admonition tip"> <p class=admonition-title>通过WPA2-ENTERPIRSE 模式连接校园网</p> <p>以上代码适合普通家用的简单路由器，如果想要接入学校wifi网络，稍微复杂一些，参考<a href=https://github.com/espressif/esp-idf/tree/v5.2.4/examples/wifi/wifi_enterprise>官方文档</a>, 和[官方代码]（<a href=https://github.com/espressif/esp-idf/blob/v5.2.4/examples/wifi/wifi_enterprise/main/wifi_enterprise_main.c>https://github.com/espressif/esp-idf/blob/v5.2.4/examples/wifi/wifi_enterprise/main/wifi_enterprise_main.c</a>）。我个人修改和测试后成功的代码如下。</p> </div> <div class="language-c highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=cm>/* WiFi Connection Example using WPA2 Enterprise</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=cm> *</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=cm> * Original Copyright (C) 2006-2016, ARM Limited, All Rights Reserved, Apache 2.0 License.</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=cm> * Additions Copyright (C) Copyright 2015-2016 Espressif Systems (Shanghai) PTE LTD, Apache 2.0 License.</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=cm> *</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=cm> *</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=cm> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=cm> * you may not use this file except in compliance with the License.</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=cm> * You may obtain a copy of the License at</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=cm> *</span>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=cm> *     http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=cm> *</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=cm> * Unless required by applicable law or agreed to in writing, software</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=cm> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=cm> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=cm> * See the License for the specific language governing permissions and</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=cm> * limitations under the License.</span>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=cm> */</span>
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;string.h&gt;</span>
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdlib.h&gt;</span>
</span><span id=__span-15-21><a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;freertos/FreeRTOS.h&quot;</span>
</span><span id=__span-15-22><a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;freertos/task.h&quot;</span>
</span><span id=__span-15-23><a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;freertos/event_groups.h&quot;</span>
</span><span id=__span-15-24><a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_wifi.h&quot;</span>
</span><span id=__span-15-25><a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_wpa2.h&quot;</span>
</span><span id=__span-15-26><a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_event.h&quot;</span>
</span><span id=__span-15-27><a id=__codelineno-15-27 name=__codelineno-15-27 href=#__codelineno-15-27></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_log.h&quot;</span>
</span><span id=__span-15-28><a id=__codelineno-15-28 name=__codelineno-15-28 href=#__codelineno-15-28></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_system.h&quot;</span>
</span><span id=__span-15-29><a id=__codelineno-15-29 name=__codelineno-15-29 href=#__codelineno-15-29></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;nvs_flash.h&quot;</span>
</span><span id=__span-15-30><a id=__codelineno-15-30 name=__codelineno-15-30 href=#__codelineno-15-30></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_netif.h&quot;</span>
</span><span id=__span-15-31><a id=__codelineno-15-31 name=__codelineno-15-31 href=#__codelineno-15-31></a>
</span><span id=__span-15-32><a id=__codelineno-15-32 name=__codelineno-15-32 href=#__codelineno-15-32></a><span class=cp>#define CONFIG_EXAMPLE_EAP_METHOD_PEAP 1</span>
</span><span id=__span-15-33><a id=__codelineno-15-33 name=__codelineno-15-33 href=#__codelineno-15-33></a>
</span><span id=__span-15-34><a id=__codelineno-15-34 name=__codelineno-15-34 href=#__codelineno-15-34></a><span class=cm>/* The examples use simple WiFi configuration that you can set via</span>
</span><span id=__span-15-35><a id=__codelineno-15-35 name=__codelineno-15-35 href=#__codelineno-15-35></a><span class=cm>   project configuration menu.</span>
</span><span id=__span-15-36><a id=__codelineno-15-36 name=__codelineno-15-36 href=#__codelineno-15-36></a>
</span><span id=__span-15-37><a id=__codelineno-15-37 name=__codelineno-15-37 href=#__codelineno-15-37></a><span class=cm>   If you&#39;d rather not, just change the below entries to strings with</span>
</span><span id=__span-15-38><a id=__codelineno-15-38 name=__codelineno-15-38 href=#__codelineno-15-38></a><span class=cm>   the config you want - ie #define EXAMPLE_WIFI_SSID &quot;mywifissid&quot;</span>
</span><span id=__span-15-39><a id=__codelineno-15-39 name=__codelineno-15-39 href=#__codelineno-15-39></a>
</span><span id=__span-15-40><a id=__codelineno-15-40 name=__codelineno-15-40 href=#__codelineno-15-40></a><span class=cm>   You can choose EAP method via project configuration according to the</span>
</span><span id=__span-15-41><a id=__codelineno-15-41 name=__codelineno-15-41 href=#__codelineno-15-41></a><span class=cm>   configuration of AP.</span>
</span><span id=__span-15-42><a id=__codelineno-15-42 name=__codelineno-15-42 href=#__codelineno-15-42></a><span class=cm>*/</span>
</span><span id=__span-15-43><a id=__codelineno-15-43 name=__codelineno-15-43 href=#__codelineno-15-43></a><span class=cp>#define EXAMPLE_WIFI_SSID &quot;your_ssid&quot; </span><span class=c1>//SSID of WiFi</span>
</span><span id=__span-15-44><a id=__codelineno-15-44 name=__codelineno-15-44 href=#__codelineno-15-44></a><span class=cp>#define EXAMPLE_EAP_METHOD CONFIG_EXAMPLE_EAP_METHOD  </span><span class=c1>//This can be set in Configuration Menu</span>
</span><span id=__span-15-45><a id=__codelineno-15-45 name=__codelineno-15-45 href=#__codelineno-15-45></a>
</span><span id=__span-15-46><a id=__codelineno-15-46 name=__codelineno-15-46 href=#__codelineno-15-46></a><span class=c1>// #define EXAMPLE_EAP_ID &quot;Your_UPI/UserID&quot;</span>
</span><span id=__span-15-47><a id=__codelineno-15-47 name=__codelineno-15-47 href=#__codelineno-15-47></a><span class=cp>#define EXAMPLE_EAP_USERNAME &quot;your_username&quot;</span>
</span><span id=__span-15-48><a id=__codelineno-15-48 name=__codelineno-15-48 href=#__codelineno-15-48></a><span class=cp>#define EXAMPLE_EAP_PASSWORD &quot;your_password&quot;</span>
</span><span id=__span-15-49><a id=__codelineno-15-49 name=__codelineno-15-49 href=#__codelineno-15-49></a>
</span><span id=__span-15-50><a id=__codelineno-15-50 name=__codelineno-15-50 href=#__codelineno-15-50></a><span class=cm>/* FreeRTOS event group to signal when we are connected &amp; ready to make a request */</span>
</span><span id=__span-15-51><a id=__codelineno-15-51 name=__codelineno-15-51 href=#__codelineno-15-51></a><span class=k>static</span><span class=w> </span><span class=n>EventGroupHandle_t</span><span class=w> </span><span class=n>wifi_event_group</span><span class=p>;</span>
</span><span id=__span-15-52><a id=__codelineno-15-52 name=__codelineno-15-52 href=#__codelineno-15-52></a>
</span><span id=__span-15-53><a id=__codelineno-15-53 name=__codelineno-15-53 href=#__codelineno-15-53></a><span class=cm>/* esp netif object representing the WIFI station */</span>
</span><span id=__span-15-54><a id=__codelineno-15-54 name=__codelineno-15-54 href=#__codelineno-15-54></a><span class=k>static</span><span class=w> </span><span class=n>esp_netif_t</span><span class=w> </span><span class=o>*</span><span class=n>sta_netif</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>NULL</span><span class=p>;</span>
</span><span id=__span-15-55><a id=__codelineno-15-55 name=__codelineno-15-55 href=#__codelineno-15-55></a>
</span><span id=__span-15-56><a id=__codelineno-15-56 name=__codelineno-15-56 href=#__codelineno-15-56></a><span class=cm>/* The event group allows multiple bits for each event,</span>
</span><span id=__span-15-57><a id=__codelineno-15-57 name=__codelineno-15-57 href=#__codelineno-15-57></a><span class=cm>   but we only care about one event - are we connected</span>
</span><span id=__span-15-58><a id=__codelineno-15-58 name=__codelineno-15-58 href=#__codelineno-15-58></a><span class=cm>   to the AP with an IP? */</span>
</span><span id=__span-15-59><a id=__codelineno-15-59 name=__codelineno-15-59 href=#__codelineno-15-59></a><span class=k>const</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>CONNECTED_BIT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>BIT0</span><span class=p>;</span>
</span><span id=__span-15-60><a id=__codelineno-15-60 name=__codelineno-15-60 href=#__codelineno-15-60></a>
</span><span id=__span-15-61><a id=__codelineno-15-61 name=__codelineno-15-61 href=#__codelineno-15-61></a><span class=k>static</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>TAG</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;CSW-WIFI&quot;</span><span class=p>;</span>
</span><span id=__span-15-62><a id=__codelineno-15-62 name=__codelineno-15-62 href=#__codelineno-15-62></a>
</span><span id=__span-15-63><a id=__codelineno-15-63 name=__codelineno-15-63 href=#__codelineno-15-63></a><span class=cm>/* CA cert, taken from wpa2_ca.pem</span>
</span><span id=__span-15-64><a id=__codelineno-15-64 name=__codelineno-15-64 href=#__codelineno-15-64></a><span class=cm>   Client cert, taken from wpa2_client.crt</span>
</span><span id=__span-15-65><a id=__codelineno-15-65 name=__codelineno-15-65 href=#__codelineno-15-65></a><span class=cm>   Client key, taken from wpa2_client.key</span>
</span><span id=__span-15-66><a id=__codelineno-15-66 name=__codelineno-15-66 href=#__codelineno-15-66></a>
</span><span id=__span-15-67><a id=__codelineno-15-67 name=__codelineno-15-67 href=#__codelineno-15-67></a><span class=cm>   The PEM, CRT and KEY file were provided by the person or organization</span>
</span><span id=__span-15-68><a id=__codelineno-15-68 name=__codelineno-15-68 href=#__codelineno-15-68></a><span class=cm>   who configured the AP with wpa2 enterprise.</span>
</span><span id=__span-15-69><a id=__codelineno-15-69 name=__codelineno-15-69 href=#__codelineno-15-69></a>
</span><span id=__span-15-70><a id=__codelineno-15-70 name=__codelineno-15-70 href=#__codelineno-15-70></a><span class=cm>   To embed it in the app binary, the PEM, CRT and KEY file is named</span>
</span><span id=__span-15-71><a id=__codelineno-15-71 name=__codelineno-15-71 href=#__codelineno-15-71></a><span class=cm>   in the component.mk COMPONENT_EMBED_TXTFILES variable.</span>
</span><span id=__span-15-72><a id=__codelineno-15-72 name=__codelineno-15-72 href=#__codelineno-15-72></a><span class=cm>*/</span>
</span><span id=__span-15-73><a id=__codelineno-15-73 name=__codelineno-15-73 href=#__codelineno-15-73></a><span class=cp>#ifdef CONFIG_EXAMPLE_VALIDATE_SERVER_CERT</span>
</span><span id=__span-15-74><a id=__codelineno-15-74 name=__codelineno-15-74 href=#__codelineno-15-74></a><span class=k>extern</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>ca_pem_start</span><span class=p>[]</span><span class=w> </span><span class=k>asm</span><span class=p>(</span><span class=s>&quot;_binary_wpa2_ca_pem_start&quot;</span><span class=p>);</span>
</span><span id=__span-15-75><a id=__codelineno-15-75 name=__codelineno-15-75 href=#__codelineno-15-75></a><span class=k>extern</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>ca_pem_end</span><span class=p>[]</span><span class=w>   </span><span class=k>asm</span><span class=p>(</span><span class=s>&quot;_binary_wpa2_ca_pem_end&quot;</span><span class=p>);</span>
</span><span id=__span-15-76><a id=__codelineno-15-76 name=__codelineno-15-76 href=#__codelineno-15-76></a><span class=cp>#endif </span><span class=cm>/* CONFIG_EXAMPLE_VALIDATE_SERVER_CERT */</span>
</span><span id=__span-15-77><a id=__codelineno-15-77 name=__codelineno-15-77 href=#__codelineno-15-77></a>
</span><span id=__span-15-78><a id=__codelineno-15-78 name=__codelineno-15-78 href=#__codelineno-15-78></a><span class=cp>#ifdef CONFIG_EXAMPLE_EAP_METHOD_TLS</span>
</span><span id=__span-15-79><a id=__codelineno-15-79 name=__codelineno-15-79 href=#__codelineno-15-79></a><span class=k>extern</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>client_crt_start</span><span class=p>[]</span><span class=w> </span><span class=k>asm</span><span class=p>(</span><span class=s>&quot;_binary_wpa2_client_crt_start&quot;</span><span class=p>);</span>
</span><span id=__span-15-80><a id=__codelineno-15-80 name=__codelineno-15-80 href=#__codelineno-15-80></a><span class=k>extern</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>client_crt_end</span><span class=p>[]</span><span class=w>   </span><span class=k>asm</span><span class=p>(</span><span class=s>&quot;_binary_wpa2_client_crt_end&quot;</span><span class=p>);</span>
</span><span id=__span-15-81><a id=__codelineno-15-81 name=__codelineno-15-81 href=#__codelineno-15-81></a><span class=k>extern</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>client_key_start</span><span class=p>[]</span><span class=w> </span><span class=k>asm</span><span class=p>(</span><span class=s>&quot;_binary_wpa2_client_key_start&quot;</span><span class=p>);</span>
</span><span id=__span-15-82><a id=__codelineno-15-82 name=__codelineno-15-82 href=#__codelineno-15-82></a><span class=k>extern</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>client_key_end</span><span class=p>[]</span><span class=w>   </span><span class=k>asm</span><span class=p>(</span><span class=s>&quot;_binary_wpa2_client_key_end&quot;</span><span class=p>);</span>
</span><span id=__span-15-83><a id=__codelineno-15-83 name=__codelineno-15-83 href=#__codelineno-15-83></a><span class=cp>#endif </span><span class=cm>/* CONFIG_EXAMPLE_EAP_METHOD_TLS */</span>
</span><span id=__span-15-84><a id=__codelineno-15-84 name=__codelineno-15-84 href=#__codelineno-15-84></a>
</span><span id=__span-15-85><a id=__codelineno-15-85 name=__codelineno-15-85 href=#__codelineno-15-85></a><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>event_handler</span><span class=p>(</span><span class=kt>void</span><span class=o>*</span><span class=w> </span><span class=n>arg</span><span class=p>,</span><span class=w> </span><span class=n>esp_event_base_t</span><span class=w> </span><span class=n>event_base</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-15-86><a id=__codelineno-15-86 name=__codelineno-15-86 href=#__codelineno-15-86></a><span class=w>                                </span><span class=kt>int32_t</span><span class=w> </span><span class=n>event_id</span><span class=p>,</span><span class=w> </span><span class=kt>void</span><span class=o>*</span><span class=w> </span><span class=n>event_data</span><span class=p>)</span>
</span><span id=__span-15-87><a id=__codelineno-15-87 name=__codelineno-15-87 href=#__codelineno-15-87></a><span class=p>{</span>
</span><span id=__span-15-88><a id=__codelineno-15-88 name=__codelineno-15-88 href=#__codelineno-15-88></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT_STA_START</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-89><a id=__codelineno-15-89 name=__codelineno-15-89 href=#__codelineno-15-89></a><span class=w>        </span><span class=n>esp_wifi_connect</span><span class=p>();</span>
</span><span id=__span-15-90><a id=__codelineno-15-90 name=__codelineno-15-90 href=#__codelineno-15-90></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT_STA_DISCONNECTED</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-91><a id=__codelineno-15-91 name=__codelineno-15-91 href=#__codelineno-15-91></a><span class=w>        </span><span class=n>esp_wifi_connect</span><span class=p>();</span>
</span><span id=__span-15-92><a id=__codelineno-15-92 name=__codelineno-15-92 href=#__codelineno-15-92></a><span class=w>        </span><span class=n>xEventGroupClearBits</span><span class=p>(</span><span class=n>wifi_event_group</span><span class=p>,</span><span class=w> </span><span class=n>CONNECTED_BIT</span><span class=p>);</span>
</span><span id=__span-15-93><a id=__codelineno-15-93 name=__codelineno-15-93 href=#__codelineno-15-93></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT_STA_GOT_IP</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-94><a id=__codelineno-15-94 name=__codelineno-15-94 href=#__codelineno-15-94></a><span class=w>        </span><span class=n>xEventGroupSetBits</span><span class=p>(</span><span class=n>wifi_event_group</span><span class=p>,</span><span class=w> </span><span class=n>CONNECTED_BIT</span><span class=p>);</span>
</span><span id=__span-15-95><a id=__codelineno-15-95 name=__codelineno-15-95 href=#__codelineno-15-95></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-15-96><a id=__codelineno-15-96 name=__codelineno-15-96 href=#__codelineno-15-96></a><span class=p>}</span>
</span><span id=__span-15-97><a id=__codelineno-15-97 name=__codelineno-15-97 href=#__codelineno-15-97></a>
</span><span id=__span-15-98><a id=__codelineno-15-98 name=__codelineno-15-98 href=#__codelineno-15-98></a><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>initialise_wifi</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span><span id=__span-15-99><a id=__codelineno-15-99 name=__codelineno-15-99 href=#__codelineno-15-99></a><span class=p>{</span>
</span><span id=__span-15-100><a id=__codelineno-15-100 name=__codelineno-15-100 href=#__codelineno-15-100></a><span class=cp>#ifdef CONFIG_EXAMPLE_VALIDATE_SERVER_CERT</span>
</span><span id=__span-15-101><a id=__codelineno-15-101 name=__codelineno-15-101 href=#__codelineno-15-101></a><span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>ca_pem_bytes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ca_pem_end</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>ca_pem_start</span><span class=p>;</span>
</span><span id=__span-15-102><a id=__codelineno-15-102 name=__codelineno-15-102 href=#__codelineno-15-102></a><span class=cp>#endif </span><span class=cm>/* CONFIG_EXAMPLE_VALIDATE_SERVER_CERT */</span>
</span><span id=__span-15-103><a id=__codelineno-15-103 name=__codelineno-15-103 href=#__codelineno-15-103></a>
</span><span id=__span-15-104><a id=__codelineno-15-104 name=__codelineno-15-104 href=#__codelineno-15-104></a><span class=cp>#ifdef CONFIG_EXAMPLE_EAP_METHOD_TLS</span>
</span><span id=__span-15-105><a id=__codelineno-15-105 name=__codelineno-15-105 href=#__codelineno-15-105></a><span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>client_crt_bytes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>client_crt_end</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>client_crt_start</span><span class=p>;</span>
</span><span id=__span-15-106><a id=__codelineno-15-106 name=__codelineno-15-106 href=#__codelineno-15-106></a><span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>client_key_bytes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>client_key_end</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>client_key_start</span><span class=p>;</span>
</span><span id=__span-15-107><a id=__codelineno-15-107 name=__codelineno-15-107 href=#__codelineno-15-107></a><span class=cp>#endif </span><span class=cm>/* CONFIG_EXAMPLE_EAP_METHOD_TLS */</span>
</span><span id=__span-15-108><a id=__codelineno-15-108 name=__codelineno-15-108 href=#__codelineno-15-108></a>
</span><span id=__span-15-109><a id=__codelineno-15-109 name=__codelineno-15-109 href=#__codelineno-15-109></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_netif_init</span><span class=p>());</span>
</span><span id=__span-15-110><a id=__codelineno-15-110 name=__codelineno-15-110 href=#__codelineno-15-110></a><span class=w>    </span><span class=n>wifi_event_group</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>xEventGroupCreate</span><span class=p>();</span>
</span><span id=__span-15-111><a id=__codelineno-15-111 name=__codelineno-15-111 href=#__codelineno-15-111></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_loop_create_default</span><span class=p>());</span>
</span><span id=__span-15-112><a id=__codelineno-15-112 name=__codelineno-15-112 href=#__codelineno-15-112></a><span class=w>    </span><span class=n>sta_netif</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>esp_netif_create_default_wifi_sta</span><span class=p>();</span>
</span><span id=__span-15-113><a id=__codelineno-15-113 name=__codelineno-15-113 href=#__codelineno-15-113></a><span class=w>    </span><span class=n>assert</span><span class=p>(</span><span class=n>sta_netif</span><span class=p>);</span>
</span><span id=__span-15-114><a id=__codelineno-15-114 name=__codelineno-15-114 href=#__codelineno-15-114></a>
</span><span id=__span-15-115><a id=__codelineno-15-115 name=__codelineno-15-115 href=#__codelineno-15-115></a><span class=w>    </span><span class=n>wifi_init_config_t</span><span class=w> </span><span class=n>cfg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WIFI_INIT_CONFIG_DEFAULT</span><span class=p>();</span>
</span><span id=__span-15-116><a id=__codelineno-15-116 name=__codelineno-15-116 href=#__codelineno-15-116></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_init</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cfg</span><span class=p>)</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-117><a id=__codelineno-15-117 name=__codelineno-15-117 href=#__codelineno-15-117></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_event_handler_register</span><span class=p>(</span><span class=n>WIFI_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>ESP_EVENT_ANY_ID</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>event_handler</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>)</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-118><a id=__codelineno-15-118 name=__codelineno-15-118 href=#__codelineno-15-118></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_event_handler_register</span><span class=p>(</span><span class=n>IP_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>IP_EVENT_STA_GOT_IP</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>event_handler</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>)</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-119><a id=__codelineno-15-119 name=__codelineno-15-119 href=#__codelineno-15-119></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_set_storage</span><span class=p>(</span><span class=n>WIFI_STORAGE_RAM</span><span class=p>)</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-120><a id=__codelineno-15-120 name=__codelineno-15-120 href=#__codelineno-15-120></a><span class=w>    </span><span class=n>wifi_config_t</span><span class=w> </span><span class=n>wifi_config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-121><a id=__codelineno-15-121 name=__codelineno-15-121 href=#__codelineno-15-121></a><span class=w>        </span><span class=p>.</span><span class=n>sta</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-122><a id=__codelineno-15-122 name=__codelineno-15-122 href=#__codelineno-15-122></a><span class=w>            </span><span class=p>.</span><span class=n>ssid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>EXAMPLE_WIFI_SSID</span><span class=p>,</span>
</span><span id=__span-15-123><a id=__codelineno-15-123 name=__codelineno-15-123 href=#__codelineno-15-123></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-15-124><a id=__codelineno-15-124 name=__codelineno-15-124 href=#__codelineno-15-124></a><span class=w>    </span><span class=p>};</span>
</span><span id=__span-15-125><a id=__codelineno-15-125 name=__codelineno-15-125 href=#__codelineno-15-125></a><span class=w>    </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Setting WiFi configuration SSID %s...&quot;</span><span class=p>,</span><span class=w> </span><span class=n>wifi_config</span><span class=p>.</span><span class=n>sta</span><span class=p>.</span><span class=n>ssid</span><span class=p>);</span>
</span><span id=__span-15-126><a id=__codelineno-15-126 name=__codelineno-15-126 href=#__codelineno-15-126></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_set_mode</span><span class=p>(</span><span class=n>WIFI_MODE_STA</span><span class=p>)</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-127><a id=__codelineno-15-127 name=__codelineno-15-127 href=#__codelineno-15-127></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_set_config</span><span class=p>(</span><span class=n>ESP_IF_WIFI_STA</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>wifi_config</span><span class=p>)</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-128><a id=__codelineno-15-128 name=__codelineno-15-128 href=#__codelineno-15-128></a><span class=w>    </span><span class=c1>// ESP_ERROR_CHECK( esp_wifi_sta_wpa2_ent_set_identity((uint8_t *)EXAMPLE_EAP_ID, strlen(EXAMPLE_EAP_ID)) );</span>
</span><span id=__span-15-129><a id=__codelineno-15-129 name=__codelineno-15-129 href=#__codelineno-15-129></a>
</span><span id=__span-15-130><a id=__codelineno-15-130 name=__codelineno-15-130 href=#__codelineno-15-130></a><span class=cp>#ifdef CONFIG_EXAMPLE_VALIDATE_SERVER_CERT</span>
</span><span id=__span-15-131><a id=__codelineno-15-131 name=__codelineno-15-131 href=#__codelineno-15-131></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_sta_wpa2_ent_set_ca_cert</span><span class=p>(</span><span class=n>ca_pem_start</span><span class=p>,</span><span class=w> </span><span class=n>ca_pem_bytes</span><span class=p>)</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-132><a id=__codelineno-15-132 name=__codelineno-15-132 href=#__codelineno-15-132></a><span class=cp>#endif </span><span class=cm>/* CONFIG_EXAMPLE_VALIDATE_SERVER_CERT */</span>
</span><span id=__span-15-133><a id=__codelineno-15-133 name=__codelineno-15-133 href=#__codelineno-15-133></a>
</span><span id=__span-15-134><a id=__codelineno-15-134 name=__codelineno-15-134 href=#__codelineno-15-134></a><span class=cp>#ifdef CONFIG_EXAMPLE_EAP_METHOD_TLS</span>
</span><span id=__span-15-135><a id=__codelineno-15-135 name=__codelineno-15-135 href=#__codelineno-15-135></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_sta_wpa2_ent_set_cert_key</span><span class=p>(</span><span class=n>client_crt_start</span><span class=p>,</span><span class=w> </span><span class=n>client_crt_bytes</span><span class=p>,</span>\
</span><span id=__span-15-136><a id=__codelineno-15-136 name=__codelineno-15-136 href=#__codelineno-15-136></a><span class=w>            </span><span class=n>client_key_start</span><span class=p>,</span><span class=w> </span><span class=n>client_key_bytes</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-137><a id=__codelineno-15-137 name=__codelineno-15-137 href=#__codelineno-15-137></a><span class=cp>#endif </span><span class=cm>/* CONFIG_EXAMPLE_EAP_METHOD_TLS */</span>
</span><span id=__span-15-138><a id=__codelineno-15-138 name=__codelineno-15-138 href=#__codelineno-15-138></a>
</span><span id=__span-15-139><a id=__codelineno-15-139 name=__codelineno-15-139 href=#__codelineno-15-139></a><span class=cp>#if defined CONFIG_EXAMPLE_EAP_METHOD_PEAP || CONFIG_EXAMPLE_EAP_METHOD_TTLS</span>
</span><span id=__span-15-140><a id=__codelineno-15-140 name=__codelineno-15-140 href=#__codelineno-15-140></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_sta_wpa2_ent_set_username</span><span class=p>((</span><span class=kt>uint8_t</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=n>EXAMPLE_EAP_USERNAME</span><span class=p>,</span><span class=w> </span><span class=n>strlen</span><span class=p>(</span><span class=n>EXAMPLE_EAP_USERNAME</span><span class=p>))</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-141><a id=__codelineno-15-141 name=__codelineno-15-141 href=#__codelineno-15-141></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_sta_wpa2_ent_set_password</span><span class=p>((</span><span class=kt>uint8_t</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=n>EXAMPLE_EAP_PASSWORD</span><span class=p>,</span><span class=w> </span><span class=n>strlen</span><span class=p>(</span><span class=n>EXAMPLE_EAP_PASSWORD</span><span class=p>))</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-142><a id=__codelineno-15-142 name=__codelineno-15-142 href=#__codelineno-15-142></a><span class=cp>#endif </span><span class=cm>/* CONFIG_EXAMPLE_EAP_METHOD_PEAP || CONFIG_EXAMPLE_EAP_METHOD_TTLS */</span>
</span><span id=__span-15-143><a id=__codelineno-15-143 name=__codelineno-15-143 href=#__codelineno-15-143></a>
</span><span id=__span-15-144><a id=__codelineno-15-144 name=__codelineno-15-144 href=#__codelineno-15-144></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_sta_wpa2_ent_enable</span><span class=p>()</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-145><a id=__codelineno-15-145 name=__codelineno-15-145 href=#__codelineno-15-145></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_start</span><span class=p>()</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-146><a id=__codelineno-15-146 name=__codelineno-15-146 href=#__codelineno-15-146></a><span class=p>}</span>
</span><span id=__span-15-147><a id=__codelineno-15-147 name=__codelineno-15-147 href=#__codelineno-15-147></a>
</span><span id=__span-15-148><a id=__codelineno-15-148 name=__codelineno-15-148 href=#__codelineno-15-148></a><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>wpa2_enterprise_example_task</span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>pvParameters</span><span class=p>)</span>
</span><span id=__span-15-149><a id=__codelineno-15-149 name=__codelineno-15-149 href=#__codelineno-15-149></a><span class=p>{</span>
</span><span id=__span-15-150><a id=__codelineno-15-150 name=__codelineno-15-150 href=#__codelineno-15-150></a><span class=w>    </span><span class=n>esp_netif_ip_info_t</span><span class=w> </span><span class=n>ip</span><span class=p>;</span>
</span><span id=__span-15-151><a id=__codelineno-15-151 name=__codelineno-15-151 href=#__codelineno-15-151></a><span class=w>    </span><span class=n>memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ip</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>esp_netif_ip_info_t</span><span class=p>));</span>
</span><span id=__span-15-152><a id=__codelineno-15-152 name=__codelineno-15-152 href=#__codelineno-15-152></a><span class=w>    </span><span class=n>vTaskDelay</span><span class=p>(</span><span class=mi>2000</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>portTICK_PERIOD_MS</span><span class=p>);</span>
</span><span id=__span-15-153><a id=__codelineno-15-153 name=__codelineno-15-153 href=#__codelineno-15-153></a>
</span><span id=__span-15-154><a id=__codelineno-15-154 name=__codelineno-15-154 href=#__codelineno-15-154></a><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-155><a id=__codelineno-15-155 name=__codelineno-15-155 href=#__codelineno-15-155></a><span class=w>        </span><span class=n>vTaskDelay</span><span class=p>(</span><span class=mi>2000</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>portTICK_PERIOD_MS</span><span class=p>);</span>
</span><span id=__span-15-156><a id=__codelineno-15-156 name=__codelineno-15-156 href=#__codelineno-15-156></a>
</span><span id=__span-15-157><a id=__codelineno-15-157 name=__codelineno-15-157 href=#__codelineno-15-157></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>esp_netif_get_ip_info</span><span class=p>(</span><span class=n>sta_netif</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>ip</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-158><a id=__codelineno-15-158 name=__codelineno-15-158 href=#__codelineno-15-158></a><span class=w>            </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span><span class=w> </span><span class=s>&quot;~~~~~~~~~~~&quot;</span><span class=p>);</span>
</span><span id=__span-15-159><a id=__codelineno-15-159 name=__codelineno-15-159 href=#__codelineno-15-159></a><span class=w>            </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span><span class=w> </span><span class=s>&quot;IP:&quot;</span><span class=n>IPSTR</span><span class=p>,</span><span class=w> </span><span class=n>IP2STR</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ip</span><span class=p>.</span><span class=n>ip</span><span class=p>));</span>
</span><span id=__span-15-160><a id=__codelineno-15-160 name=__codelineno-15-160 href=#__codelineno-15-160></a><span class=w>            </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span><span class=w> </span><span class=s>&quot;MASK:&quot;</span><span class=n>IPSTR</span><span class=p>,</span><span class=w> </span><span class=n>IP2STR</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ip</span><span class=p>.</span><span class=n>netmask</span><span class=p>));</span>
</span><span id=__span-15-161><a id=__codelineno-15-161 name=__codelineno-15-161 href=#__codelineno-15-161></a><span class=w>            </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span><span class=w> </span><span class=s>&quot;GW:&quot;</span><span class=n>IPSTR</span><span class=p>,</span><span class=w> </span><span class=n>IP2STR</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ip</span><span class=p>.</span><span class=n>gw</span><span class=p>));</span>
</span><span id=__span-15-162><a id=__codelineno-15-162 name=__codelineno-15-162 href=#__codelineno-15-162></a><span class=w>            </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span><span class=w> </span><span class=s>&quot;~~~~~~~~~~~&quot;</span><span class=p>);</span>
</span><span id=__span-15-163><a id=__codelineno-15-163 name=__codelineno-15-163 href=#__codelineno-15-163></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-15-164><a id=__codelineno-15-164 name=__codelineno-15-164 href=#__codelineno-15-164></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-15-165><a id=__codelineno-15-165 name=__codelineno-15-165 href=#__codelineno-15-165></a><span class=p>}</span>
</span><span id=__span-15-166><a id=__codelineno-15-166 name=__codelineno-15-166 href=#__codelineno-15-166></a>
</span><span id=__span-15-167><a id=__codelineno-15-167 name=__codelineno-15-167 href=#__codelineno-15-167></a><span class=kt>void</span><span class=w> </span><span class=nf>app_main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span><span id=__span-15-168><a id=__codelineno-15-168 name=__codelineno-15-168 href=#__codelineno-15-168></a><span class=p>{</span>
</span><span id=__span-15-169><a id=__codelineno-15-169 name=__codelineno-15-169 href=#__codelineno-15-169></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>()</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-170><a id=__codelineno-15-170 name=__codelineno-15-170 href=#__codelineno-15-170></a><span class=w>    </span><span class=n>initialise_wifi</span><span class=p>();</span>
</span><span id=__span-15-171><a id=__codelineno-15-171 name=__codelineno-15-171 href=#__codelineno-15-171></a><span class=w>    </span><span class=n>xTaskCreate</span><span class=p>(</span><span class=o>&amp;</span><span class=n>wpa2_enterprise_example_task</span><span class=p>,</span><span class=w> </span><span class=s>&quot;wpa2_enterprise_example_task&quot;</span><span class=p>,</span><span class=w> </span><span class=mi>4096</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>);</span>
</span><span id=__span-15-172><a id=__codelineno-15-172 name=__codelineno-15-172 href=#__codelineno-15-172></a><span class=p>}</span>
</span></code></pre></div> <p>效果如图所示：</p> <p><img alt src=../../../../COMMUNICATION/WIFI/csw-wifi.png></p> <!-- ### 3.3 WIFI配置静态IP

代码链接：

> https://github.com/DuRuofu/ESP32_Learning/tree/master/05.wifi/wifi_sta_static_ip

<div class="language-c highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="cp">#includ &lt; stdio.h&gt;</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;freertos/FreeRTOS.h&quot;</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;freertos/event_groups.h&quot;</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_wifi.h&quot;</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_log.h&quot;</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_event.h&quot;</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;nvs_flash.h&quot;</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_mac.h&quot;</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_netif.h&quot;</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;lwip/inet.h&quot;</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="cp">#define ESP_WIFI_STA_SSID &quot;CSW@CEE&quot;</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="cp">#define ESP_WIFI_STA_PASSWD &quot;88888888&quot;</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="kt">void</span><span class="w"> </span><span class="nf">WIFI_CallBack</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">event_handler_arg</span><span class="p">,</span><span class="w"> </span><span class="n">esp_event_base_t</span><span class="w"> </span><span class="n">event_base</span><span class="p">,</span><span class="w"> </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">event_id</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">event_data</span><span class="p">)</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="p">{</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">connect_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="w">    </span><span class="c1">// WIFI 启动成功</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event_base</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WIFI_EVENT</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">event_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WIFI_EVENT_STA_START</span><span class="p">)</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="s">&quot;WIFI_EVENT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WIFI_EVENT_STA_START&quot;</span><span class="p">);</span>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="w">        </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_connect</span><span class="p">());</span>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="w">    </span><span class="c1">// WIFI 连接失败</span>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event_base</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WIFI_EVENT</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">event_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WIFI_EVENT_STA_DISCONNECTED</span><span class="p">)</span>
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="s">&quot;WIFI_EVENT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WIFI_EVENT_STA_DISCONNECTED&quot;</span><span class="p">);</span>
</span><span id="__span-16-29"><a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="w">        </span><span class="n">connect_count</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-16-30"><a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">connect_count</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span>
</span><span id="__span-16-31"><a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-16-32"><a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a><span class="w">            </span><span class="n">vTaskDelay</span><span class="p">(</span><span class="mi">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">portTICK_PERIOD_MS</span><span class="p">);</span>
</span><span id="__span-16-33"><a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a><span class="w">            </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_connect</span><span class="p">());</span>
</span><span id="__span-16-34"><a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-16-35"><a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a><span class="w">        </span><span class="k">else</span>
</span><span id="__span-16-36"><a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-16-37"><a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a><span class="w">            </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="s">&quot;WIFI_EVENT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WIFI_EVENT_STA_DISCONNECTED 10 times&quot;</span><span class="p">);</span>
</span><span id="__span-16-38"><a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-16-39"><a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-40"><a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a><span class="w">    </span><span class="c1">// WIFI 连接成功(获取到了IP)</span>
</span><span id="__span-16-41"><a id="__codelineno-16-41" name="__codelineno-16-41" href="#__codelineno-16-41"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event_base</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">IP_EVENT</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">event_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">IP_EVENT_STA_GOT_IP</span><span class="p">)</span>
</span><span id="__span-16-42"><a id="__codelineno-16-42" name="__codelineno-16-42" href="#__codelineno-16-42"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-16-43"><a id="__codelineno-16-43" name="__codelineno-16-43" href="#__codelineno-16-43"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="s">&quot;WIFI_EVENT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WIFI_EVENT_STA_GOT_IP&quot;</span><span class="p">);</span>
</span><span id="__span-16-44"><a id="__codelineno-16-44" name="__codelineno-16-44" href="#__codelineno-16-44"></a><span class="w">        </span><span class="n">ip_event_got_ip_t</span><span class="w"> </span><span class="o">*</span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ip_event_got_ip_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">event_data</span><span class="p">;</span>
</span><span id="__span-16-45"><a id="__codelineno-16-45" name="__codelineno-16-45" href="#__codelineno-16-45"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="s">&quot;WIFI_EVENT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;got ip:&quot;</span><span class="w"> </span><span class="n">IPSTR</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">IP2STR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">ip_info</span><span class="p">.</span><span class="n">ip</span><span class="p">));</span>
</span><span id="__span-16-46"><a id="__codelineno-16-46" name="__codelineno-16-46" href="#__codelineno-16-46"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-47"><a id="__codelineno-16-47" name="__codelineno-16-47" href="#__codelineno-16-47"></a><span class="p">}</span>
</span><span id="__span-16-48"><a id="__codelineno-16-48" name="__codelineno-16-48" href="#__codelineno-16-48"></a>
</span><span id="__span-16-49"><a id="__codelineno-16-49" name="__codelineno-16-49" href="#__codelineno-16-49"></a><span class="kt">void</span><span class="w"> </span><span class="nf">app_main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span id="__span-16-50"><a id="__codelineno-16-50" name="__codelineno-16-50" href="#__codelineno-16-50"></a><span class="p">{</span>
</span><span id="__span-16-51"><a id="__codelineno-16-51" name="__codelineno-16-51" href="#__codelineno-16-51"></a><span class="w">    </span><span class="c1">//----------------准备阶段-------------------</span>
</span><span id="__span-16-52"><a id="__codelineno-16-52" name="__codelineno-16-52" href="#__codelineno-16-52"></a><span class="w">    </span><span class="c1">// Initialize NVS</span>
</span><span id="__span-16-53"><a id="__codelineno-16-53" name="__codelineno-16-53" href="#__codelineno-16-53"></a><span class="w">    </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvs_flash_init</span><span class="p">();</span>
</span><span id="__span-16-54"><a id="__codelineno-16-54" name="__codelineno-16-54" href="#__codelineno-16-54"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_ERR_NVS_NO_FREE_PAGES</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_ERR_NVS_NEW_VERSION_FOUND</span><span class="p">)</span>
</span><span id="__span-16-55"><a id="__codelineno-16-55" name="__codelineno-16-55" href="#__codelineno-16-55"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-16-56"><a id="__codelineno-16-56" name="__codelineno-16-56" href="#__codelineno-16-56"></a><span class="w">        </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">nvs_flash_erase</span><span class="p">());</span>
</span><span id="__span-16-57"><a id="__codelineno-16-57" name="__codelineno-16-57" href="#__codelineno-16-57"></a><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvs_flash_init</span><span class="p">();</span>
</span><span id="__span-16-58"><a id="__codelineno-16-58" name="__codelineno-16-58" href="#__codelineno-16-58"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-59"><a id="__codelineno-16-59" name="__codelineno-16-59" href="#__codelineno-16-59"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
</span><span id="__span-16-60"><a id="__codelineno-16-60" name="__codelineno-16-60" href="#__codelineno-16-60"></a>
</span><span id="__span-16-61"><a id="__codelineno-16-61" name="__codelineno-16-61" href="#__codelineno-16-61"></a><span class="w">    </span><span class="c1">//----------------初始化阶段-------------------</span>
</span><span id="__span-16-62"><a id="__codelineno-16-62" name="__codelineno-16-62" href="#__codelineno-16-62"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_netif_init</span><span class="p">());</span>
</span><span id="__span-16-63"><a id="__codelineno-16-63" name="__codelineno-16-63" href="#__codelineno-16-63"></a>
</span><span id="__span-16-64"><a id="__codelineno-16-64" name="__codelineno-16-64" href="#__codelineno-16-64"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_event_loop_create_default</span><span class="p">());</span>
</span><span id="__span-16-65"><a id="__codelineno-16-65" name="__codelineno-16-65" href="#__codelineno-16-65"></a><span class="w">    </span><span class="c1">// 注册事件(wifi启动成功)</span>
</span><span id="__span-16-66"><a id="__codelineno-16-66" name="__codelineno-16-66" href="#__codelineno-16-66"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_event_handler_instance_register</span><span class="p">(</span><span class="n">WIFI_EVENT</span><span class="p">,</span><span class="w"> </span><span class="n">WIFI_EVENT_STA_START</span><span class="p">,</span><span class="w"> </span><span class="n">WIFI_CallBack</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">));</span>
</span><span id="__span-16-67"><a id="__codelineno-16-67" name="__codelineno-16-67" href="#__codelineno-16-67"></a><span class="w">    </span><span class="c1">// 注册事件(wifi连接失败)</span>
</span><span id="__span-16-68"><a id="__codelineno-16-68" name="__codelineno-16-68" href="#__codelineno-16-68"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_event_handler_instance_register</span><span class="p">(</span><span class="n">WIFI_EVENT</span><span class="p">,</span><span class="w"> </span><span class="n">WIFI_EVENT_STA_DISCONNECTED</span><span class="p">,</span><span class="w"> </span><span class="n">WIFI_CallBack</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">));</span>
</span><span id="__span-16-69"><a id="__codelineno-16-69" name="__codelineno-16-69" href="#__codelineno-16-69"></a><span class="w">    </span><span class="c1">// 注册事件(wifi连接失败)</span>
</span><span id="__span-16-70"><a id="__codelineno-16-70" name="__codelineno-16-70" href="#__codelineno-16-70"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_event_handler_instance_register</span><span class="p">(</span><span class="n">IP_EVENT</span><span class="p">,</span><span class="w"> </span><span class="n">IP_EVENT_STA_GOT_IP</span><span class="p">,</span><span class="w"> </span><span class="n">WIFI_CallBack</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">));</span>
</span><span id="__span-16-71"><a id="__codelineno-16-71" name="__codelineno-16-71" href="#__codelineno-16-71"></a>
</span><span id="__span-16-72"><a id="__codelineno-16-72" name="__codelineno-16-72" href="#__codelineno-16-72"></a><span class="w">    </span><span class="c1">// 初始化STA设备</span>
</span><span id="__span-16-73"><a id="__codelineno-16-73" name="__codelineno-16-73" href="#__codelineno-16-73"></a><span class="w">    </span><span class="n">esp_netif_t</span><span class="w"> </span><span class="o">*</span><span class="n">esp_netif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_netif_create_default_wifi_sta</span><span class="p">();</span>
</span><span id="__span-16-74"><a id="__codelineno-16-74" name="__codelineno-16-74" href="#__codelineno-16-74"></a>
</span><span id="__span-16-75"><a id="__codelineno-16-75" name="__codelineno-16-75" href="#__codelineno-16-75"></a><span class="w">    </span><span class="c1">// ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span>
</span><span id="__span-16-76"><a id="__codelineno-16-76" name="__codelineno-16-76" href="#__codelineno-16-76"></a><span class="w">    </span><span class="c1">//*******************配置静态IP*************************</span>
</span><span id="__span-16-77"><a id="__codelineno-16-77" name="__codelineno-16-77" href="#__codelineno-16-77"></a><span class="w">    </span><span class="n">esp_netif_dhcpc_stop</span><span class="p">(</span><span class="n">esp_netif</span><span class="p">);</span>
</span><span id="__span-16-78"><a id="__codelineno-16-78" name="__codelineno-16-78" href="#__codelineno-16-78"></a><span class="w">    </span><span class="n">esp_netif_ip_info_t</span><span class="w"> </span><span class="n">ipInfo</span><span class="p">;</span>
</span><span id="__span-16-79"><a id="__codelineno-16-79" name="__codelineno-16-79" href="#__codelineno-16-79"></a><span class="w">    </span><span class="n">ipInfo</span><span class="p">.</span><span class="n">ip</span><span class="p">.</span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inet_addr</span><span class="p">(</span><span class="s">&quot;192.168.138.2&quot;</span><span class="p">);</span>
</span><span id="__span-16-80"><a id="__codelineno-16-80" name="__codelineno-16-80" href="#__codelineno-16-80"></a><span class="w">    </span><span class="n">ipInfo</span><span class="p">.</span><span class="n">netmask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inet_addr</span><span class="p">(</span><span class="s">&quot;255.255.255.0&quot;</span><span class="p">);</span>
</span><span id="__span-16-81"><a id="__codelineno-16-81" name="__codelineno-16-81" href="#__codelineno-16-81"></a><span class="w">    </span><span class="n">ipInfo</span><span class="p">.</span><span class="n">gw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inet_addr</span><span class="p">(</span><span class="s">&quot;192.168.138.2&quot;</span><span class="p">);</span>
</span><span id="__span-16-82"><a id="__codelineno-16-82" name="__codelineno-16-82" href="#__codelineno-16-82"></a>
</span><span id="__span-16-83"><a id="__codelineno-16-83" name="__codelineno-16-83" href="#__codelineno-16-83"></a><span class="w">    </span><span class="n">esp_netif_set_ip_info</span><span class="p">(</span><span class="n">esp_netif</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ipInfo</span><span class="p">);</span>
</span><span id="__span-16-84"><a id="__codelineno-16-84" name="__codelineno-16-84" href="#__codelineno-16-84"></a><span class="w">    </span><span class="n">esp_netif_dhcpc_start</span><span class="p">(</span><span class="n">esp_netif</span><span class="p">);</span>
</span><span id="__span-16-85"><a id="__codelineno-16-85" name="__codelineno-16-85" href="#__codelineno-16-85"></a><span class="w">    </span><span class="c1">//*******************配置静态IP*************************</span>
</span><span id="__span-16-86"><a id="__codelineno-16-86" name="__codelineno-16-86" href="#__codelineno-16-86"></a><span class="w">    </span><span class="c1">// ↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span>
</span><span id="__span-16-87"><a id="__codelineno-16-87" name="__codelineno-16-87" href="#__codelineno-16-87"></a>
</span><span id="__span-16-88"><a id="__codelineno-16-88" name="__codelineno-16-88" href="#__codelineno-16-88"></a><span class="w">    </span><span class="cm">/*Initialize WiFi */</span>
</span><span id="__span-16-89"><a id="__codelineno-16-89" name="__codelineno-16-89" href="#__codelineno-16-89"></a><span class="w">    </span><span class="n">wifi_init_config_t</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WIFI_INIT_CONFIG_DEFAULT</span><span class="p">();</span>
</span><span id="__span-16-90"><a id="__codelineno-16-90" name="__codelineno-16-90" href="#__codelineno-16-90"></a><span class="w">    </span><span class="c1">// WIFI_INIT_CONFIG_DEFAULT 是一个默认配置的宏</span>
</span><span id="__span-16-91"><a id="__codelineno-16-91" name="__codelineno-16-91" href="#__codelineno-16-91"></a>
</span><span id="__span-16-92"><a id="__codelineno-16-92" name="__codelineno-16-92" href="#__codelineno-16-92"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cfg</span><span class="p">));</span>
</span><span id="__span-16-93"><a id="__codelineno-16-93" name="__codelineno-16-93" href="#__codelineno-16-93"></a>
</span><span id="__span-16-94"><a id="__codelineno-16-94" name="__codelineno-16-94" href="#__codelineno-16-94"></a><span class="w">    </span><span class="c1">//----------------配置阶段-------------------</span>
</span><span id="__span-16-95"><a id="__codelineno-16-95" name="__codelineno-16-95" href="#__codelineno-16-95"></a><span class="w">    </span><span class="c1">// 设置为STA模式</span>
</span><span id="__span-16-96"><a id="__codelineno-16-96" name="__codelineno-16-96" href="#__codelineno-16-96"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_set_mode</span><span class="p">(</span><span class="n">WIFI_MODE_STA</span><span class="p">));</span>
</span><span id="__span-16-97"><a id="__codelineno-16-97" name="__codelineno-16-97" href="#__codelineno-16-97"></a>
</span><span id="__span-16-98"><a id="__codelineno-16-98" name="__codelineno-16-98" href="#__codelineno-16-98"></a><span class="w">    </span><span class="c1">// STA详细配置</span>
</span><span id="__span-16-99"><a id="__codelineno-16-99" name="__codelineno-16-99" href="#__codelineno-16-99"></a><span class="w">    </span><span class="n">wifi_config_t</span><span class="w"> </span><span class="n">sta_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-100"><a id="__codelineno-16-100" name="__codelineno-16-100" href="#__codelineno-16-100"></a><span class="w">        </span><span class="p">.</span><span class="n">sta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-101"><a id="__codelineno-16-101" name="__codelineno-16-101" href="#__codelineno-16-101"></a><span class="w">            </span><span class="p">.</span><span class="n">ssid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_WIFI_STA_SSID</span><span class="p">,</span>
</span><span id="__span-16-102"><a id="__codelineno-16-102" name="__codelineno-16-102" href="#__codelineno-16-102"></a><span class="w">            </span><span class="p">.</span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_WIFI_STA_PASSWD</span><span class="p">,</span>
</span><span id="__span-16-103"><a id="__codelineno-16-103" name="__codelineno-16-103" href="#__codelineno-16-103"></a><span class="w">            </span><span class="p">.</span><span class="n">bssid_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span>
</span><span id="__span-16-104"><a id="__codelineno-16-104" name="__codelineno-16-104" href="#__codelineno-16-104"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-16-105"><a id="__codelineno-16-105" name="__codelineno-16-105" href="#__codelineno-16-105"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-16-106"><a id="__codelineno-16-106" name="__codelineno-16-106" href="#__codelineno-16-106"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_set_config</span><span class="p">(</span><span class="n">WIFI_IF_STA</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sta_config</span><span class="p">));</span>
</span><span id="__span-16-107"><a id="__codelineno-16-107" name="__codelineno-16-107" href="#__codelineno-16-107"></a>
</span><span id="__span-16-108"><a id="__codelineno-16-108" name="__codelineno-16-108" href="#__codelineno-16-108"></a><span class="w">    </span><span class="c1">//----------------启动阶段-------------------</span>
</span><span id="__span-16-109"><a id="__codelineno-16-109" name="__codelineno-16-109" href="#__codelineno-16-109"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_start</span><span class="p">());</span>
</span><span id="__span-16-110"><a id="__codelineno-16-110" name="__codelineno-16-110" href="#__codelineno-16-110"></a>
</span><span id="__span-16-111"><a id="__codelineno-16-111" name="__codelineno-16-111" href="#__codelineno-16-111"></a><span class="w">    </span><span class="c1">//----------------配置省电模式-------------------</span>
</span><span id="__span-16-112"><a id="__codelineno-16-112" name="__codelineno-16-112" href="#__codelineno-16-112"></a><span class="w">    </span><span class="c1">// 不省电(数据传输会更快)</span>
</span><span id="__span-16-113"><a id="__codelineno-16-113" name="__codelineno-16-113" href="#__codelineno-16-113"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_set_ps</span><span class="p">(</span><span class="n">WIFI_PS_NONE</span><span class="p">));</span>
</span><span id="__span-16-114"><a id="__codelineno-16-114" name="__codelineno-16-114" href="#__codelineno-16-114"></a><span class="p">}</span>
</span></code></pre></div>

### 3.4 WIFI Scan

代码链接：

> https://github.com/DuRuofu/ESP32_Learning/tree/master/05.wifi/wifi_scan


<div class="language-c highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="cp">#includ&lt;stdio.h&gt;</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;freertos/FreeRTOS.h&quot;</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;freertos/event_groups.h&quot;</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_wifi.h&quot;</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_log.h&quot;</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_event.h&quot;</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;nvs_flash.h&quot;</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_mac.h&quot;</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_netif.h&quot;</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="cp">#define ESP_WIFI_STA_SSID &quot;CSW@CEE&quot;</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="cp">#define ESP_WIFI_STA_PASSWD &quot;88888888&quot;</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="c1">// 扫面列表大小</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="cp">#define DEFAULT_SCAN_LIST_SIZE 10</span>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">TAG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;wifi_scan&quot;</span><span class="p">;</span>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="c1">// 打印加密模式</span>
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">print_auth_mode</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">authmode</span><span class="p">)</span>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="p">{</span>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">authmode</span><span class="p">)</span>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_OPEN</span><span class="p">:</span>
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_OPEN&quot;</span><span class="p">);</span>
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-28"><a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_OWE</span><span class="p">:</span>
</span><span id="__span-17-29"><a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_OWE&quot;</span><span class="p">);</span>
</span><span id="__span-17-30"><a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-31"><a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_WEP</span><span class="p">:</span>
</span><span id="__span-17-32"><a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_WEP&quot;</span><span class="p">);</span>
</span><span id="__span-17-33"><a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-34"><a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_WPA_PSK</span><span class="p">:</span>
</span><span id="__span-17-35"><a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_WPA_PSK&quot;</span><span class="p">);</span>
</span><span id="__span-17-36"><a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-37"><a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_WPA2_PSK</span><span class="p">:</span>
</span><span id="__span-17-38"><a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_WPA2_PSK&quot;</span><span class="p">);</span>
</span><span id="__span-17-39"><a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-40"><a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_WPA_WPA2_PSK</span><span class="p">:</span>
</span><span id="__span-17-41"><a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_WPA_WPA2_PSK&quot;</span><span class="p">);</span>
</span><span id="__span-17-42"><a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-43"><a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_WPA2_ENTERPRISE</span><span class="p">:</span>
</span><span id="__span-17-44"><a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_WPA2_ENTERPRISE&quot;</span><span class="p">);</span>
</span><span id="__span-17-45"><a id="__codelineno-17-45" name="__codelineno-17-45" href="#__codelineno-17-45"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-46"><a id="__codelineno-17-46" name="__codelineno-17-46" href="#__codelineno-17-46"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_WPA3_PSK</span><span class="p">:</span>
</span><span id="__span-17-47"><a id="__codelineno-17-47" name="__codelineno-17-47" href="#__codelineno-17-47"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_WPA3_PSK&quot;</span><span class="p">);</span>
</span><span id="__span-17-48"><a id="__codelineno-17-48" name="__codelineno-17-48" href="#__codelineno-17-48"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-49"><a id="__codelineno-17-49" name="__codelineno-17-49" href="#__codelineno-17-49"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_WPA2_WPA3_PSK</span><span class="p">:</span>
</span><span id="__span-17-50"><a id="__codelineno-17-50" name="__codelineno-17-50" href="#__codelineno-17-50"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_WPA2_WPA3_PSK&quot;</span><span class="p">);</span>
</span><span id="__span-17-51"><a id="__codelineno-17-51" name="__codelineno-17-51" href="#__codelineno-17-51"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-52"><a id="__codelineno-17-52" name="__codelineno-17-52" href="#__codelineno-17-52"></a><span class="w">    </span><span class="k">default</span><span class="o">:</span>
</span><span id="__span-17-53"><a id="__codelineno-17-53" name="__codelineno-17-53" href="#__codelineno-17-53"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_UNKNOWN&quot;</span><span class="p">);</span>
</span><span id="__span-17-54"><a id="__codelineno-17-54" name="__codelineno-17-54" href="#__codelineno-17-54"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-55"><a id="__codelineno-17-55" name="__codelineno-17-55" href="#__codelineno-17-55"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-56"><a id="__codelineno-17-56" name="__codelineno-17-56" href="#__codelineno-17-56"></a><span class="p">}</span>
</span><span id="__span-17-57"><a id="__codelineno-17-57" name="__codelineno-17-57" href="#__codelineno-17-57"></a>
</span><span id="__span-17-58"><a id="__codelineno-17-58" name="__codelineno-17-58" href="#__codelineno-17-58"></a><span class="c1">// 打印密码类型</span>
</span><span id="__span-17-59"><a id="__codelineno-17-59" name="__codelineno-17-59" href="#__codelineno-17-59"></a><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">print_cipher_type</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pairwise_cipher</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">group_cipher</span><span class="p">)</span>
</span><span id="__span-17-60"><a id="__codelineno-17-60" name="__codelineno-17-60" href="#__codelineno-17-60"></a><span class="p">{</span>
</span><span id="__span-17-61"><a id="__codelineno-17-61" name="__codelineno-17-61" href="#__codelineno-17-61"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">pairwise_cipher</span><span class="p">)</span>
</span><span id="__span-17-62"><a id="__codelineno-17-62" name="__codelineno-17-62" href="#__codelineno-17-62"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-17-63"><a id="__codelineno-17-63" name="__codelineno-17-63" href="#__codelineno-17-63"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_NONE</span><span class="p">:</span>
</span><span id="__span-17-64"><a id="__codelineno-17-64" name="__codelineno-17-64" href="#__codelineno-17-64"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pairwise Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_NONE&quot;</span><span class="p">);</span>
</span><span id="__span-17-65"><a id="__codelineno-17-65" name="__codelineno-17-65" href="#__codelineno-17-65"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-66"><a id="__codelineno-17-66" name="__codelineno-17-66" href="#__codelineno-17-66"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_WEP40</span><span class="p">:</span>
</span><span id="__span-17-67"><a id="__codelineno-17-67" name="__codelineno-17-67" href="#__codelineno-17-67"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pairwise Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_WEP40&quot;</span><span class="p">);</span>
</span><span id="__span-17-68"><a id="__codelineno-17-68" name="__codelineno-17-68" href="#__codelineno-17-68"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-69"><a id="__codelineno-17-69" name="__codelineno-17-69" href="#__codelineno-17-69"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_WEP104</span><span class="p">:</span>
</span><span id="__span-17-70"><a id="__codelineno-17-70" name="__codelineno-17-70" href="#__codelineno-17-70"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pairwise Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_WEP104&quot;</span><span class="p">);</span>
</span><span id="__span-17-71"><a id="__codelineno-17-71" name="__codelineno-17-71" href="#__codelineno-17-71"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-72"><a id="__codelineno-17-72" name="__codelineno-17-72" href="#__codelineno-17-72"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_TKIP</span><span class="p">:</span>
</span><span id="__span-17-73"><a id="__codelineno-17-73" name="__codelineno-17-73" href="#__codelineno-17-73"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pairwise Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_TKIP&quot;</span><span class="p">);</span>
</span><span id="__span-17-74"><a id="__codelineno-17-74" name="__codelineno-17-74" href="#__codelineno-17-74"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-75"><a id="__codelineno-17-75" name="__codelineno-17-75" href="#__codelineno-17-75"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_CCMP</span><span class="p">:</span>
</span><span id="__span-17-76"><a id="__codelineno-17-76" name="__codelineno-17-76" href="#__codelineno-17-76"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pairwise Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_CCMP&quot;</span><span class="p">);</span>
</span><span id="__span-17-77"><a id="__codelineno-17-77" name="__codelineno-17-77" href="#__codelineno-17-77"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-78"><a id="__codelineno-17-78" name="__codelineno-17-78" href="#__codelineno-17-78"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_TKIP_CCMP</span><span class="p">:</span>
</span><span id="__span-17-79"><a id="__codelineno-17-79" name="__codelineno-17-79" href="#__codelineno-17-79"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pairwise Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_TKIP_CCMP&quot;</span><span class="p">);</span>
</span><span id="__span-17-80"><a id="__codelineno-17-80" name="__codelineno-17-80" href="#__codelineno-17-80"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-81"><a id="__codelineno-17-81" name="__codelineno-17-81" href="#__codelineno-17-81"></a><span class="w">    </span><span class="k">default</span><span class="o">:</span>
</span><span id="__span-17-82"><a id="__codelineno-17-82" name="__codelineno-17-82" href="#__codelineno-17-82"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pairwise Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_UNKNOWN&quot;</span><span class="p">);</span>
</span><span id="__span-17-83"><a id="__codelineno-17-83" name="__codelineno-17-83" href="#__codelineno-17-83"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-84"><a id="__codelineno-17-84" name="__codelineno-17-84" href="#__codelineno-17-84"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-85"><a id="__codelineno-17-85" name="__codelineno-17-85" href="#__codelineno-17-85"></a>
</span><span id="__span-17-86"><a id="__codelineno-17-86" name="__codelineno-17-86" href="#__codelineno-17-86"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">group_cipher</span><span class="p">)</span>
</span><span id="__span-17-87"><a id="__codelineno-17-87" name="__codelineno-17-87" href="#__codelineno-17-87"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-17-88"><a id="__codelineno-17-88" name="__codelineno-17-88" href="#__codelineno-17-88"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_NONE</span><span class="p">:</span>
</span><span id="__span-17-89"><a id="__codelineno-17-89" name="__codelineno-17-89" href="#__codelineno-17-89"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Group Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_NONE&quot;</span><span class="p">);</span>
</span><span id="__span-17-90"><a id="__codelineno-17-90" name="__codelineno-17-90" href="#__codelineno-17-90"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-91"><a id="__codelineno-17-91" name="__codelineno-17-91" href="#__codelineno-17-91"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_WEP40</span><span class="p">:</span>
</span><span id="__span-17-92"><a id="__codelineno-17-92" name="__codelineno-17-92" href="#__codelineno-17-92"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Group Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_WEP40&quot;</span><span class="p">);</span>
</span><span id="__span-17-93"><a id="__codelineno-17-93" name="__codelineno-17-93" href="#__codelineno-17-93"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-94"><a id="__codelineno-17-94" name="__codelineno-17-94" href="#__codelineno-17-94"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_WEP104</span><span class="p">:</span>
</span><span id="__span-17-95"><a id="__codelineno-17-95" name="__codelineno-17-95" href="#__codelineno-17-95"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Group Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_WEP104&quot;</span><span class="p">);</span>
</span><span id="__span-17-96"><a id="__codelineno-17-96" name="__codelineno-17-96" href="#__codelineno-17-96"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-97"><a id="__codelineno-17-97" name="__codelineno-17-97" href="#__codelineno-17-97"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_TKIP</span><span class="p">:</span>
</span><span id="__span-17-98"><a id="__codelineno-17-98" name="__codelineno-17-98" href="#__codelineno-17-98"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Group Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_TKIP&quot;</span><span class="p">);</span>
</span><span id="__span-17-99"><a id="__codelineno-17-99" name="__codelineno-17-99" href="#__codelineno-17-99"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-100"><a id="__codelineno-17-100" name="__codelineno-17-100" href="#__codelineno-17-100"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_CCMP</span><span class="p">:</span>
</span><span id="__span-17-101"><a id="__codelineno-17-101" name="__codelineno-17-101" href="#__codelineno-17-101"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Group Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_CCMP&quot;</span><span class="p">);</span>
</span><span id="__span-17-102"><a id="__codelineno-17-102" name="__codelineno-17-102" href="#__codelineno-17-102"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-103"><a id="__codelineno-17-103" name="__codelineno-17-103" href="#__codelineno-17-103"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_TKIP_CCMP</span><span class="p">:</span>
</span><span id="__span-17-104"><a id="__codelineno-17-104" name="__codelineno-17-104" href="#__codelineno-17-104"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Group Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_TKIP_CCMP&quot;</span><span class="p">);</span>
</span><span id="__span-17-105"><a id="__codelineno-17-105" name="__codelineno-17-105" href="#__codelineno-17-105"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-106"><a id="__codelineno-17-106" name="__codelineno-17-106" href="#__codelineno-17-106"></a><span class="w">    </span><span class="k">default</span><span class="o">:</span>
</span><span id="__span-17-107"><a id="__codelineno-17-107" name="__codelineno-17-107" href="#__codelineno-17-107"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Group Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_UNKNOWN&quot;</span><span class="p">);</span>
</span><span id="__span-17-108"><a id="__codelineno-17-108" name="__codelineno-17-108" href="#__codelineno-17-108"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-109"><a id="__codelineno-17-109" name="__codelineno-17-109" href="#__codelineno-17-109"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-110"><a id="__codelineno-17-110" name="__codelineno-17-110" href="#__codelineno-17-110"></a><span class="p">}</span>
</span><span id="__span-17-111"><a id="__codelineno-17-111" name="__codelineno-17-111" href="#__codelineno-17-111"></a>
</span><span id="__span-17-112"><a id="__codelineno-17-112" name="__codelineno-17-112" href="#__codelineno-17-112"></a><span class="kt">void</span><span class="w"> </span><span class="nf">app_main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span id="__span-17-113"><a id="__codelineno-17-113" name="__codelineno-17-113" href="#__codelineno-17-113"></a><span class="p">{</span>
</span><span id="__span-17-114"><a id="__codelineno-17-114" name="__codelineno-17-114" href="#__codelineno-17-114"></a><span class="w">    </span><span class="c1">//----------------准备阶段-------------------</span>
</span><span id="__span-17-115"><a id="__codelineno-17-115" name="__codelineno-17-115" href="#__codelineno-17-115"></a><span class="w">    </span><span class="c1">// Initialize NVS</span>
</span><span id="__span-17-116"><a id="__codelineno-17-116" name="__codelineno-17-116" href="#__codelineno-17-116"></a><span class="w">    </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvs_flash_init</span><span class="p">();</span>
</span><span id="__span-17-117"><a id="__codelineno-17-117" name="__codelineno-17-117" href="#__codelineno-17-117"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_ERR_NVS_NO_FREE_PAGES</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_ERR_NVS_NEW_VERSION_FOUND</span><span class="p">)</span>
</span><span id="__span-17-118"><a id="__codelineno-17-118" name="__codelineno-17-118" href="#__codelineno-17-118"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-17-119"><a id="__codelineno-17-119" name="__codelineno-17-119" href="#__codelineno-17-119"></a><span class="w">        </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">nvs_flash_erase</span><span class="p">());</span>
</span><span id="__span-17-120"><a id="__codelineno-17-120" name="__codelineno-17-120" href="#__codelineno-17-120"></a><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvs_flash_init</span><span class="p">();</span>
</span><span id="__span-17-121"><a id="__codelineno-17-121" name="__codelineno-17-121" href="#__codelineno-17-121"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-122"><a id="__codelineno-17-122" name="__codelineno-17-122" href="#__codelineno-17-122"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
</span><span id="__span-17-123"><a id="__codelineno-17-123" name="__codelineno-17-123" href="#__codelineno-17-123"></a>
</span><span id="__span-17-124"><a id="__codelineno-17-124" name="__codelineno-17-124" href="#__codelineno-17-124"></a><span class="w">    </span><span class="c1">//----------------初始化阶段-------------------</span>
</span><span id="__span-17-125"><a id="__codelineno-17-125" name="__codelineno-17-125" href="#__codelineno-17-125"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_netif_init</span><span class="p">());</span>
</span><span id="__span-17-126"><a id="__codelineno-17-126" name="__codelineno-17-126" href="#__codelineno-17-126"></a>
</span><span id="__span-17-127"><a id="__codelineno-17-127" name="__codelineno-17-127" href="#__codelineno-17-127"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_event_loop_create_default</span><span class="p">());</span>
</span><span id="__span-17-128"><a id="__codelineno-17-128" name="__codelineno-17-128" href="#__codelineno-17-128"></a>
</span><span id="__span-17-129"><a id="__codelineno-17-129" name="__codelineno-17-129" href="#__codelineno-17-129"></a><span class="w">    </span><span class="c1">// 初始化WIFI设备( 为 WiFi 驱动初始化 WiFi 分配资源，如 WiFi 控制结构、RX/TX 缓冲区、WiFi NVS 结构等，这个 WiFi 也启动 WiFi 任务。必须先调用此API，然后才能调用所有其他WiFi API)</span>
</span><span id="__span-17-130"><a id="__codelineno-17-130" name="__codelineno-17-130" href="#__codelineno-17-130"></a><span class="w">    </span><span class="n">esp_netif_t</span><span class="w"> </span><span class="o">*</span><span class="n">sta_netif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_netif_create_default_wifi_sta</span><span class="p">();</span>
</span><span id="__span-17-131"><a id="__codelineno-17-131" name="__codelineno-17-131" href="#__codelineno-17-131"></a><span class="w">    </span><span class="n">assert</span><span class="p">(</span><span class="n">sta_netif</span><span class="p">);</span>
</span><span id="__span-17-132"><a id="__codelineno-17-132" name="__codelineno-17-132" href="#__codelineno-17-132"></a>
</span><span id="__span-17-133"><a id="__codelineno-17-133" name="__codelineno-17-133" href="#__codelineno-17-133"></a><span class="w">    </span><span class="cm">/*Initialize WiFi */</span>
</span><span id="__span-17-134"><a id="__codelineno-17-134" name="__codelineno-17-134" href="#__codelineno-17-134"></a><span class="w">    </span><span class="n">wifi_init_config_t</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WIFI_INIT_CONFIG_DEFAULT</span><span class="p">();</span>
</span><span id="__span-17-135"><a id="__codelineno-17-135" name="__codelineno-17-135" href="#__codelineno-17-135"></a><span class="w">    </span><span class="c1">// WIFI_INIT_CONFIG_DEFAULT 是一个默认配置的宏</span>
</span><span id="__span-17-136"><a id="__codelineno-17-136" name="__codelineno-17-136" href="#__codelineno-17-136"></a>
</span><span id="__span-17-137"><a id="__codelineno-17-137" name="__codelineno-17-137" href="#__codelineno-17-137"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cfg</span><span class="p">));</span>
</span><span id="__span-17-138"><a id="__codelineno-17-138" name="__codelineno-17-138" href="#__codelineno-17-138"></a>
</span><span id="__span-17-139"><a id="__codelineno-17-139" name="__codelineno-17-139" href="#__codelineno-17-139"></a><span class="w">    </span><span class="c1">//----------------配置阶段-------------------</span>
</span><span id="__span-17-140"><a id="__codelineno-17-140" name="__codelineno-17-140" href="#__codelineno-17-140"></a><span class="w">    </span><span class="c1">// 设置为STA模式</span>
</span><span id="__span-17-141"><a id="__codelineno-17-141" name="__codelineno-17-141" href="#__codelineno-17-141"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_set_mode</span><span class="p">(</span><span class="n">WIFI_MODE_STA</span><span class="p">));</span>
</span><span id="__span-17-142"><a id="__codelineno-17-142" name="__codelineno-17-142" href="#__codelineno-17-142"></a>
</span><span id="__span-17-143"><a id="__codelineno-17-143" name="__codelineno-17-143" href="#__codelineno-17-143"></a><span class="w">    </span><span class="c1">// STA详细配置</span>
</span><span id="__span-17-144"><a id="__codelineno-17-144" name="__codelineno-17-144" href="#__codelineno-17-144"></a><span class="w">    </span><span class="n">wifi_config_t</span><span class="w"> </span><span class="n">sta_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-145"><a id="__codelineno-17-145" name="__codelineno-17-145" href="#__codelineno-17-145"></a><span class="w">        </span><span class="p">.</span><span class="n">sta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-146"><a id="__codelineno-17-146" name="__codelineno-17-146" href="#__codelineno-17-146"></a><span class="w">            </span><span class="p">.</span><span class="n">ssid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_WIFI_STA_SSID</span><span class="p">,</span>
</span><span id="__span-17-147"><a id="__codelineno-17-147" name="__codelineno-17-147" href="#__codelineno-17-147"></a><span class="w">            </span><span class="p">.</span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_WIFI_STA_PASSWD</span><span class="p">,</span>
</span><span id="__span-17-148"><a id="__codelineno-17-148" name="__codelineno-17-148" href="#__codelineno-17-148"></a><span class="w">            </span><span class="p">.</span><span class="n">bssid_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span>
</span><span id="__span-17-149"><a id="__codelineno-17-149" name="__codelineno-17-149" href="#__codelineno-17-149"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-17-150"><a id="__codelineno-17-150" name="__codelineno-17-150" href="#__codelineno-17-150"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-17-151"><a id="__codelineno-17-151" name="__codelineno-17-151" href="#__codelineno-17-151"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_set_config</span><span class="p">(</span><span class="n">WIFI_IF_STA</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sta_config</span><span class="p">));</span>
</span><span id="__span-17-152"><a id="__codelineno-17-152" name="__codelineno-17-152" href="#__codelineno-17-152"></a>
</span><span id="__span-17-153"><a id="__codelineno-17-153" name="__codelineno-17-153" href="#__codelineno-17-153"></a><span class="w">    </span><span class="c1">//----------------启动阶段-------------------</span>
</span><span id="__span-17-154"><a id="__codelineno-17-154" name="__codelineno-17-154" href="#__codelineno-17-154"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_start</span><span class="p">());</span>
</span><span id="__span-17-155"><a id="__codelineno-17-155" name="__codelineno-17-155" href="#__codelineno-17-155"></a>
</span><span id="__span-17-156"><a id="__codelineno-17-156" name="__codelineno-17-156" href="#__codelineno-17-156"></a><span class="w">    </span><span class="c1">//----------------配置省电模式-------------------</span>
</span><span id="__span-17-157"><a id="__codelineno-17-157" name="__codelineno-17-157" href="#__codelineno-17-157"></a><span class="w">    </span><span class="c1">// 不省电(数据传输会更快)</span>
</span><span id="__span-17-158"><a id="__codelineno-17-158" name="__codelineno-17-158" href="#__codelineno-17-158"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_set_ps</span><span class="p">(</span><span class="n">WIFI_PS_NONE</span><span class="p">));</span>
</span><span id="__span-17-159"><a id="__codelineno-17-159" name="__codelineno-17-159" href="#__codelineno-17-159"></a>
</span><span id="__span-17-160"><a id="__codelineno-17-160" name="__codelineno-17-160" href="#__codelineno-17-160"></a><span class="w">    </span><span class="c1">//----------------WIFI Scan-------------------</span>
</span><span id="__span-17-161"><a id="__codelineno-17-161" name="__codelineno-17-161" href="#__codelineno-17-161"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_SCAN_LIST_SIZE</span><span class="p">;</span>
</span><span id="__span-17-162"><a id="__codelineno-17-162" name="__codelineno-17-162" href="#__codelineno-17-162"></a><span class="w">    </span><span class="n">wifi_ap_record_t</span><span class="w"> </span><span class="n">ap_info</span><span class="p">[</span><span class="n">DEFAULT_SCAN_LIST_SIZE</span><span class="p">];</span>
</span><span id="__span-17-163"><a id="__codelineno-17-163" name="__codelineno-17-163" href="#__codelineno-17-163"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">ap_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-17-164"><a id="__codelineno-17-164" name="__codelineno-17-164" href="#__codelineno-17-164"></a><span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">ap_info</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">ap_info</span><span class="p">));</span>
</span><span id="__span-17-165"><a id="__codelineno-17-165" name="__codelineno-17-165" href="#__codelineno-17-165"></a><span class="w">    </span><span class="c1">// 扫描所有有效的AP 阻塞</span>
</span><span id="__span-17-166"><a id="__codelineno-17-166" name="__codelineno-17-166" href="#__codelineno-17-166"></a><span class="w">    </span><span class="n">esp_wifi_scan_start</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
</span><span id="__span-17-167"><a id="__codelineno-17-167" name="__codelineno-17-167" href="#__codelineno-17-167"></a><span class="w">    </span><span class="c1">// 获取上次扫描中找到的AP列表</span>
</span><span id="__span-17-168"><a id="__codelineno-17-168" name="__codelineno-17-168" href="#__codelineno-17-168"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_scan_get_ap_records</span><span class="p">(</span><span class="o">&amp;</span><span class="n">number</span><span class="p">,</span><span class="w"> </span><span class="n">ap_info</span><span class="p">));</span>
</span><span id="__span-17-169"><a id="__codelineno-17-169" name="__codelineno-17-169" href="#__codelineno-17-169"></a><span class="w">    </span><span class="c1">// 获取上次扫描中找到的AP数获取上次扫描中找到的AP数</span>
</span><span id="__span-17-170"><a id="__codelineno-17-170" name="__codelineno-17-170" href="#__codelineno-17-170"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_scan_get_ap_num</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ap_count</span><span class="p">));</span>
</span><span id="__span-17-171"><a id="__codelineno-17-171" name="__codelineno-17-171" href="#__codelineno-17-171"></a><span class="w">    </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Total APs scanned = %u&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ap_count</span><span class="p">);</span>
</span><span id="__span-17-172"><a id="__codelineno-17-172" name="__codelineno-17-172" href="#__codelineno-17-172"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">DEFAULT_SCAN_LIST_SIZE</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ap_count</span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-17-173"><a id="__codelineno-17-173" name="__codelineno-17-173" href="#__codelineno-17-173"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-17-174"><a id="__codelineno-17-174" name="__codelineno-17-174" href="#__codelineno-17-174"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SSID </span><span class="se">\t\t</span><span class="s">%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ap_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ssid</span><span class="p">);</span><span class="w"> </span><span class="c1">// 名称</span>
</span><span id="__span-17-175"><a id="__codelineno-17-175" name="__codelineno-17-175" href="#__codelineno-17-175"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RSSI </span><span class="se">\t\t</span><span class="s">%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ap_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rssi</span><span class="p">);</span><span class="w"> </span><span class="c1">// 信号强度</span>
</span><span id="__span-17-176"><a id="__codelineno-17-176" name="__codelineno-17-176" href="#__codelineno-17-176"></a><span class="w">        </span><span class="n">print_auth_mode</span><span class="p">(</span><span class="n">ap_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">authmode</span><span class="p">);</span><span class="w">          </span><span class="c1">// wifi加密模式</span>
</span><span id="__span-17-177"><a id="__codelineno-17-177" name="__codelineno-17-177" href="#__codelineno-17-177"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ap_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">authmode</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">WIFI_AUTH_WEP</span><span class="p">)</span>
</span><span id="__span-17-178"><a id="__codelineno-17-178" name="__codelineno-17-178" href="#__codelineno-17-178"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-17-179"><a id="__codelineno-17-179" name="__codelineno-17-179" href="#__codelineno-17-179"></a><span class="w">            </span><span class="n">print_cipher_type</span><span class="p">(</span><span class="n">ap_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pairwise_cipher</span><span class="p">,</span><span class="w"> </span><span class="n">ap_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">group_cipher</span><span class="p">);</span>
</span><span id="__span-17-180"><a id="__codelineno-17-180" name="__codelineno-17-180" href="#__codelineno-17-180"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-17-181"><a id="__codelineno-17-181" name="__codelineno-17-181" href="#__codelineno-17-181"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Channel </span><span class="se">\t\t</span><span class="s">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ap_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">primary</span><span class="p">);</span><span class="w"> </span><span class="c1">// 信道</span>
</span><span id="__span-17-182"><a id="__codelineno-17-182" name="__codelineno-17-182" href="#__codelineno-17-182"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-183"><a id="__codelineno-17-183" name="__codelineno-17-183" href="#__codelineno-17-183"></a><span class="p">}</span>
</span></code></pre></div>

效果：

![](20240315100518.png) --> <h1 id=_4>参考链接<a class=headerlink href=#_4 title="Permanent link">&para;</a></h1> <ol> <li><a href="https://www.bilibili.com/video/BV1au411E7K1?p=7&vd_source=ef5a0ab0106372751602034cdd9ab98e">https://www.bilibili.com/video/BV1au411E7K1?p=7&amp;vd_source=ef5a0ab0106372751602034cdd9ab98e</a></li> <li><a href="https://www.bilibili.com/video/BV1au411E7K1?p=8&vd_source=ef5a0ab0106372751602034cdd9ab98e">https://www.bilibili.com/video/BV1au411E7K1?p=8&amp;vd_source=ef5a0ab0106372751602034cdd9ab98e</a></li> <li><a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-guides/wifi.html>https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-guides/wifi.html</a></li> </ol> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href=... target=_blank rel=noopener>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../../BLUETOOTH/bluetooth/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 蓝牙"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 320 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> 蓝牙 </div> </div> </a> <a href=../../MQTT/mqtt/ class="md-footer__link md-footer__link--next" aria-label="下一页: MQTT"> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> MQTT </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 320 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 ~ now | 🚀 Shuaiwen Cui (Shaun) </div> </div> <div class=md-social> <a href=http://www.cuishuaiwen.com/ target=_blank rel=noopener title=www.cuishuaiwen.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1v16.2c0 22.1-17.9 40-40 40h-16c-1.1 0-2.2 0-3.3-.1-1.4.1-2.8.1-4.2.1L416 512h-24c-22.1 0-40-17.9-40-40v-88c0-17.7-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32v88c0 22.1-17.9 40-40 40h-55.9c-1.5 0-3-.1-4.5-.2-1.2.1-2.4.2-3.6.2h-16c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9.1-2.8v-69.7h-32c-18 0-32-14-32-32.1 0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7l255.4 224.5c8 7 12 15 11 24"/></svg> </a> <a href=https://github.com/Shuaiwen-Cui target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://www.linkedin.com/in/shaun-shuaiwen-cui/ target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://www.researchgate.net/profile/Shuaiwen-Cui target=_blank rel=noopener title=www.researchgate.net class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 32v448h448V32zm262.2 334.4c-6.6 3-33.2 6-50-14.2-9.2-10.6-25.3-33.3-42.2-63.6-8.9 0-14.7 0-21.4-.6v46.4c0 23.5 6 21.2 25.8 23.9v8.1c-6.9-.3-23.1-.8-35.6-.8-13.1 0-26.1.6-33.6.8v-8.1c15.5-2.9 22-1.3 22-23.9V225c0-22.6-6.4-21-22-23.9V193c25.8 1 53.1-.6 70.9-.6 31.7 0 55.9 14.4 55.9 45.6 0 21.1-16.7 42.2-39.2 47.5 13.6 24.2 30 45.6 42.2 58.9 7.2 7.8 17.2 14.7 27.2 14.7zm22.9-135c-23.3 0-32.2-15.7-32.2-32.2V167c0-12.2 8.8-30.4 34-30.4s30.4 17.9 30.4 17.9l-10.7 7.2s-5.5-12.5-19.7-12.5c-7.9 0-19.7 7.3-19.7 19.7v26.8c0 13.4 6.6 23.3 17.9 23.3 14.1 0 21.5-10.9 21.5-26.8h-17.9v-10.7h30.4c0 20.5 4.7 49.9-34 49.9m-116.5 44.7c-9.4 0-13.6-.3-20-.8v-69.7c6.4-.6 15-.6 22.5-.6 23.3 0 37.2 12.2 37.2 34.5 0 21.9-15 36.6-39.7 36.6"/></svg> </a> <a href=https://orcid.org/0000-0003-4447-6687 target=_blank rel=noopener title=orcid.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M294.75 188.19h-45.92V342h47.47c67.62 0 83.12-51.34 83.12-76.91 0-41.64-26.54-76.9-84.67-76.9M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8m-80.79 360.76h-29.84v-207.5h29.84zm-14.92-231.14a19.57 19.57 0 1 1 19.57-19.57 19.64 19.64 0 0 1-19.57 19.57M300 369h-81V161.26h80.6c76.73 0 110.44 54.83 110.44 103.85C410 318.39 368.38 369 300 369"/></svg> </a> <a href=https://twitter.com/ShuaiwenC target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "header.autohide", "navigation.footer", "navigation.indexes", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.6ce7567c.min.js", "tags": {"Default": "default-tag", "Hardware": "hardware-tag", "Software": "software-tag"}, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../../assets/javascripts/bundle.83f73b43.min.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>