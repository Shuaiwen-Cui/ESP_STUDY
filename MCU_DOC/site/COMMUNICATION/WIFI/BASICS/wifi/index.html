<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Shuaiwen Cui"><link href=https://shuaiwen-cui.github.io/ESP_STUDY/COMMUNICATION/WIFI/BASICS/wifi/ rel=canonical><link href=../../../BLUETOOTH/bluetooth/ rel=prev><link href=../../MQTT/mqtt/ rel=next><link rel=alternate type=application/rss+xml title="RSS feed" href=../../../../feed_rss_created.xml><link rel=alternate type=application/rss+xml title="RSS feed of updated content" href=../../../../feed_rss_updated.xml><link rel=icon href=../../../../static/images/logo.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.44"><title>BASICS - ESP_STUDY</title><link rel=stylesheet href=../../../../assets/stylesheets/main.0253249f.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.06af60db.min.css><style>.md-tag.md-tag--default-tag{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 80v149.5c0 17 6.7 33.3 18.7 45.3l176 176c25 25 65.5 25 90.5 0l133.5-133.5c25-25 25-65.5 0-90.5l-176-176c-12-12-28.3-18.7-45.3-18.7L48 32C21.5 32 0 53.5 0 80m112 32a32 32 0 1 1 0 64 32 32 0 1 1 0-64"/></svg>');}.md-tag.md-tag--hardware-tag{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M176 24c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c-35.3 0-64 28.7-64 64H24c-13.3 0-24 10.7-24 24s10.7 24 24 24h40v56H24c-13.3 0-24 10.7-24 24s10.7 24 24 24h40v56H24c-13.3 0-24 10.7-24 24s10.7 24 24 24h40c0 35.3 28.7 64 64 64v40c0 13.3 10.7 24 24 24s24-10.7 24-24v-40h56v40c0 13.3 10.7 24 24 24s24-10.7 24-24v-40h56v40c0 13.3 10.7 24 24 24s24-10.7 24-24v-40c35.3 0 64-28.7 64-64h40c13.3 0 24-10.7 24-24s-10.7-24-24-24h-40v-56h40c13.3 0 24-10.7 24-24s-10.7-24-24-24h-40v-56h40c13.3 0 24-10.7 24-24s-10.7-24-24-24h-40c0-35.3-28.7-64-64-64V24c0-13.3-10.7-24-24-24s-24 10.7-24 24v40h-56V24c0-13.3-10.7-24-24-24s-24 10.7-24 24v40h-56zm-16 104h192c17.7 0 32 14.3 32 32v192c0 17.7-14.3 32-32 32H160c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32m192 32H160v192h192z"/></svg>');}.md-tag.md-tag--software-tag{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 96c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256h-64V96H128v256H64zM0 403.2C0 392.6 8.6 384 19.2 384h601.6c10.6 0 19.2 8.6 19.2 19.2 0 42.4-34.4 76.8-76.8 76.8H76.8C34.4 480 0 445.6 0 403.2M281 209l-31 31 31 31c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-48-48c-9.4-9.4-9.4-24.6 0-33.9l48-48c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9zm112-34 48 48c9.4 9.4 9.4 24.6 0 33.9l-48 48c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l31-31-31-31c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0z"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#wifi-basics class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../.. title=ESP_STUDY class="md-header__button md-logo" aria-label=ESP_STUDY data-md-component=logo> <img src=../../../../static/images/mainboard.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ESP_STUDY </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> BASICS </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__option> <div class=md-select> <button class="md-header__button md-icon" aria-label="Select language"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg> </button> <div class=md-select__inner> <ul class=md-select__list> <li class=md-select__item> <a href=./ hreflang=en class=md-select__link> English </a> </li> <li class=md-select__item> <a href=../../../../zh/COMMUNICATION/WIFI/BASICS/wifi/ hreflang=zh class=md-select__link> 简体中文 </a> </li> </ul> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 320 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/Shuaiwen-Cui/ESP_STUDY.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> Shuaiwen-Cui/ESP_STUDY </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../.. class=md-tabs__link> ESP32 </a> </li> <li class=md-tabs__item> <a href=../../../../GET_STARTED/HARDWARE/hardware/ class=md-tabs__link> GET STARTED </a> </li> <li class=md-tabs__item> <a href=../../../../TUTORIAL_STUDY/DURUOFU/duruofu/ class=md-tabs__link> TUTORIAL STUDY </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../communication/ class=md-tabs__link> COMMUNICATION </a> </li> <li class=md-tabs__item> <a href=../../../../FREERTOS/quickstart/ class=md-tabs__link> FREERTOS </a> </li> <li class=md-tabs__item> <a href=../../../../MATH-DSP-AI/math-dsp-ai/ class=md-tabs__link> MATH-DSP-AI </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title=ESP_STUDY class="md-nav__button md-logo" aria-label=ESP_STUDY data-md-component=logo> <img src=../../../../static/images/mainboard.png alt=logo> </a> ESP_STUDY </label> <div class=md-nav__source> <a href=https://github.com/Shuaiwen-Cui/ESP_STUDY.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> Shuaiwen-Cui/ESP_STUDY </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../.. class=md-nav__link> <span class=md-ellipsis> ESP32 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> GET STARTED </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> GET STARTED </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../GET_STARTED/HARDWARE/hardware/ class=md-nav__link> <span class=md-ellipsis> HARDWARE </span> </a> </li> <li class=md-nav__item> <a href=../../../../GET_STARTED/ENVIRONMENT/environment/ class=md-nav__link> <span class=md-ellipsis> ENVIRONMENT </span> </a> </li> <li class=md-nav__item> <a href=../../../../GET_STARTED/HANDS-ON/hands-on/ class=md-nav__link> <span class=md-ellipsis> HANDS-ON </span> </a> </li> <li class=md-nav__item> <a href=../../../../GET_STARTED/TEMPLATE/template/ class=md-nav__link> <span class=md-ellipsis> TEMPLATE </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> TUTORIAL STUDY </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> TUTORIAL STUDY </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../TUTORIAL_STUDY/DURUOFU/duruofu/ class=md-nav__link> <span class=md-ellipsis> DURUOFU </span> </a> </li> <li class=md-nav__item> <a href=../../../../TUTORIAL_STUDY/MORNINGCORE/morningcore/ class=md-nav__link> <span class=md-ellipsis> MORNINGCORE </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> COMMUNICATION </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> COMMUNICATION </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../communication/ class=md-nav__link> <span class=md-ellipsis> COMMUNICATION </span> </a> </li> <li class=md-nav__item> <a href=../../../BLUETOOTH/bluetooth/ class=md-nav__link> <span class=md-ellipsis> BLUETOOTH </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3 checked> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> WIFI </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=true> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> WIFI </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> BASICS </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> BASICS </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-introduction class=md-nav__link> <span class=md-ellipsis> 1. Introduction </span> </a> <nav class=md-nav aria-label="1. Introduction"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-esp32-event-mechanism class=md-nav__link> <span class=md-ellipsis> 1.1 ESP32 Event Mechanism </span> </a> </li> <li class=md-nav__item> <a href=#12-esp32-wifis-sta-and-ap-modes class=md-nav__link> <span class=md-ellipsis> 1.2 ESP32 WIFI's STA and AP Modes </span> </a> <nav class=md-nav aria-label="1.2 ESP32 WIFI's STA and AP Modes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#121-ap class=md-nav__link> <span class=md-ellipsis> 1.2.1 AP </span> </a> </li> <li class=md-nav__item> <a href=#122-sta class=md-nav__link> <span class=md-ellipsis> 1.2.2 STA </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-usage class=md-nav__link> <span class=md-ellipsis> 2. Usage </span> </a> <nav class=md-nav aria-label="2. Usage"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-wifi-ap-mode class=md-nav__link> <span class=md-ellipsis> 2.1 WIFI AP Mode </span> </a> <nav class=md-nav aria-label="2.1 WIFI AP Mode"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#211-wi-fi-preparation-phase-not-shown-in-the-diagram class=md-nav__link> <span class=md-ellipsis> 2.1.1 Wi-Fi Preparation Phase (Not shown in the diagram) </span> </a> </li> <li class=md-nav__item> <a href=#212-wi-fi-initialization-phase class=md-nav__link> <span class=md-ellipsis> 2.1.2 Wi-Fi Initialization Phase </span> </a> </li> <li class=md-nav__item> <a href=#213-wi-fi-configuration-phase class=md-nav__link> <span class=md-ellipsis> 2.1.3 Wi-Fi Configuration Phase </span> </a> </li> <li class=md-nav__item> <a href=#214-wi-fi-startup-phase class=md-nav__link> <span class=md-ellipsis> 2.1.4 Wi-Fi Startup Phase </span> </a> </li> <li class=md-nav__item> <a href=#215-event-loop class=md-nav__link> <span class=md-ellipsis> 2.1.5 Event Loop </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#22-wifi-sta class=md-nav__link> <span class=md-ellipsis> 2.2 WIFI STA </span> </a> <nav class=md-nav aria-label="2.2 WIFI STA"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#221-wi-fi-preparation-phase-same-as-in-ap class=md-nav__link> <span class=md-ellipsis> 2.2.1 Wi-Fi Preparation Phase (Same as in AP) </span> </a> </li> <li class=md-nav__item> <a href=#222-wi-fi-initialization-phase class=md-nav__link> <span class=md-ellipsis> 2.2.2 Wi-Fi Initialization Phase </span> </a> </li> <li class=md-nav__item> <a href=#223-wi-fi-configuration-phase class=md-nav__link> <span class=md-ellipsis> 2.2.3 Wi-Fi Configuration Phase </span> </a> </li> <li class=md-nav__item> <a href=#224-wi-fi-startup-phase class=md-nav__link> <span class=md-ellipsis> 2.2.4 Wi-Fi Startup Phase </span> </a> </li> <li class=md-nav__item> <a href=#225-event-loop class=md-nav__link> <span class=md-ellipsis> 2.2.5 Event Loop </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#23-supplement class=md-nav__link> <span class=md-ellipsis> 2.3 Supplement </span> </a> <nav class=md-nav aria-label="2.3 Supplement"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#231-wi-fi-power-saving-mode class=md-nav__link> <span class=md-ellipsis> 2.3.1 Wi-Fi Power Saving Mode </span> </a> </li> <li class=md-nav__item> <a href=#232-static-ip-configuration class=md-nav__link> <span class=md-ellipsis> 2.3.2 Static IP Configuration </span> </a> </li> <li class=md-nav__item> <a href=#233-wifi-scan class=md-nav__link> <span class=md-ellipsis> 2.3.3 WIFI Scan </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-examples class=md-nav__link> <span class=md-ellipsis> 3. Examples </span> </a> <nav class=md-nav aria-label="3. Examples"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-wifi-ap-mode class=md-nav__link> <span class=md-ellipsis> 3.1 WIFI AP Mode </span> </a> </li> <li class=md-nav__item> <a href=#32-wifi-sta-mode class=md-nav__link> <span class=md-ellipsis> 3.2 WIFI STA Mode </span> </a> </li> <li class=md-nav__item> <a href=#33-wifi-sta-mode-for-campus-networks class=md-nav__link> <span class=md-ellipsis> 3.3 WIFI STA Mode for Campus Networks </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../MQTT/mqtt/ class=md-nav__link> <span class=md-ellipsis> MQTT </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> FREERTOS </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> FREERTOS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../FREERTOS/quickstart/ class=md-nav__link> <span class=md-ellipsis> QUICK START </span> </a> </li> <li class=md-nav__item> <a href=../../../../FREERTOS/MULTITASK/multitask/ class=md-nav__link> <span class=md-ellipsis> MULTITASK </span> </a> </li> <li class=md-nav__item> <a href=../../../../FREERTOS/QUEUE/queue/ class=md-nav__link> <span class=md-ellipsis> QUEUE </span> </a> </li> <li class=md-nav__item> <a href=../../../../FREERTOS/SEMAPHORE/semaphore/ class=md-nav__link> <span class=md-ellipsis> SEMAPHORE </span> </a> </li> <li class=md-nav__item> <a href=../../../../FREERTOS/MUTEX/mutex/ class=md-nav__link> <span class=md-ellipsis> MUTEX </span> </a> </li> <li class=md-nav__item> <a href=../../../../FREERTOS/EVENT-GROUP/event-group/ class=md-nav__link> <span class=md-ellipsis> EVENT GROUP </span> </a> </li> <li class=md-nav__item> <a href=../../../../FREERTOS/TASK-NOTIFICATION/task-notification/ class=md-nav__link> <span class=md-ellipsis> TASK NOTIFICATION </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> MATH-DSP-AI </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> MATH-DSP-AI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../MATH-DSP-AI/math-dsp-ai/ class=md-nav__link> <span class=md-ellipsis> MATH DSP AI </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-introduction class=md-nav__link> <span class=md-ellipsis> 1. Introduction </span> </a> <nav class=md-nav aria-label="1. Introduction"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-esp32-event-mechanism class=md-nav__link> <span class=md-ellipsis> 1.1 ESP32 Event Mechanism </span> </a> </li> <li class=md-nav__item> <a href=#12-esp32-wifis-sta-and-ap-modes class=md-nav__link> <span class=md-ellipsis> 1.2 ESP32 WIFI's STA and AP Modes </span> </a> <nav class=md-nav aria-label="1.2 ESP32 WIFI's STA and AP Modes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#121-ap class=md-nav__link> <span class=md-ellipsis> 1.2.1 AP </span> </a> </li> <li class=md-nav__item> <a href=#122-sta class=md-nav__link> <span class=md-ellipsis> 1.2.2 STA </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-usage class=md-nav__link> <span class=md-ellipsis> 2. Usage </span> </a> <nav class=md-nav aria-label="2. Usage"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-wifi-ap-mode class=md-nav__link> <span class=md-ellipsis> 2.1 WIFI AP Mode </span> </a> <nav class=md-nav aria-label="2.1 WIFI AP Mode"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#211-wi-fi-preparation-phase-not-shown-in-the-diagram class=md-nav__link> <span class=md-ellipsis> 2.1.1 Wi-Fi Preparation Phase (Not shown in the diagram) </span> </a> </li> <li class=md-nav__item> <a href=#212-wi-fi-initialization-phase class=md-nav__link> <span class=md-ellipsis> 2.1.2 Wi-Fi Initialization Phase </span> </a> </li> <li class=md-nav__item> <a href=#213-wi-fi-configuration-phase class=md-nav__link> <span class=md-ellipsis> 2.1.3 Wi-Fi Configuration Phase </span> </a> </li> <li class=md-nav__item> <a href=#214-wi-fi-startup-phase class=md-nav__link> <span class=md-ellipsis> 2.1.4 Wi-Fi Startup Phase </span> </a> </li> <li class=md-nav__item> <a href=#215-event-loop class=md-nav__link> <span class=md-ellipsis> 2.1.5 Event Loop </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#22-wifi-sta class=md-nav__link> <span class=md-ellipsis> 2.2 WIFI STA </span> </a> <nav class=md-nav aria-label="2.2 WIFI STA"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#221-wi-fi-preparation-phase-same-as-in-ap class=md-nav__link> <span class=md-ellipsis> 2.2.1 Wi-Fi Preparation Phase (Same as in AP) </span> </a> </li> <li class=md-nav__item> <a href=#222-wi-fi-initialization-phase class=md-nav__link> <span class=md-ellipsis> 2.2.2 Wi-Fi Initialization Phase </span> </a> </li> <li class=md-nav__item> <a href=#223-wi-fi-configuration-phase class=md-nav__link> <span class=md-ellipsis> 2.2.3 Wi-Fi Configuration Phase </span> </a> </li> <li class=md-nav__item> <a href=#224-wi-fi-startup-phase class=md-nav__link> <span class=md-ellipsis> 2.2.4 Wi-Fi Startup Phase </span> </a> </li> <li class=md-nav__item> <a href=#225-event-loop class=md-nav__link> <span class=md-ellipsis> 2.2.5 Event Loop </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#23-supplement class=md-nav__link> <span class=md-ellipsis> 2.3 Supplement </span> </a> <nav class=md-nav aria-label="2.3 Supplement"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#231-wi-fi-power-saving-mode class=md-nav__link> <span class=md-ellipsis> 2.3.1 Wi-Fi Power Saving Mode </span> </a> </li> <li class=md-nav__item> <a href=#232-static-ip-configuration class=md-nav__link> <span class=md-ellipsis> 2.3.2 Static IP Configuration </span> </a> </li> <li class=md-nav__item> <a href=#233-wifi-scan class=md-nav__link> <span class=md-ellipsis> 2.3.3 WIFI Scan </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-examples class=md-nav__link> <span class=md-ellipsis> 3. Examples </span> </a> <nav class=md-nav aria-label="3. Examples"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-wifi-ap-mode class=md-nav__link> <span class=md-ellipsis> 3.1 WIFI AP Mode </span> </a> </li> <li class=md-nav__item> <a href=#32-wifi-sta-mode class=md-nav__link> <span class=md-ellipsis> 3.2 WIFI STA Mode </span> </a> </li> <li class=md-nav__item> <a href=#33-wifi-sta-mode-for-campus-networks class=md-nav__link> <span class=md-ellipsis> 3.3 WIFI STA Mode for Campus Networks </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/Shuaiwen-Cui/ESP_STUDY.git/edit/master/docs/COMMUNICATION/WIFI/BASICS/wifi.en.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/Shuaiwen-Cui/ESP_STUDY.git/raw/master/docs/COMMUNICATION/WIFI/BASICS/wifi.en.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1 id=wifi-basics>WIFI BASICS<a class=headerlink href=#wifi-basics title="Permanent link">&para;</a></h1> <div class="admonition note"> <p class=admonition-title>References</p> <p>This document is based on the DURUOFU's ESP32-GUIDE. For more information, please refer to the original version: <a href=https://github.com/DuRuofu/ESP32-Guide>DURUOFU ESP32-GUIDE</a>.</p> </div> <p>This chapter will introduce how to use wifi on ESP32, including WIFI AP mode and WIFI STA mode.</p> <h2 id=1-introduction>1. Introduction<a class=headerlink href=#1-introduction title="Permanent link">&para;</a></h2> <p>Before using Wi-Fi, we need to master some basic concepts and prerequisites:</p> <blockquote> <p>The most fundamental point: Wi-Fi pertains to the physical and data link layers. It replaces Ethernet cables and switch ports by transmitting and receiving information through radio waves. In other words, the Wi-Fi discussed here does not yet involve network layer protocols.</p> </blockquote> <h3 id=11-esp32-event-mechanism>1.1 ESP32 Event Mechanism<a class=headerlink href=#11-esp32-event-mechanism title="Permanent link">&para;</a></h3> <blockquote> <p>If you have no knowledge of FreeRTOS multithreading, please familiarize yourself with it first. You can refer to: <a href="https://www.bilibili.com/video/BV1au411E7K1?p=7">What is a Thread?</a></p> </blockquote> <p>For a general understanding of the event loop, please refer to the following links:</p> <ol> <li><a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/system/esp_event.html>ESP32 Event Loop</a></li> <li><a href="https://www.bilibili.com/video/BV1FD4y1j79J/?spm_id_from=333.788&vd_source=ef5a0ab0106372751602034cdd9ab98e">Event Loop Explained in Plain Language</a></li> </ol> <h3 id=12-esp32-wifis-sta-and-ap-modes>1.2 ESP32 WIFI's STA and AP Modes<a class=headerlink href=#12-esp32-wifis-sta-and-ap-modes title="Permanent link">&para;</a></h3> <h4 id=121-ap>1.2.1 AP<a class=headerlink href=#121-ap title="Permanent link">&para;</a></h4> <p>An AP (Access Point) is a wireless access point, the creator of a wireless network and its central node. Typically, a wireless router used in a home or office is an AP.</p> <p><img alt src=../20240313184111.png></p> <h4 id=122-sta>1.2.2 STA<a class=headerlink href=#122-sta title="Permanent link">&para;</a></h4> <p>A STA (Station) refers to any terminal that connects to a wireless network, such as a laptop, PDA, or any other network-capable device.</p> <p><img alt src=../20240313184132.png></p> <h2 id=2-usage>2. Usage<a class=headerlink href=#2-usage title="Permanent link">&para;</a></h2> <blockquote> <p>Reference: <a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-guides/wifi.html>ESP-IDF: Wi-Fi Driver</a></p> </blockquote> <p>The ESP-IDF WiFi library provides the following features:</p> <ul> <li>Supports station-only mode, AP-only mode, and station/AP coexistence mode</li> <li>Supports IEEE 802.11b, IEEE 802.11g, IEEE 802.11n, and protocol modes configured via API</li> <li>Supports WPA/WPA2/WPA3/WPA2-Enterprise/WPA3-Enterprise/WAPI/WPS and DPP</li> <li>Supports AMSDU, AMPDU, HT40, QoS, and other key features</li> <li>Supports Espressif proprietary protocol, enabling data communication over <strong>1 km</strong></li> <li>Achieves over-the-air data transmission with a maximum TCP throughput of 20 MBit/s and UDP throughput of 30 MBit/s</li> <li>Supports fast scanning and full-channel scanning</li> <li>Supports obtaining channel status information</li> </ul> <div class="admonition tip"> <p class=admonition-title>Campus Wi-Fi</p> <p>Note: Many institutions or schools have campus networks similar to home Wi-Fi. For example, at Nanyang Technological University, the campus network uses WPA2-Enterprise mode, so you need to use WPA2-Enterprise when connecting to the campus network.</p> </div> <h3 id=21-wifi-ap-mode>2.1 WIFI AP Mode<a class=headerlink href=#21-wifi-ap-mode title="Permanent link">&para;</a></h3> <blockquote> <p>The official example program is located at:<br> <code>Espressif\frameworks\esp-idf-v4.4.3\examples\wifi\getting_started\softAP</code></p> </blockquote> <p>The configuration process is as follows:</p> <ul> <li><code>nvs_flash_init</code>: Initialize the default NVS partition.</li> <li><code>esp_netif_init</code>: Initialize the underlying TCP/IP stack (create a LwIP core task and initialize LwIP related operations).</li> <li><code>esp_event_loop_create_default</code>: Create the default event loop.</li> <li><code>esp_netif_create_default_wifi_ap</code>: Create an esp_netif object using the default WiFi AP configuration, connect the netif to WiFi, and register the default WiFi handler.</li> <li><code>esp_wifi_init</code>: Initialize WiFi by allocating resources for the WiFi driver, such as the WiFi control structure, RX/TX buffers, WiFi NVS structure, etc. This also starts the WiFi task. You must call this API before calling any other WiFi APIs.</li> <li><code>esp_event_handler_instance_register</code>: Listen for any WiFi events (WIFI_EVENT); upon triggering, the callback function is executed.</li> <li><code>esp_wifi_set_mode</code>: Set the WiFi operating mode to station, soft-AP, or station + soft-AP. The default mode is soft-AP. This program sets it to AP.</li> <li><code>esp_wifi_set_config</code>: Set the configuration for the ESP32 STA or AP.</li> <li><code>esp_wifi_start</code>: Start WiFi based on the configuration.</li> </ul> <p>The working process is illustrated in the diagram below:<br> (If you don't understand it, you can ignore it, as you'll gradually learn by using it. You can also refer to <a href=https://space.bilibili.com/1338335828>Michael_ee</a>'s tutorial: <a href="https://www.bilibili.com/video/BV1ye4y1r7XK/?spm_id_from=333.788&vd_source=ef5a0ab0106372751602034cdd9ab98e">WIFI Hotspot Working Process</a>)</p> <p><img alt src=../20240313190734.png></p> <p>The main process is divided into the following parts (diagram from the official tutorial):</p> <p><img alt src=../20240313191730.png></p> <h4 id=211-wi-fi-preparation-phase-not-shown-in-the-diagram>2.1.1 Wi-Fi Preparation Phase (Not shown in the diagram)<a class=headerlink href=#211-wi-fi-preparation-phase-not-shown-in-the-diagram title="Permanent link">&para;</a></h4> <p>In this phase, we need to initialize the NVS since the WiFi library relies on it. For more details about NVS, please refer to this blog: <a href=https://www.duruofu.top/2024/03/06/4.%E7%A1%AC%E4%BB%B6%E7%9B%B8%E5%85%B3/MCU/ESP32/04.ESP32%E5%AD%98%E5%82%A8%E5%99%A8%E5%85%A5%E9%97%A8/4.3-ESP32%E5%AD%98%E5%82%A8-VFS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/ESP32%E5%AD%98%E5%82%A8-VFS%E8%99%9A%E6%8B%9F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%85%A5%E9%97%A8/ >ESP32 Storage - 3. VFS Virtual File System</a></p> <p>Below is the code snippet:</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1>// Initialize NVS</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=n>esp_err_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>();</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ret</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>ESP_ERR_NVS_NO_FREE_PAGES</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>ESP_ERR_NVS_NEW_VERSION_FOUND</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>nvs_flash_erase</span><span class=p>());</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>    </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>();</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=p>}</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=p>);</span>
</span></code></pre></div> <h4 id=212-wi-fi-initialization-phase>2.1.2 Wi-Fi Initialization Phase<a class=headerlink href=#212-wi-fi-initialization-phase title="Permanent link">&para;</a></h4> <p>This phase mainly consists of the following steps:</p> <ul> <li>The main task calls the function <a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/network/esp_netif.html#_CPPv414esp_netif_initv title=esp_netif_init><code>esp_netif_init()</code></a> to create a LwIP core task and initialize LwIP-related operations.</li> <li>The main task calls the function <a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/system/esp_event.html#_CPPv421esp_event_loop_createPK21esp_event_loop_args_tP23esp_event_loop_handle_t title=esp_event_loop_create><code>esp_event_loop_create()</code></a> to create a system event task and initialize the application's event callback function. In this case, the only action of the callback is to relay the event to the application task.</li> <li>The main task calls the function <a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/network/esp_netif.html#_CPPv432esp_netif_create_default_wifi_apv title=esp_netif_create_default_wifi_ap><code>esp_netif_create_default_wifi_ap()</code></a> or <a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/network/esp_netif.html#_CPPv433esp_netif_create_default_wifi_stav title=esp_netif_create_default_wifi_sta><code>esp_netif_create_default_wifi_sta()</code></a> to create a default network interface instance with a TCP/IP stack, binding to either a station or an AP.</li> <li>The main task calls the function <a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/network/esp_wifi.html#_CPPv413esp_wifi_initPK18wifi_init_config_t title=esp_wifi_init><code>esp_wifi_init()</code></a> to create the Wi-Fi driver task and initialize the Wi-Fi driver.</li> <li>The main task creates the application task by calling the OS API.</li> </ul> <p>Code:</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_netif_init</span><span class=p>());</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_loop_create_default</span><span class=p>());</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=c1>// *esp_netif_ap can be used to modify AP settings</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=n>esp_netif_t</span><span class=w> </span><span class=o>*</span><span class=n>esp_netif_ap</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>esp_netif_create_default_wifi_ap</span><span class=p>();</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=cm>/* Initialize WiFi */</span><span class=w> </span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=n>wifi_init_config_t</span><span class=w> </span><span class=n>cfg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WIFI_INIT_CONFIG_DEFAULT</span><span class=p>();</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=c1>// WIFI_INIT_CONFIG_DEFAULT is a macro for the default configuration</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_init</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cfg</span><span class=p>));</span>
</span></code></pre></div> <p>This completes the Wi-Fi initialization.</p> <h4 id=213-wi-fi-configuration-phase>2.1.3 Wi-Fi Configuration Phase<a class=headerlink href=#213-wi-fi-configuration-phase title="Permanent link">&para;</a></h4> <p>After the Wi-Fi driver is successfully initialized, we can proceed to the configuration phase.</p> <p>Use the function <code>esp_wifi_set_mode</code> to set the WiFi operation mode to station, soft-AP, or station+soft-AP.</p> <p>Use the function <code>esp_wifi_set_config</code> to set the specific configuration for the ESP32 STA or AP (there are many parameters available; please refer to the official documentation for details. Below, only a few basic parameters are configured).</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1>// Set to AP mode</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_set_mode</span><span class=p>(</span><span class=n>WIFI_MODE_AP</span><span class=p>));</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=c1>// Detailed AP configuration</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=n>wifi_config_t</span><span class=w> </span><span class=n>wifi_ap_config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=w>    </span><span class=p>.</span><span class=n>ap</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=w>        </span><span class=p>.</span><span class=n>ssid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ESP_WIFI_AP_SSID</span><span class=p>,</span><span class=w>              </span><span class=c1>// Wi-Fi name</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=w>        </span><span class=p>.</span><span class=n>ssid_len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strlen</span><span class=p>(</span><span class=n>ESP_WIFI_AP_SSID</span><span class=p>),</span><span class=w>    </span><span class=c1>// Name length</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=w>        </span><span class=p>.</span><span class=n>channel</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w>                          </span><span class=c1>// Wi-Fi channel</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=w>        </span><span class=p>.</span><span class=n>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ESP_WIFI_AP_PASSWD</span><span class=p>,</span><span class=w>          </span><span class=c1>// Wi-Fi password</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=w>        </span><span class=p>.</span><span class=n>max_connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>,</span><span class=w>                   </span><span class=c1>// Maximum number of connections (default is 10)</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=w>        </span><span class=p>.</span><span class=n>authmode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WIFI_AUTH_WPA2_PSK</span><span class=p>,</span><span class=w>          </span><span class=c1>// Wi-Fi authentication mode</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=p>};</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_set_config</span><span class=p>(</span><span class=n>WIFI_IF_AP</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>wifi_ap_config</span><span class=p>));</span>
</span></code></pre></div> <p>Only the basic parameters are configured here.</p> <h4 id=214-wi-fi-startup-phase>2.1.4 Wi-Fi Startup Phase<a class=headerlink href=#214-wi-fi-startup-phase title="Permanent link">&para;</a></h4> <p>Use <code>esp_wifi_start</code> to start the Wi-Fi based on the configuration.</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=cm>/* Start WiFi */</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_start</span><span class=p>());</span>
</span></code></pre></div> <p>This completes a basic Wi-Fi AP.</p> <p>However, this is just the most basic program. How do we know within the program when an external STA device connects or disconnects? For that, we need to use the default event loop created earlier.</p> <h4 id=215-event-loop>2.1.5 Event Loop<a class=headerlink href=#215-event-loop title="Permanent link">&para;</a></h4> <p>Call <a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/system/esp_event.html#_CPPv431esp_event_handler_register_with23esp_event_loop_handle_t16esp_event_base_t7int32_t19esp_event_handler_tPv title=esp_event_handler_register_with><code>esp_event_handler_instance_register</code></a> to register an event handler with the default event loop. It functions the same as the <code>esp_event_handler_instance_register_with</code> function, with the only difference being that it registers the handler to the default event loop.</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>esp_err_t</span><span class=w> </span><span class=nf>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>esp_event_base_t</span><span class=w> </span><span class=n>event_base</span><span class=p>,</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=w>                                             </span><span class=kt>int32_t</span><span class=w> </span><span class=n>event_id</span><span class=p>,</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>                                             </span><span class=n>esp_event_handler_t</span><span class=w> </span><span class=n>event_handler</span><span class=p>,</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>                                             </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_handler_arg</span><span class=p>,</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=w>                                             </span><span class=n>esp_event_handler_instance_t</span><span class=w> </span><span class=o>*</span><span class=n>instance</span><span class=p>);</span>
</span></code></pre></div> <p>The parameters are as follows:</p> <ul> <li><strong>event_base</strong>: The base ID of the event for which the handler is being registered.</li> <li><strong>event_id</strong>: The ID of the event for which the handler is registered.</li> <li><strong>event_handler</strong>: The handler function that is called when the event is dispatched.</li> <li><strong>event_handler_arg</strong>: Additional data (other than the event data) passed to the handler function.</li> <li><strong>instance</strong>: The event handler instance object associated with the registered event handler and its data.</li> </ul> <p>The related event descriptions can be found in the esp-idf files:</p> <p><img alt src=../20240314165844.png></p> <p>After creating the default event loop, we can add event handling as follows:</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=kt>void</span><span class=w> </span><span class=nf>WIFI_CallBack</span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_handler_arg</span><span class=p>,</span><span class=w> </span><span class=n>esp_event_base_t</span><span class=w> </span><span class=n>event_base</span><span class=p>,</span><span class=w> </span><span class=kt>int32_t</span><span class=w> </span><span class=n>event_id</span><span class=p>,</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_data</span><span class=p>)</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=p>{</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>    </span><span class=c1>// Connection event</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT_AP_STAIPASSIGNED</span><span class=p>)</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>        </span><span class=c1>// Parse data</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>        </span><span class=n>ip_event_ap_staipassigned_t</span><span class=o>*</span><span class=w> </span><span class=n>event_info</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>ip_event_ap_staipassigned_t</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=n>event_data</span><span class=p>;</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>        </span><span class=n>ESP_LOGW</span><span class=p>(</span><span class=s>&quot;WIFI_AP&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Device connected, MAC:&quot;</span><span class=w> </span><span class=n>MACSTR</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=n>MAC2STR</span><span class=p>(</span><span class=n>event_info</span><span class=o>-&gt;</span><span class=n>mac</span><span class=p>));</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>    </span><span class=c1>// Disconnection event</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT_AP_STADISCONNECTED</span><span class=p>)</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=w>        </span><span class=n>wifi_event_ap_stadisconnected_t</span><span class=o>*</span><span class=w> </span><span class=n>event_info</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>wifi_event_ap_stadisconnected_t</span><span class=o>*</span><span class=p>)</span><span class=n>event_data</span><span class=p>;</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=w>        </span><span class=n>ESP_LOGW</span><span class=p>(</span><span class=s>&quot;WIFI_AP&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Device disconnected, MAC:&quot;</span><span class=w> </span><span class=n>MACSTR</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=n>MAC2STR</span><span class=p>(</span><span class=n>event_info</span><span class=o>-&gt;</span><span class=n>mac</span><span class=p>));</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=p>}</span>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a><span class=kt>void</span><span class=w> </span><span class=nf>app_main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a><span class=p>{</span>
</span><span id=__span-5-21><a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=w>    </span><span class=c1>// ......</span>
</span><span id=__span-5-22><a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a>
</span><span id=__span-5-23><a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a><span class=w>    </span><span class=c1>// Initialize the default event loop</span>
</span><span id=__span-5-24><a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_loop_create_default</span><span class=p>());</span>
</span><span id=__span-5-25><a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a><span class=w>    </span><span class=c1>// Register the device connection event callback</span>
</span><span id=__span-5-26><a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a><span class=w>    </span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>IP_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>IP_EVENT_AP_STAIPASSIGNED</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>);</span>
</span><span id=__span-5-27><a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a><span class=w>    </span><span class=c1>// Register the device disconnection event callback</span>
</span><span id=__span-5-28><a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a><span class=w>    </span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>WIFI_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_EVENT_AP_STADISCONNECTED</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>);</span>
</span><span id=__span-5-29><a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a>
</span><span id=__span-5-30><a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a><span class=w>    </span><span class=c1>// ......</span>
</span><span id=__span-5-31><a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a><span class=p>}</span>
</span></code></pre></div> <p>We registered the IP_EVENT_AP_STAIPASSIGNED event here. When a STA device connects or disconnects, the WIFI_CallBack callback function is invoked to print the MAC address information of the connected device.</p> <h3 id=22-wifi-sta>2.2 WIFI STA<a class=headerlink href=#22-wifi-sta title="Permanent link">&para;</a></h3> <blockquote> <p>The official sample code is located at (similar to the hotspot process, but with some differences in details):<br> <code>Espressif\frameworks\esp-idf-v4.4.3\examples\wifi\getting_started\station</code></p> </blockquote> <p>The configuration steps in the initial part are basically the same.</p> <p>Below is the high-level flow of the official program:</p> <p><img alt src=../20240314220947.png></p> <h4 id=221-wi-fi-preparation-phase-same-as-in-ap>2.2.1 Wi-Fi Preparation Phase (Same as in AP)<a class=headerlink href=#221-wi-fi-preparation-phase-same-as-in-ap title="Permanent link">&para;</a></h4> <p>Initialize NVS:</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1>// Initialize NVS</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=n>esp_err_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>();</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ret</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>ESP_ERR_NVS_NO_FREE_PAGES</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>ESP_ERR_NVS_NEW_VERSION_FOUND</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>nvs_flash_erase</span><span class=p>());</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>    </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>();</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=p>}</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=p>);</span>
</span></code></pre></div> <h4 id=222-wi-fi-initialization-phase>2.2.2 Wi-Fi Initialization Phase<a class=headerlink href=#222-wi-fi-initialization-phase title="Permanent link">&para;</a></h4> <p>This configuration differs from the AP setup, as we need to set the device to STA mode.</p> <p>The only difference is replacing <code>esp_netif_create_default_wifi_ap()</code> with <code>esp_netif_create_default_wifi_sta()</code> to configure STA mode.</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_netif_init</span><span class=p>());</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_loop_create_default</span><span class=p>());</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=c1>// *esp_netif_sta can be used to modify STA settings</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=n>esp_netif_t</span><span class=w> </span><span class=o>*</span><span class=n>esp_netif_sta</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>esp_netif_create_default_wifi_sta</span><span class=p>();</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=cm>/* Initialize WiFi */</span><span class=w> </span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=n>wifi_init_config_t</span><span class=w> </span><span class=n>cfg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WIFI_INIT_CONFIG_DEFAULT</span><span class=p>;</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=c1>// WIFI_INIT_CONFIG_DEFAULT is a macro for the default configuration</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_init</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cfg</span><span class=p>));</span>
</span></code></pre></div> <h4 id=223-wi-fi-configuration-phase>2.2.3 Wi-Fi Configuration Phase<a class=headerlink href=#223-wi-fi-configuration-phase title="Permanent link">&para;</a></h4> <p>This is similar to the AP mode, but the contents of the configuration structure differ.</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=p>...............</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=cp>#define ESP_WIFI_STA_SSID &quot;duruofu_win10&quot;</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=cp>#define ESP_WIFI_STA_PASSWD &quot;1234567890&quot;</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=p>...............</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=c1>// Set to STA mode</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_set_mode</span><span class=p>(</span><span class=n>WIFI_MODE_STA</span><span class=p>));</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=c1>// Detailed STA configuration</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=n>wifi_config_t</span><span class=w> </span><span class=n>sta_config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=w>    </span><span class=p>.</span><span class=n>sta</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=w>        </span><span class=p>.</span><span class=n>ssid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ESP_WIFI_STA_SSID</span><span class=p>,</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=w>        </span><span class=p>.</span><span class=n>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ESP_WIFI_STA_PASSWD</span><span class=p>,</span>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=w>        </span><span class=p>.</span><span class=n>bssid_set</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>,</span>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=p>};</span>
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_set_config</span><span class=p>(</span><span class=n>WIFI_IF_STA</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>sta_config</span><span class=p>));</span>
</span></code></pre></div> <p>The configuration information here, as the name implies, is simply the Wi-Fi name and password to connect to (of course, there are more parameters available; please refer to the ESP-IDF parameter documentation for details).</p> <h4 id=224-wi-fi-startup-phase>2.2.4 Wi-Fi Startup Phase<a class=headerlink href=#224-wi-fi-startup-phase title="Permanent link">&para;</a></h4> <p>Unlike in AP mode, here an additional <code>esp_wifi_connect()</code> is used to connect to the Wi-Fi.</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1>//---------------- Startup Phase -------------------</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_start</span><span class=p>());</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_connect</span><span class=p>());</span>
</span></code></pre></div> <h4 id=225-event-loop>2.2.5 Event Loop<a class=headerlink href=#225-event-loop title="Permanent link">&para;</a></h4> <p>Similarly, we can add event callback functions as before. Here, we listen for startup events, connection failure events, and connection success events. The code is straightforward and will not be elaborated on further.</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=kt>void</span><span class=w> </span><span class=nf>WIFI_CallBack</span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_handler_arg</span><span class=p>,</span><span class=w> </span><span class=n>esp_event_base_t</span><span class=w> </span><span class=n>event_base</span><span class=p>,</span><span class=w> </span><span class=kt>int32_t</span><span class=w> </span><span class=n>event_id</span><span class=p>,</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_data</span><span class=p>)</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=p>{</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=w>    </span><span class=k>static</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>connect_count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>    </span><span class=c1>// WIFI startup successful</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT_STA_START</span><span class=p>)</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>        </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;WIFI_EVENT_STA_START&quot;</span><span class=p>);</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>        </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_connect</span><span class=p>());</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=w>    </span><span class=c1>// WIFI connection failed</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT_STA_DISCONNECTED</span><span class=p>)</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=w>        </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;WIFI_EVENT_STA_DISCONNECTED&quot;</span><span class=p>);</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=w>        </span><span class=n>connect_count</span><span class=o>++</span><span class=p>;</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>connect_count</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>6</span><span class=p>)</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=w>            </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_connect</span><span class=p>());</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=w>        </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=w>            </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;WIFI_EVENT_STA_DISCONNECTED 10 times&quot;</span><span class=p>);</span>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a><span class=w>    </span><span class=c1>// WIFI connection successful (IP acquired)</span>
</span><span id=__span-10-24><a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT_STA_GOT_IP</span><span class=p>)</span>
</span><span id=__span-10-25><a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-10-26><a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a><span class=w>        </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;WIFI_EVENT_STA_GOT_IP&quot;</span><span class=p>);</span>
</span><span id=__span-10-27><a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a><span class=w>        </span><span class=n>ip_event_got_ip_t</span><span class=w> </span><span class=o>*</span><span class=n>info</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>ip_event_got_ip_t</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=n>event_data</span><span class=p>;</span>
</span><span id=__span-10-28><a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a><span class=w>        </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;got ip:&quot;</span><span class=w> </span><span class=n>IPSTR</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=n>IP2STR</span><span class=p>(</span><span class=o>&amp;</span><span class=n>info</span><span class=o>-&gt;</span><span class=n>ip_info</span><span class=p>.</span><span class=n>ip</span><span class=p>));</span>
</span><span id=__span-10-29><a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-10-30><a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a><span class=p>}</span>
</span><span id=__span-10-31><a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a>
</span><span id=__span-10-32><a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a><span class=kt>void</span><span class=w> </span><span class=nf>app_main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span><span id=__span-10-33><a id=__codelineno-10-33 name=__codelineno-10-33 href=#__codelineno-10-33></a><span class=p>{</span>
</span><span id=__span-10-34><a id=__codelineno-10-34 name=__codelineno-10-34 href=#__codelineno-10-34></a><span class=w>    </span><span class=c1>// ......</span>
</span><span id=__span-10-35><a id=__codelineno-10-35 name=__codelineno-10-35 href=#__codelineno-10-35></a>
</span><span id=__span-10-36><a id=__codelineno-10-36 name=__codelineno-10-36 href=#__codelineno-10-36></a><span class=w>    </span><span class=c1>// Initialize the default event loop</span>
</span><span id=__span-10-37><a id=__codelineno-10-37 name=__codelineno-10-37 href=#__codelineno-10-37></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_loop_create_default</span><span class=p>());</span>
</span><span id=__span-10-38><a id=__codelineno-10-38 name=__codelineno-10-38 href=#__codelineno-10-38></a><span class=w>    </span><span class=c1>// Register event (WIFI startup successful)</span>
</span><span id=__span-10-39><a id=__codelineno-10-39 name=__codelineno-10-39 href=#__codelineno-10-39></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>WIFI_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_EVENT_STA_START</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>));</span>
</span><span id=__span-10-40><a id=__codelineno-10-40 name=__codelineno-10-40 href=#__codelineno-10-40></a><span class=w>    </span><span class=c1>// Register event (WIFI connection failed)</span>
</span><span id=__span-10-41><a id=__codelineno-10-41 name=__codelineno-10-41 href=#__codelineno-10-41></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>WIFI_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_EVENT_STA_DISCONNECTED</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>));</span>
</span><span id=__span-10-42><a id=__codelineno-10-42 name=__codelineno-10-42 href=#__codelineno-10-42></a><span class=w>    </span><span class=c1>// Register event (WIFI connection successful - IP acquired)</span>
</span><span id=__span-10-43><a id=__codelineno-10-43 name=__codelineno-10-43 href=#__codelineno-10-43></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>IP_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>IP_EVENT_STA_GOT_IP</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>));</span>
</span><span id=__span-10-44><a id=__codelineno-10-44 name=__codelineno-10-44 href=#__codelineno-10-44></a>
</span><span id=__span-10-45><a id=__codelineno-10-45 name=__codelineno-10-45 href=#__codelineno-10-45></a><span class=w>    </span><span class=c1>// ......</span>
</span><span id=__span-10-46><a id=__codelineno-10-46 name=__codelineno-10-46 href=#__codelineno-10-46></a><span class=p>}</span>
</span></code></pre></div> <h3 id=23-supplement>2.3 Supplement<a class=headerlink href=#23-supplement title="Permanent link">&para;</a></h3> <h4 id=231-wi-fi-power-saving-mode>2.3.1 Wi-Fi Power Saving Mode<a class=headerlink href=#231-wi-fi-power-saving-mode title="Permanent link">&para;</a></h4> <p>You can use the <code>esp_wifi_set_ps()</code> function to configure the power saving mode of Wi-Fi.</p> <p>This function offers three optional parameters: <div class="language-c highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=k>typedef</span><span class=w> </span><span class=k>enum</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=w>    </span><span class=n>WIFI_PS_NONE</span><span class=p>,</span><span class=w>        </span><span class=cm>/**&lt; No power save */</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=w>    </span><span class=n>WIFI_PS_MIN_MODEM</span><span class=p>,</span><span class=w>   </span><span class=cm>/**&lt; Minimum modem power saving. In this mode, the station wakes up to receive a beacon every DTIM period */</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>    </span><span class=n>WIFI_PS_MAX_MODEM</span><span class=p>,</span><span class=w>   </span><span class=cm>/**&lt; Maximum modem power saving. In this mode, the interval for receiving beacons is determined by the listen_interval parameter in wifi_sta_config_t */</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=p>}</span><span class=w> </span><span class=n>wifi_ps_type_t</span><span class=p>;</span>
</span></code></pre></div></p> <p>Regarding the power saving mode, you can refer to: <a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-guides/low-power-mode.html#id8 title="Permanent link to the title">How to Choose a Low Power Mode for Wi-Fi Scenarios</a></p> <h4 id=232-static-ip-configuration>2.3.2 Static IP Configuration<a class=headerlink href=#232-static-ip-configuration title="Permanent link">&para;</a></h4> <p>After the DHCP client is created by <code>esp_netif_create_default_wifi_sta()</code>, use the function <code>esp_err_t esp_netif_dhcpc_stop(esp_netif_t *esp_netif)</code> to stop the DHCP client.</p> <p>Then, use <code>esp_netif_set_ip_info()</code> to configure the desired static IP as shown below:</p> <div class="language-c highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1>// Initialize STA device</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=n>esp_netif_t</span><span class=w> </span><span class=o>*</span><span class=n>esp_netif</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>esp_netif_create_default_wifi_sta</span><span class=p>();</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=c1>// ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=c1>// *************** Configure Static IP ******************</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=n>esp_netif_dhcpc_stop</span><span class=p>(</span><span class=n>esp_netif</span><span class=p>);</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=n>esp_netif_ip_info_t</span><span class=w> </span><span class=n>ipInfo</span><span class=p>;</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=n>ipInfo</span><span class=p>.</span><span class=n>ip</span><span class=p>.</span><span class=n>addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>inet_addr</span><span class=p>(</span><span class=s>&quot;192.168.138.2&quot;</span><span class=p>);</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=n>ipInfo</span><span class=p>.</span><span class=n>netmask</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>inet_addr</span><span class=p>(</span><span class=s>&quot;255.255.255.0&quot;</span><span class=p>);</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=n>ipInfo</span><span class=p>.</span><span class=n>gw</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>inet_addr</span><span class=p>(</span><span class=s>&quot;192.168.138.2&quot;</span><span class=p>);</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=n>esp_netif_set_ip_info</span><span class=p>(</span><span class=n>esp_netif</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>ipInfo</span><span class=p>);</span>
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=n>esp_netif_dhcpc_start</span><span class=p>(</span><span class=n>esp_netif</span><span class=p>);</span>
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=c1>// *************** Configure Static IP ******************</span>
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=c1>// ↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span>
</span></code></pre></div> <h4 id=233-wifi-scan>2.3.3 WIFI Scan<a class=headerlink href=#233-wifi-scan title="Permanent link">&para;</a></h4> <p>After calling <code>esp_wifi_start</code>, Wi-Fi will be started according to the configuration. If you do not immediately connect to the specified Wi-Fi hotspot, you can also use Wi-Fi Scan to search for connectable devices.</p> <ul> <li><code>esp_wifi_scan_start</code>: Scans all available APs.</li> <li><code>esp_wifi_scan_get_ap_records</code>: Retrieves the list of APs found in the last scan.</li> <li><code>esp_wifi_scan_get_ap_num</code>: Retrieves the number of APs found in the last scan.</li> </ul> <p>There is nothing complicated here; it is recommended to refer directly to the official ESP-IDF documentation: <a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-guides/wifi.html#id17 title="Permanent link to the title">ESP32 Wi-Fi Scan</a></p> <h2 id=3-examples>3. Examples<a class=headerlink href=#3-examples title="Permanent link">&para;</a></h2> <h3 id=31-wifi-ap-mode>3.1 WIFI AP Mode<a class=headerlink href=#31-wifi-ap-mode title="Permanent link">&para;</a></h3> <p>Below is an implementation of WIFI AP mode based on the tutorial in Section 2. Code link:</p> <blockquote> <p><a href=https://github.com/DuRuofu/ESP32_Learning/tree/master/05.wifi/wifi_ap>https://github.com/DuRuofu/ESP32_Learning/tree/master/05.wifi/wifi_ap</a></p> </blockquote> <div class="language-c highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;string.h&gt;</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;freertos/FreeRTOS.h&quot;</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;freertos/event_groups.h&quot;</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_wifi.h&quot;</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_log.h&quot;</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_event.h&quot;</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;nvs_flash.h&quot;</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_mac.h&quot;</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=cp>#define ESP_WIFI_AP_SSID &quot;CSW@CEE&quot;</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=cp>#define ESP_WIFI_AP_PASSWD &quot;88888888&quot;</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=kt>void</span><span class=w> </span><span class=nf>WIFI_CallBack</span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_handler_arg</span><span class=p>,</span><span class=w> </span><span class=n>esp_event_base_t</span><span class=w> </span><span class=n>event_base</span><span class=p>,</span><span class=w> </span><span class=kt>int32_t</span><span class=w> </span><span class=n>event_id</span><span class=p>,</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_data</span><span class=p>)</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=p>{</span>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=w>    </span><span class=c1>// Connection event</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT_AP_STAIPASSIGNED</span><span class=p>)</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=w>        </span><span class=c1>// Parse data</span>
</span><span id=__span-13-19><a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a><span class=w>        </span><span class=n>ip_event_ap_staipassigned_t</span><span class=o>*</span><span class=w> </span><span class=n>event_info</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>ip_event_ap_staipassigned_t</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=n>event_data</span><span class=p>;</span>
</span><span id=__span-13-20><a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a><span class=w>        </span><span class=n>ESP_LOGW</span><span class=p>(</span><span class=s>&quot;WIFI_AP&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Device connected, MAC:&quot;</span><span class=w> </span><span class=n>MACSTR</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=n>MAC2STR</span><span class=p>(</span><span class=n>event_info</span><span class=o>-&gt;</span><span class=n>mac</span><span class=p>));</span>
</span><span id=__span-13-21><a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-13-22><a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a>
</span><span id=__span-13-23><a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a><span class=w>    </span><span class=c1>// Disconnection event</span>
</span><span id=__span-13-24><a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT_AP_STADISCONNECTED</span><span class=p>)</span>
</span><span id=__span-13-25><a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-13-26><a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a><span class=w>        </span><span class=n>wifi_event_ap_stadisconnected_t</span><span class=o>*</span><span class=w> </span><span class=n>event_info</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>wifi_event_ap_stadisconnected_t</span><span class=o>*</span><span class=p>)</span><span class=n>event_data</span><span class=p>;</span>
</span><span id=__span-13-27><a id=__codelineno-13-27 name=__codelineno-13-27 href=#__codelineno-13-27></a><span class=w>        </span><span class=n>ESP_LOGW</span><span class=p>(</span><span class=s>&quot;WIFI_AP&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Device disconnected, MAC:&quot;</span><span class=w> </span><span class=n>MACSTR</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=n>MAC2STR</span><span class=p>(</span><span class=n>event_info</span><span class=o>-&gt;</span><span class=n>mac</span><span class=p>));</span>
</span><span id=__span-13-28><a id=__codelineno-13-28 name=__codelineno-13-28 href=#__codelineno-13-28></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-13-29><a id=__codelineno-13-29 name=__codelineno-13-29 href=#__codelineno-13-29></a><span class=p>}</span>
</span><span id=__span-13-30><a id=__codelineno-13-30 name=__codelineno-13-30 href=#__codelineno-13-30></a>
</span><span id=__span-13-31><a id=__codelineno-13-31 name=__codelineno-13-31 href=#__codelineno-13-31></a><span class=kt>void</span><span class=w> </span><span class=nf>app_main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span><span id=__span-13-32><a id=__codelineno-13-32 name=__codelineno-13-32 href=#__codelineno-13-32></a><span class=p>{</span>
</span><span id=__span-13-33><a id=__codelineno-13-33 name=__codelineno-13-33 href=#__codelineno-13-33></a><span class=w>    </span><span class=c1>//---------------- Preparation Phase -------------------</span>
</span><span id=__span-13-34><a id=__codelineno-13-34 name=__codelineno-13-34 href=#__codelineno-13-34></a><span class=w>    </span><span class=c1>// Initialize NVS</span>
</span><span id=__span-13-35><a id=__codelineno-13-35 name=__codelineno-13-35 href=#__codelineno-13-35></a><span class=w>    </span><span class=n>esp_err_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>();</span>
</span><span id=__span-13-36><a id=__codelineno-13-36 name=__codelineno-13-36 href=#__codelineno-13-36></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ret</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>ESP_ERR_NVS_NO_FREE_PAGES</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>ESP_ERR_NVS_NEW_VERSION_FOUND</span><span class=p>)</span>
</span><span id=__span-13-37><a id=__codelineno-13-37 name=__codelineno-13-37 href=#__codelineno-13-37></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-13-38><a id=__codelineno-13-38 name=__codelineno-13-38 href=#__codelineno-13-38></a><span class=w>        </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>nvs_flash_erase</span><span class=p>());</span>
</span><span id=__span-13-39><a id=__codelineno-13-39 name=__codelineno-13-39 href=#__codelineno-13-39></a><span class=w>        </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>();</span>
</span><span id=__span-13-40><a id=__codelineno-13-40 name=__codelineno-13-40 href=#__codelineno-13-40></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-13-41><a id=__codelineno-13-41 name=__codelineno-13-41 href=#__codelineno-13-41></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>ret</span><span class=p>);</span>
</span><span id=__span-13-42><a id=__codelineno-13-42 name=__codelineno-13-42 href=#__codelineno-13-42></a>
</span><span id=__span-13-43><a id=__codelineno-13-43 name=__codelineno-13-43 href=#__codelineno-13-43></a><span class=w>    </span><span class=c1>//--------------- Initialization Phase ------------------</span>
</span><span id=__span-13-44><a id=__codelineno-13-44 name=__codelineno-13-44 href=#__codelineno-13-44></a>
</span><span id=__span-13-45><a id=__codelineno-13-45 name=__codelineno-13-45 href=#__codelineno-13-45></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_netif_init</span><span class=p>());</span>
</span><span id=__span-13-46><a id=__codelineno-13-46 name=__codelineno-13-46 href=#__codelineno-13-46></a>
</span><span id=__span-13-47><a id=__codelineno-13-47 name=__codelineno-13-47 href=#__codelineno-13-47></a><span class=w>    </span><span class=c1>// Initialize default event loop</span>
</span><span id=__span-13-48><a id=__codelineno-13-48 name=__codelineno-13-48 href=#__codelineno-13-48></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_loop_create_default</span><span class=p>());</span>
</span><span id=__span-13-49><a id=__codelineno-13-49 name=__codelineno-13-49 href=#__codelineno-13-49></a><span class=w>    </span><span class=c1>// Register event callback for device connection</span>
</span><span id=__span-13-50><a id=__codelineno-13-50 name=__codelineno-13-50 href=#__codelineno-13-50></a><span class=w>    </span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>IP_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>IP_EVENT_AP_STAIPASSIGNED</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>);</span>
</span><span id=__span-13-51><a id=__codelineno-13-51 name=__codelineno-13-51 href=#__codelineno-13-51></a><span class=w>    </span><span class=c1>// Register event callback for device disconnection</span>
</span><span id=__span-13-52><a id=__codelineno-13-52 name=__codelineno-13-52 href=#__codelineno-13-52></a><span class=w>    </span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>WIFI_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_EVENT_AP_STADISCONNECTED</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>);</span>
</span><span id=__span-13-53><a id=__codelineno-13-53 name=__codelineno-13-53 href=#__codelineno-13-53></a>
</span><span id=__span-13-54><a id=__codelineno-13-54 name=__codelineno-13-54 href=#__codelineno-13-54></a><span class=w>    </span><span class=c1>// *esp_netif_ap can be used to modify AP settings</span>
</span><span id=__span-13-55><a id=__codelineno-13-55 name=__codelineno-13-55 href=#__codelineno-13-55></a><span class=w>    </span><span class=n>esp_netif_t</span><span class=w> </span><span class=o>*</span><span class=n>esp_netif_ap</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>esp_netif_create_default_wifi_ap</span><span class=p>();</span>
</span><span id=__span-13-56><a id=__codelineno-13-56 name=__codelineno-13-56 href=#__codelineno-13-56></a>
</span><span id=__span-13-57><a id=__codelineno-13-57 name=__codelineno-13-57 href=#__codelineno-13-57></a><span class=w>    </span><span class=cm>/* Initialize WiFi */</span>
</span><span id=__span-13-58><a id=__codelineno-13-58 name=__codelineno-13-58 href=#__codelineno-13-58></a><span class=w>    </span><span class=n>wifi_init_config_t</span><span class=w> </span><span class=n>cfg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WIFI_INIT_CONFIG_DEFAULT</span><span class=p>();</span>
</span><span id=__span-13-59><a id=__codelineno-13-59 name=__codelineno-13-59 href=#__codelineno-13-59></a><span class=w>    </span><span class=c1>// WIFI_INIT_CONFIG_DEFAULT is a macro for the default configuration</span>
</span><span id=__span-13-60><a id=__codelineno-13-60 name=__codelineno-13-60 href=#__codelineno-13-60></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_init</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cfg</span><span class=p>));</span>
</span><span id=__span-13-61><a id=__codelineno-13-61 name=__codelineno-13-61 href=#__codelineno-13-61></a>
</span><span id=__span-13-62><a id=__codelineno-13-62 name=__codelineno-13-62 href=#__codelineno-13-62></a><span class=w>    </span><span class=c1>//--------------- Configuration Phase --------------------</span>
</span><span id=__span-13-63><a id=__codelineno-13-63 name=__codelineno-13-63 href=#__codelineno-13-63></a><span class=w>    </span><span class=c1>// Set to AP mode</span>
</span><span id=__span-13-64><a id=__codelineno-13-64 name=__codelineno-13-64 href=#__codelineno-13-64></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_set_mode</span><span class=p>(</span><span class=n>WIFI_MODE_AP</span><span class=p>));</span>
</span><span id=__span-13-65><a id=__codelineno-13-65 name=__codelineno-13-65 href=#__codelineno-13-65></a>
</span><span id=__span-13-66><a id=__codelineno-13-66 name=__codelineno-13-66 href=#__codelineno-13-66></a><span class=w>    </span><span class=c1>// Detailed AP configuration</span>
</span><span id=__span-13-67><a id=__codelineno-13-67 name=__codelineno-13-67 href=#__codelineno-13-67></a><span class=w>    </span><span class=n>wifi_config_t</span><span class=w> </span><span class=n>wifi_ap_config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-68><a id=__codelineno-13-68 name=__codelineno-13-68 href=#__codelineno-13-68></a><span class=w>        </span><span class=p>.</span><span class=n>ap</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-69><a id=__codelineno-13-69 name=__codelineno-13-69 href=#__codelineno-13-69></a><span class=w>            </span><span class=p>.</span><span class=n>ssid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ESP_WIFI_AP_SSID</span><span class=p>,</span><span class=w>             </span><span class=c1>// WiFi name</span>
</span><span id=__span-13-70><a id=__codelineno-13-70 name=__codelineno-13-70 href=#__codelineno-13-70></a><span class=w>            </span><span class=p>.</span><span class=n>ssid_len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strlen</span><span class=p>(</span><span class=n>ESP_WIFI_AP_SSID</span><span class=p>),</span><span class=w>   </span><span class=c1>// Length of the name</span>
</span><span id=__span-13-71><a id=__codelineno-13-71 name=__codelineno-13-71 href=#__codelineno-13-71></a><span class=w>            </span><span class=p>.</span><span class=n>channel</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w>                           </span><span class=c1>// WiFi channel</span>
</span><span id=__span-13-72><a id=__codelineno-13-72 name=__codelineno-13-72 href=#__codelineno-13-72></a><span class=w>            </span><span class=p>.</span><span class=n>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ESP_WIFI_AP_PASSWD</span><span class=p>,</span><span class=w>         </span><span class=c1>// WiFi password</span>
</span><span id=__span-13-73><a id=__codelineno-13-73 name=__codelineno-13-73 href=#__codelineno-13-73></a><span class=w>            </span><span class=p>.</span><span class=n>max_connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>,</span><span class=w>                    </span><span class=c1>// Maximum connections (default is 10)</span>
</span><span id=__span-13-74><a id=__codelineno-13-74 name=__codelineno-13-74 href=#__codelineno-13-74></a><span class=w>            </span><span class=p>.</span><span class=n>authmode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WIFI_AUTH_WPA2_PSK</span><span class=p>,</span><span class=w>         </span><span class=c1>// WiFi authentication mode</span>
</span><span id=__span-13-75><a id=__codelineno-13-75 name=__codelineno-13-75 href=#__codelineno-13-75></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-13-76><a id=__codelineno-13-76 name=__codelineno-13-76 href=#__codelineno-13-76></a><span class=w>    </span><span class=p>};</span>
</span><span id=__span-13-77><a id=__codelineno-13-77 name=__codelineno-13-77 href=#__codelineno-13-77></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_set_config</span><span class=p>(</span><span class=n>WIFI_IF_AP</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>wifi_ap_config</span><span class=p>));</span>
</span><span id=__span-13-78><a id=__codelineno-13-78 name=__codelineno-13-78 href=#__codelineno-13-78></a>
</span><span id=__span-13-79><a id=__codelineno-13-79 name=__codelineno-13-79 href=#__codelineno-13-79></a><span class=w>    </span><span class=c1>//--------------- Startup Phase --------------------</span>
</span><span id=__span-13-80><a id=__codelineno-13-80 name=__codelineno-13-80 href=#__codelineno-13-80></a><span class=w>    </span><span class=cm>/* Start WiFi */</span>
</span><span id=__span-13-81><a id=__codelineno-13-81 name=__codelineno-13-81 href=#__codelineno-13-81></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_start</span><span class=p>());</span>
</span><span id=__span-13-82><a id=__codelineno-13-82 name=__codelineno-13-82 href=#__codelineno-13-82></a><span class=p>}</span>
</span></code></pre></div> <p>Demonstration:</p> <p><img alt src=../20240314220318.png></p> <p>When a device connects to the WiFi, the connection information of the device will be printed.</p> <h3 id=32-wifi-sta-mode>3.2 WIFI STA Mode<a class=headerlink href=#32-wifi-sta-mode title="Permanent link">&para;</a></h3> <p>Below is an implementation of WIFI STA mode based on the tutorial in Section 2. Code link:</p> <blockquote> <p><a href=https://github.com/DuRuofu/ESP32_Learning/tree/master/05.wifi/wifi_sta>https://github.com/DuRuofu/ESP32_Learning/tree/master/05.wifi/wifi_sta</a></p> </blockquote> <div class="language-c highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;string.h&gt;</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;freertos/FreeRTOS.h&quot;</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;freertos/event_groups.h&quot;</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_wifi.h&quot;</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_log.h&quot;</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_event.h&quot;</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;nvs_flash.h&quot;</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_mac.h&quot;</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=cp>#define ESP_WIFI_STA_SSID &quot;CSW@CEE&quot;</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=cp>#define ESP_WIFI_STA_PASSWD &quot;88888888&quot;</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=kt>void</span><span class=w> </span><span class=nf>WIFI_CallBack</span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_handler_arg</span><span class=p>,</span><span class=w> </span><span class=n>esp_event_base_t</span><span class=w> </span><span class=n>event_base</span><span class=p>,</span><span class=w> </span><span class=kt>int32_t</span><span class=w> </span><span class=n>event_id</span><span class=p>,</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>event_data</span><span class=p>)</span>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=p>{</span>
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a><span class=w>    </span><span class=k>static</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>connect_count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a><span class=w>    </span><span class=c1>// WIFI startup successful</span>
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT_STA_START</span><span class=p>)</span>
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-14-20><a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=w>        </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;WIFI_EVENT_STA_START&quot;</span><span class=p>);</span>
</span><span id=__span-14-21><a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=w>        </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_connect</span><span class=p>());</span>
</span><span id=__span-14-22><a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-14-23><a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a><span class=w>    </span><span class=c1>// WIFI connection failed</span>
</span><span id=__span-14-24><a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT_STA_DISCONNECTED</span><span class=p>)</span>
</span><span id=__span-14-25><a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-14-26><a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a><span class=w>        </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;WIFI_EVENT_STA_DISCONNECTED&quot;</span><span class=p>);</span>
</span><span id=__span-14-27><a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a><span class=w>        </span><span class=n>connect_count</span><span class=o>++</span><span class=p>;</span>
</span><span id=__span-14-28><a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>connect_count</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>6</span><span class=p>)</span>
</span><span id=__span-14-29><a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-14-30><a id=__codelineno-14-30 name=__codelineno-14-30 href=#__codelineno-14-30></a><span class=w>            </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_connect</span><span class=p>());</span>
</span><span id=__span-14-31><a id=__codelineno-14-31 name=__codelineno-14-31 href=#__codelineno-14-31></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-14-32><a id=__codelineno-14-32 name=__codelineno-14-32 href=#__codelineno-14-32></a><span class=w>        </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-33><a id=__codelineno-14-33 name=__codelineno-14-33 href=#__codelineno-14-33></a><span class=w>            </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;WIFI_EVENT_STA_DISCONNECTED 10 times&quot;</span><span class=p>);</span>
</span><span id=__span-14-34><a id=__codelineno-14-34 name=__codelineno-14-34 href=#__codelineno-14-34></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-14-35><a id=__codelineno-14-35 name=__codelineno-14-35 href=#__codelineno-14-35></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-14-36><a id=__codelineno-14-36 name=__codelineno-14-36 href=#__codelineno-14-36></a><span class=w>    </span><span class=c1>// WIFI connection successful (IP acquired)</span>
</span><span id=__span-14-37><a id=__codelineno-14-37 name=__codelineno-14-37 href=#__codelineno-14-37></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT_STA_GOT_IP</span><span class=p>)</span>
</span><span id=__span-14-38><a id=__codelineno-14-38 name=__codelineno-14-38 href=#__codelineno-14-38></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-14-39><a id=__codelineno-14-39 name=__codelineno-14-39 href=#__codelineno-14-39></a><span class=w>        </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;WIFI_EVENT_STA_GOT_IP&quot;</span><span class=p>);</span>
</span><span id=__span-14-40><a id=__codelineno-14-40 name=__codelineno-14-40 href=#__codelineno-14-40></a><span class=w>        </span><span class=n>ip_event_got_ip_t</span><span class=w> </span><span class=o>*</span><span class=n>info</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>ip_event_got_ip_t</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=n>event_data</span><span class=p>;</span>
</span><span id=__span-14-41><a id=__codelineno-14-41 name=__codelineno-14-41 href=#__codelineno-14-41></a><span class=w>        </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=s>&quot;WIFI_EVENT&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;got ip:&quot;</span><span class=w> </span><span class=n>IPSTR</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>,</span><span class=w> </span><span class=n>IP2STR</span><span class=p>(</span><span class=o>&amp;</span><span class=n>info</span><span class=o>-&gt;</span><span class=n>ip_info</span><span class=p>.</span><span class=n>ip</span><span class=p>));</span>
</span><span id=__span-14-42><a id=__codelineno-14-42 name=__codelineno-14-42 href=#__codelineno-14-42></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-14-43><a id=__codelineno-14-43 name=__codelineno-14-43 href=#__codelineno-14-43></a><span class=p>}</span>
</span><span id=__span-14-44><a id=__codelineno-14-44 name=__codelineno-14-44 href=#__codelineno-14-44></a>
</span><span id=__span-14-45><a id=__codelineno-14-45 name=__codelineno-14-45 href=#__codelineno-14-45></a><span class=kt>void</span><span class=w> </span><span class=nf>app_main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span><span id=__span-14-46><a id=__codelineno-14-46 name=__codelineno-14-46 href=#__codelineno-14-46></a><span class=p>{</span>
</span><span id=__span-14-47><a id=__codelineno-14-47 name=__codelineno-14-47 href=#__codelineno-14-47></a><span class=w>    </span><span class=c1>//---------------- Preparation Phase -------------------</span>
</span><span id=__span-14-48><a id=__codelineno-14-48 name=__codelineno-14-48 href=#__codelineno-14-48></a><span class=w>    </span><span class=c1>// Initialize NVS</span>
</span><span id=__span-14-49><a id=__codelineno-14-49 name=__codelineno-14-49 href=#__codelineno-14-49></a><span class=w>    </span><span class=n>esp_err_t</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>();</span>
</span><span id=__span-14-50><a id=__codelineno-14-50 name=__codelineno-14-50 href=#__codelineno-14-50></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ret</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>ESP_ERR_NVS_NO_FREE_PAGES</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>ESP_ERR_NVS_NEW_VERSION_FOUND</span><span class=p>)</span>
</span><span id=__span-14-51><a id=__codelineno-14-51 name=__codelineno-14-51 href=#__codelineno-14-51></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-14-52><a id=__codelineno-14-52 name=__codelineno-14-52 href=#__codelineno-14-52></a><span class=w>        </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>nvs_flash_erase</span><span class=p>());</span>
</span><span id=__span-14-53><a id=__codelineno-14-53 name=__codelineno-14-53 href=#__codelineno-14-53></a><span class=w>        </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>();</span>
</span><span id=__span-14-54><a id=__codelineno-14-54 name=__codelineno-14-54 href=#__codelineno-14-54></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-14-55><a id=__codelineno-14-55 name=__codelineno-14-55 href=#__codelineno-14-55></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>ret</span><span class=p>);</span>
</span><span id=__span-14-56><a id=__codelineno-14-56 name=__codelineno-14-56 href=#__codelineno-14-56></a>
</span><span id=__span-14-57><a id=__codelineno-14-57 name=__codelineno-14-57 href=#__codelineno-14-57></a><span class=w>    </span><span class=c1>//---------------- Initialization Phase -------------------</span>
</span><span id=__span-14-58><a id=__codelineno-14-58 name=__codelineno-14-58 href=#__codelineno-14-58></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_netif_init</span><span class=p>());</span>
</span><span id=__span-14-59><a id=__codelineno-14-59 name=__codelineno-14-59 href=#__codelineno-14-59></a>
</span><span id=__span-14-60><a id=__codelineno-14-60 name=__codelineno-14-60 href=#__codelineno-14-60></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_loop_create_default</span><span class=p>());</span>
</span><span id=__span-14-61><a id=__codelineno-14-61 name=__codelineno-14-61 href=#__codelineno-14-61></a><span class=w>    </span><span class=c1>// Register event (WIFI startup successful)</span>
</span><span id=__span-14-62><a id=__codelineno-14-62 name=__codelineno-14-62 href=#__codelineno-14-62></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>WIFI_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_EVENT_STA_START</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>));</span>
</span><span id=__span-14-63><a id=__codelineno-14-63 name=__codelineno-14-63 href=#__codelineno-14-63></a><span class=w>    </span><span class=c1>// Register event (WIFI connection failed)</span>
</span><span id=__span-14-64><a id=__codelineno-14-64 name=__codelineno-14-64 href=#__codelineno-14-64></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>WIFI_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_EVENT_STA_DISCONNECTED</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>));</span>
</span><span id=__span-14-65><a id=__codelineno-14-65 name=__codelineno-14-65 href=#__codelineno-14-65></a><span class=w>    </span><span class=c1>// Register event (WIFI connection successful - IP acquired)</span>
</span><span id=__span-14-66><a id=__codelineno-14-66 name=__codelineno-14-66 href=#__codelineno-14-66></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_handler_instance_register</span><span class=p>(</span><span class=n>IP_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>IP_EVENT_STA_GOT_IP</span><span class=p>,</span><span class=w> </span><span class=n>WIFI_CallBack</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>));</span>
</span><span id=__span-14-67><a id=__codelineno-14-67 name=__codelineno-14-67 href=#__codelineno-14-67></a>
</span><span id=__span-14-68><a id=__codelineno-14-68 name=__codelineno-14-68 href=#__codelineno-14-68></a><span class=w>    </span><span class=c1>// Initialize STA device</span>
</span><span id=__span-14-69><a id=__codelineno-14-69 name=__codelineno-14-69 href=#__codelineno-14-69></a><span class=w>    </span><span class=n>esp_netif_create_default_wifi_sta</span><span class=p>();</span>
</span><span id=__span-14-70><a id=__codelineno-14-70 name=__codelineno-14-70 href=#__codelineno-14-70></a>
</span><span id=__span-14-71><a id=__codelineno-14-71 name=__codelineno-14-71 href=#__codelineno-14-71></a><span class=w>    </span><span class=cm>/* Initialize WiFi */</span>
</span><span id=__span-14-72><a id=__codelineno-14-72 name=__codelineno-14-72 href=#__codelineno-14-72></a><span class=w>    </span><span class=n>wifi_init_config_t</span><span class=w> </span><span class=n>cfg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WIFI_INIT_CONFIG_DEFAULT</span><span class=p>();</span>
</span><span id=__span-14-73><a id=__codelineno-14-73 name=__codelineno-14-73 href=#__codelineno-14-73></a><span class=w>    </span><span class=c1>// WIFI_INIT_CONFIG_DEFAULT is a macro for the default configuration</span>
</span><span id=__span-14-74><a id=__codelineno-14-74 name=__codelineno-14-74 href=#__codelineno-14-74></a>
</span><span id=__span-14-75><a id=__codelineno-14-75 name=__codelineno-14-75 href=#__codelineno-14-75></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_init</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cfg</span><span class=p>));</span>
</span><span id=__span-14-76><a id=__codelineno-14-76 name=__codelineno-14-76 href=#__codelineno-14-76></a>
</span><span id=__span-14-77><a id=__codelineno-14-77 name=__codelineno-14-77 href=#__codelineno-14-77></a><span class=w>    </span><span class=c1>//---------------- Configuration Phase -------------------</span>
</span><span id=__span-14-78><a id=__codelineno-14-78 name=__codelineno-14-78 href=#__codelineno-14-78></a><span class=w>    </span><span class=c1>// Set to STA mode</span>
</span><span id=__span-14-79><a id=__codelineno-14-79 name=__codelineno-14-79 href=#__codelineno-14-79></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_set_mode</span><span class=p>(</span><span class=n>WIFI_MODE_STA</span><span class=p>));</span>
</span><span id=__span-14-80><a id=__codelineno-14-80 name=__codelineno-14-80 href=#__codelineno-14-80></a>
</span><span id=__span-14-81><a id=__codelineno-14-81 name=__codelineno-14-81 href=#__codelineno-14-81></a><span class=w>    </span><span class=c1>// Detailed STA configuration</span>
</span><span id=__span-14-82><a id=__codelineno-14-82 name=__codelineno-14-82 href=#__codelineno-14-82></a><span class=w>    </span><span class=n>wifi_config_t</span><span class=w> </span><span class=n>sta_config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-83><a id=__codelineno-14-83 name=__codelineno-14-83 href=#__codelineno-14-83></a><span class=w>        </span><span class=p>.</span><span class=n>sta</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-84><a id=__codelineno-14-84 name=__codelineno-14-84 href=#__codelineno-14-84></a><span class=w>            </span><span class=p>.</span><span class=n>ssid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ESP_WIFI_STA_SSID</span><span class=p>,</span>
</span><span id=__span-14-85><a id=__codelineno-14-85 name=__codelineno-14-85 href=#__codelineno-14-85></a><span class=w>            </span><span class=p>.</span><span class=n>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ESP_WIFI_STA_PASSWD</span><span class=p>,</span>
</span><span id=__span-14-86><a id=__codelineno-14-86 name=__codelineno-14-86 href=#__codelineno-14-86></a><span class=w>            </span><span class=p>.</span><span class=n>bssid_set</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>false</span><span class=p>,</span>
</span><span id=__span-14-87><a id=__codelineno-14-87 name=__codelineno-14-87 href=#__codelineno-14-87></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-14-88><a id=__codelineno-14-88 name=__codelineno-14-88 href=#__codelineno-14-88></a><span class=w>    </span><span class=p>};</span>
</span><span id=__span-14-89><a id=__codelineno-14-89 name=__codelineno-14-89 href=#__codelineno-14-89></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_set_config</span><span class=p>(</span><span class=n>WIFI_IF_STA</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>sta_config</span><span class=p>));</span>
</span><span id=__span-14-90><a id=__codelineno-14-90 name=__codelineno-14-90 href=#__codelineno-14-90></a>
</span><span id=__span-14-91><a id=__codelineno-14-91 name=__codelineno-14-91 href=#__codelineno-14-91></a><span class=w>    </span><span class=c1>//---------------- Startup Phase -------------------</span>
</span><span id=__span-14-92><a id=__codelineno-14-92 name=__codelineno-14-92 href=#__codelineno-14-92></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_wifi_start</span><span class=p>());</span>
</span><span id=__span-14-93><a id=__codelineno-14-93 name=__codelineno-14-93 href=#__codelineno-14-93></a><span class=p>}</span>
</span></code></pre></div> <p>Effect as shown:</p> <p><img alt src=../20240315084947.png></p> <h3 id=33-wifi-sta-mode-for-campus-networks>3.3 WIFI STA Mode for Campus Networks<a class=headerlink href=#33-wifi-sta-mode-for-campus-networks title="Permanent link">&para;</a></h3> <div class="admonition tip"> <p class=admonition-title>Connecting to Campus Wi-Fi via WPA2-ENTERPRISE Mode</p> <p>The above code is suitable for ordinary home routers. If you want to connect to a campus Wi-Fi network, which is a bit more complex, please refer to the <a href=https://github.com/espressif/esp-idf/tree/v5.2.4/examples/wifi/wifi_enterprise>official documentation</a> and the <a href=https://github.com/espressif/esp-idf/blob/v5.2.4/examples/wifi/wifi_enterprise/main/wifi_enterprise_main.c>official code</a>. Below is the code that I have personally modified and successfully tested.</p> </div> <p><div class="language-c highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=cm>/* WiFi Connection Example using WPA2 Enterprise</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=cm> *</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=cm> * Original Copyright (C) 2006-2016, ARM Limited, All Rights Reserved, Apache 2.0 License.</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=cm> * Additions Copyright (C) Copyright 2015-2016 Espressif Systems (Shanghai) PTE LTD, Apache 2.0 License.</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=cm> *</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=cm> *</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=cm> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=cm> * you may not use this file except in compliance with the License.</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=cm> * You may obtain a copy of the License at</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=cm> *</span>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=cm> *     http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=cm> *</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=cm> * Unless required by applicable law or agreed to in writing, software</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=cm> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=cm> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=cm> * See the License for the specific language governing permissions and</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=cm> * limitations under the License.</span>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=cm> */</span>
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;string.h&gt;</span>
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdlib.h&gt;</span>
</span><span id=__span-15-21><a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;freertos/FreeRTOS.h&quot;</span>
</span><span id=__span-15-22><a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;freertos/task.h&quot;</span>
</span><span id=__span-15-23><a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;freertos/event_groups.h&quot;</span>
</span><span id=__span-15-24><a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_wifi.h&quot;</span>
</span><span id=__span-15-25><a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_wpa2.h&quot;</span>
</span><span id=__span-15-26><a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_event.h&quot;</span>
</span><span id=__span-15-27><a id=__codelineno-15-27 name=__codelineno-15-27 href=#__codelineno-15-27></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_log.h&quot;</span>
</span><span id=__span-15-28><a id=__codelineno-15-28 name=__codelineno-15-28 href=#__codelineno-15-28></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_system.h&quot;</span>
</span><span id=__span-15-29><a id=__codelineno-15-29 name=__codelineno-15-29 href=#__codelineno-15-29></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;nvs_flash.h&quot;</span>
</span><span id=__span-15-30><a id=__codelineno-15-30 name=__codelineno-15-30 href=#__codelineno-15-30></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;esp_netif.h&quot;</span>
</span><span id=__span-15-31><a id=__codelineno-15-31 name=__codelineno-15-31 href=#__codelineno-15-31></a>
</span><span id=__span-15-32><a id=__codelineno-15-32 name=__codelineno-15-32 href=#__codelineno-15-32></a><span class=cp>#define CONFIG_EXAMPLE_EAP_METHOD_PEAP 1</span>
</span><span id=__span-15-33><a id=__codelineno-15-33 name=__codelineno-15-33 href=#__codelineno-15-33></a>
</span><span id=__span-15-34><a id=__codelineno-15-34 name=__codelineno-15-34 href=#__codelineno-15-34></a><span class=cm>/* The examples use simple WiFi configuration that you can set via</span>
</span><span id=__span-15-35><a id=__codelineno-15-35 name=__codelineno-15-35 href=#__codelineno-15-35></a><span class=cm>   project configuration menu.</span>
</span><span id=__span-15-36><a id=__codelineno-15-36 name=__codelineno-15-36 href=#__codelineno-15-36></a>
</span><span id=__span-15-37><a id=__codelineno-15-37 name=__codelineno-15-37 href=#__codelineno-15-37></a><span class=cm>   If you&#39;d rather not, just change the below entries to strings with</span>
</span><span id=__span-15-38><a id=__codelineno-15-38 name=__codelineno-15-38 href=#__codelineno-15-38></a><span class=cm>   the config you want - ie #define EXAMPLE_WIFI_SSID &quot;mywifissid&quot;</span>
</span><span id=__span-15-39><a id=__codelineno-15-39 name=__codelineno-15-39 href=#__codelineno-15-39></a>
</span><span id=__span-15-40><a id=__codelineno-15-40 name=__codelineno-15-40 href=#__codelineno-15-40></a><span class=cm>   You can choose EAP method via project configuration according to the</span>
</span><span id=__span-15-41><a id=__codelineno-15-41 name=__codelineno-15-41 href=#__codelineno-15-41></a><span class=cm>   configuration of AP.</span>
</span><span id=__span-15-42><a id=__codelineno-15-42 name=__codelineno-15-42 href=#__codelineno-15-42></a><span class=cm>*/</span>
</span><span id=__span-15-43><a id=__codelineno-15-43 name=__codelineno-15-43 href=#__codelineno-15-43></a><span class=cp>#define EXAMPLE_WIFI_SSID &quot;your_ssid&quot; </span><span class=c1>//SSID of WiFi</span>
</span><span id=__span-15-44><a id=__codelineno-15-44 name=__codelineno-15-44 href=#__codelineno-15-44></a><span class=cp>#define EXAMPLE_EAP_METHOD CONFIG_EXAMPLE_EAP_METHOD  </span><span class=c1>//This can be set in Configuration Menu</span>
</span><span id=__span-15-45><a id=__codelineno-15-45 name=__codelineno-15-45 href=#__codelineno-15-45></a>
</span><span id=__span-15-46><a id=__codelineno-15-46 name=__codelineno-15-46 href=#__codelineno-15-46></a><span class=c1>// #define EXAMPLE_EAP_ID &quot;Your_UPI/UserID&quot;</span>
</span><span id=__span-15-47><a id=__codelineno-15-47 name=__codelineno-15-47 href=#__codelineno-15-47></a><span class=cp>#define EXAMPLE_EAP_USERNAME &quot;your_username&quot;</span>
</span><span id=__span-15-48><a id=__codelineno-15-48 name=__codelineno-15-48 href=#__codelineno-15-48></a><span class=cp>#define EXAMPLE_EAP_PASSWORD &quot;your_password&quot;</span>
</span><span id=__span-15-49><a id=__codelineno-15-49 name=__codelineno-15-49 href=#__codelineno-15-49></a>
</span><span id=__span-15-50><a id=__codelineno-15-50 name=__codelineno-15-50 href=#__codelineno-15-50></a><span class=cm>/* FreeRTOS event group to signal when we are connected &amp; ready to make a request */</span>
</span><span id=__span-15-51><a id=__codelineno-15-51 name=__codelineno-15-51 href=#__codelineno-15-51></a><span class=k>static</span><span class=w> </span><span class=n>EventGroupHandle_t</span><span class=w> </span><span class=n>wifi_event_group</span><span class=p>;</span>
</span><span id=__span-15-52><a id=__codelineno-15-52 name=__codelineno-15-52 href=#__codelineno-15-52></a>
</span><span id=__span-15-53><a id=__codelineno-15-53 name=__codelineno-15-53 href=#__codelineno-15-53></a><span class=cm>/* esp netif object representing the WIFI station */</span>
</span><span id=__span-15-54><a id=__codelineno-15-54 name=__codelineno-15-54 href=#__codelineno-15-54></a><span class=k>static</span><span class=w> </span><span class=n>esp_netif_t</span><span class=w> </span><span class=o>*</span><span class=n>sta_netif</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>NULL</span><span class=p>;</span>
</span><span id=__span-15-55><a id=__codelineno-15-55 name=__codelineno-15-55 href=#__codelineno-15-55></a>
</span><span id=__span-15-56><a id=__codelineno-15-56 name=__codelineno-15-56 href=#__codelineno-15-56></a><span class=cm>/* The event group allows multiple bits for each event,</span>
</span><span id=__span-15-57><a id=__codelineno-15-57 name=__codelineno-15-57 href=#__codelineno-15-57></a><span class=cm>   but we only care about one event - are we connected</span>
</span><span id=__span-15-58><a id=__codelineno-15-58 name=__codelineno-15-58 href=#__codelineno-15-58></a><span class=cm>   to the AP with an IP? */</span>
</span><span id=__span-15-59><a id=__codelineno-15-59 name=__codelineno-15-59 href=#__codelineno-15-59></a><span class=k>const</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>CONNECTED_BIT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>BIT0</span><span class=p>;</span>
</span><span id=__span-15-60><a id=__codelineno-15-60 name=__codelineno-15-60 href=#__codelineno-15-60></a>
</span><span id=__span-15-61><a id=__codelineno-15-61 name=__codelineno-15-61 href=#__codelineno-15-61></a><span class=k>static</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>TAG</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;CSW-WIFI&quot;</span><span class=p>;</span>
</span><span id=__span-15-62><a id=__codelineno-15-62 name=__codelineno-15-62 href=#__codelineno-15-62></a>
</span><span id=__span-15-63><a id=__codelineno-15-63 name=__codelineno-15-63 href=#__codelineno-15-63></a><span class=cm>/* CA cert, taken from wpa2_ca.pem</span>
</span><span id=__span-15-64><a id=__codelineno-15-64 name=__codelineno-15-64 href=#__codelineno-15-64></a><span class=cm>   Client cert, taken from wpa2_client.crt</span>
</span><span id=__span-15-65><a id=__codelineno-15-65 name=__codelineno-15-65 href=#__codelineno-15-65></a><span class=cm>   Client key, taken from wpa2_client.key</span>
</span><span id=__span-15-66><a id=__codelineno-15-66 name=__codelineno-15-66 href=#__codelineno-15-66></a>
</span><span id=__span-15-67><a id=__codelineno-15-67 name=__codelineno-15-67 href=#__codelineno-15-67></a><span class=cm>   The PEM, CRT and KEY file were provided by the person or organization</span>
</span><span id=__span-15-68><a id=__codelineno-15-68 name=__codelineno-15-68 href=#__codelineno-15-68></a><span class=cm>   who configured the AP with wpa2 enterprise.</span>
</span><span id=__span-15-69><a id=__codelineno-15-69 name=__codelineno-15-69 href=#__codelineno-15-69></a>
</span><span id=__span-15-70><a id=__codelineno-15-70 name=__codelineno-15-70 href=#__codelineno-15-70></a><span class=cm>   To embed it in the app binary, the PEM, CRT and KEY file is named</span>
</span><span id=__span-15-71><a id=__codelineno-15-71 name=__codelineno-15-71 href=#__codelineno-15-71></a><span class=cm>   in the component.mk COMPONENT_EMBED_TXTFILES variable.</span>
</span><span id=__span-15-72><a id=__codelineno-15-72 name=__codelineno-15-72 href=#__codelineno-15-72></a><span class=cm>*/</span>
</span><span id=__span-15-73><a id=__codelineno-15-73 name=__codelineno-15-73 href=#__codelineno-15-73></a><span class=cp>#ifdef CONFIG_EXAMPLE_VALIDATE_SERVER_CERT</span>
</span><span id=__span-15-74><a id=__codelineno-15-74 name=__codelineno-15-74 href=#__codelineno-15-74></a><span class=k>extern</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>ca_pem_start</span><span class=p>[]</span><span class=w> </span><span class=k>asm</span><span class=p>(</span><span class=s>&quot;_binary_wpa2_ca_pem_start&quot;</span><span class=p>);</span>
</span><span id=__span-15-75><a id=__codelineno-15-75 name=__codelineno-15-75 href=#__codelineno-15-75></a><span class=k>extern</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>ca_pem_end</span><span class=p>[]</span><span class=w>   </span><span class=k>asm</span><span class=p>(</span><span class=s>&quot;_binary_wpa2_ca_pem_end&quot;</span><span class=p>);</span>
</span><span id=__span-15-76><a id=__codelineno-15-76 name=__codelineno-15-76 href=#__codelineno-15-76></a><span class=cp>#endif </span><span class=cm>/* CONFIG_EXAMPLE_VALIDATE_SERVER_CERT */</span>
</span><span id=__span-15-77><a id=__codelineno-15-77 name=__codelineno-15-77 href=#__codelineno-15-77></a>
</span><span id=__span-15-78><a id=__codelineno-15-78 name=__codelineno-15-78 href=#__codelineno-15-78></a><span class=cp>#ifdef CONFIG_EXAMPLE_EAP_METHOD_TLS</span>
</span><span id=__span-15-79><a id=__codelineno-15-79 name=__codelineno-15-79 href=#__codelineno-15-79></a><span class=k>extern</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>client_crt_start</span><span class=p>[]</span><span class=w> </span><span class=k>asm</span><span class=p>(</span><span class=s>&quot;_binary_wpa2_client_crt_start&quot;</span><span class=p>);</span>
</span><span id=__span-15-80><a id=__codelineno-15-80 name=__codelineno-15-80 href=#__codelineno-15-80></a><span class=k>extern</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>client_crt_end</span><span class=p>[]</span><span class=w>   </span><span class=k>asm</span><span class=p>(</span><span class=s>&quot;_binary_wpa2_client_crt_end&quot;</span><span class=p>);</span>
</span><span id=__span-15-81><a id=__codelineno-15-81 name=__codelineno-15-81 href=#__codelineno-15-81></a><span class=k>extern</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>client_key_start</span><span class=p>[]</span><span class=w> </span><span class=k>asm</span><span class=p>(</span><span class=s>&quot;_binary_wpa2_client_key_start&quot;</span><span class=p>);</span>
</span><span id=__span-15-82><a id=__codelineno-15-82 name=__codelineno-15-82 href=#__codelineno-15-82></a><span class=k>extern</span><span class=w> </span><span class=kt>uint8_t</span><span class=w> </span><span class=n>client_key_end</span><span class=p>[]</span><span class=w>   </span><span class=k>asm</span><span class=p>(</span><span class=s>&quot;_binary_wpa2_client_key_end&quot;</span><span class=p>);</span>
</span><span id=__span-15-83><a id=__codelineno-15-83 name=__codelineno-15-83 href=#__codelineno-15-83></a><span class=cp>#endif </span><span class=cm>/* CONFIG_EXAMPLE_EAP_METHOD_TLS */</span>
</span><span id=__span-15-84><a id=__codelineno-15-84 name=__codelineno-15-84 href=#__codelineno-15-84></a>
</span><span id=__span-15-85><a id=__codelineno-15-85 name=__codelineno-15-85 href=#__codelineno-15-85></a><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>event_handler</span><span class=p>(</span><span class=kt>void</span><span class=o>*</span><span class=w> </span><span class=n>arg</span><span class=p>,</span><span class=w> </span><span class=n>esp_event_base_t</span><span class=w> </span><span class=n>event_base</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-15-86><a id=__codelineno-15-86 name=__codelineno-15-86 href=#__codelineno-15-86></a><span class=w>                                </span><span class=kt>int32_t</span><span class=w> </span><span class=n>event_id</span><span class=p>,</span><span class=w> </span><span class=kt>void</span><span class=o>*</span><span class=w> </span><span class=n>event_data</span><span class=p>)</span>
</span><span id=__span-15-87><a id=__codelineno-15-87 name=__codelineno-15-87 href=#__codelineno-15-87></a><span class=p>{</span>
</span><span id=__span-15-88><a id=__codelineno-15-88 name=__codelineno-15-88 href=#__codelineno-15-88></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT_STA_START</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-89><a id=__codelineno-15-89 name=__codelineno-15-89 href=#__codelineno-15-89></a><span class=w>        </span><span class=n>esp_wifi_connect</span><span class=p>();</span>
</span><span id=__span-15-90><a id=__codelineno-15-90 name=__codelineno-15-90 href=#__codelineno-15-90></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WIFI_EVENT_STA_DISCONNECTED</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-91><a id=__codelineno-15-91 name=__codelineno-15-91 href=#__codelineno-15-91></a><span class=w>        </span><span class=n>esp_wifi_connect</span><span class=p>();</span>
</span><span id=__span-15-92><a id=__codelineno-15-92 name=__codelineno-15-92 href=#__codelineno-15-92></a><span class=w>        </span><span class=n>xEventGroupClearBits</span><span class=p>(</span><span class=n>wifi_event_group</span><span class=p>,</span><span class=w> </span><span class=n>CONNECTED_BIT</span><span class=p>);</span>
</span><span id=__span-15-93><a id=__codelineno-15-93 name=__codelineno-15-93 href=#__codelineno-15-93></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>event_base</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>event_id</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>IP_EVENT_STA_GOT_IP</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-94><a id=__codelineno-15-94 name=__codelineno-15-94 href=#__codelineno-15-94></a><span class=w>        </span><span class=n>xEventGroupSetBits</span><span class=p>(</span><span class=n>wifi_event_group</span><span class=p>,</span><span class=w> </span><span class=n>CONNECTED_BIT</span><span class=p>);</span>
</span><span id=__span-15-95><a id=__codelineno-15-95 name=__codelineno-15-95 href=#__codelineno-15-95></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-15-96><a id=__codelineno-15-96 name=__codelineno-15-96 href=#__codelineno-15-96></a><span class=p>}</span>
</span><span id=__span-15-97><a id=__codelineno-15-97 name=__codelineno-15-97 href=#__codelineno-15-97></a>
</span><span id=__span-15-98><a id=__codelineno-15-98 name=__codelineno-15-98 href=#__codelineno-15-98></a><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>initialise_wifi</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span><span id=__span-15-99><a id=__codelineno-15-99 name=__codelineno-15-99 href=#__codelineno-15-99></a><span class=p>{</span>
</span><span id=__span-15-100><a id=__codelineno-15-100 name=__codelineno-15-100 href=#__codelineno-15-100></a><span class=cp>#ifdef CONFIG_EXAMPLE_VALIDATE_SERVER_CERT</span>
</span><span id=__span-15-101><a id=__codelineno-15-101 name=__codelineno-15-101 href=#__codelineno-15-101></a><span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>ca_pem_bytes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ca_pem_end</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>ca_pem_start</span><span class=p>;</span>
</span><span id=__span-15-102><a id=__codelineno-15-102 name=__codelineno-15-102 href=#__codelineno-15-102></a><span class=cp>#endif </span><span class=cm>/* CONFIG_EXAMPLE_VALIDATE_SERVER_CERT */</span>
</span><span id=__span-15-103><a id=__codelineno-15-103 name=__codelineno-15-103 href=#__codelineno-15-103></a>
</span><span id=__span-15-104><a id=__codelineno-15-104 name=__codelineno-15-104 href=#__codelineno-15-104></a><span class=cp>#ifdef CONFIG_EXAMPLE_EAP_METHOD_TLS</span>
</span><span id=__span-15-105><a id=__codelineno-15-105 name=__codelineno-15-105 href=#__codelineno-15-105></a><span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>client_crt_bytes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>client_crt_end</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>client_crt_start</span><span class=p>;</span>
</span><span id=__span-15-106><a id=__codelineno-15-106 name=__codelineno-15-106 href=#__codelineno-15-106></a><span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>client_key_bytes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>client_key_end</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>client_key_start</span><span class=p>;</span>
</span><span id=__span-15-107><a id=__codelineno-15-107 name=__codelineno-15-107 href=#__codelineno-15-107></a><span class=cp>#endif </span><span class=cm>/* CONFIG_EXAMPLE_EAP_METHOD_TLS */</span>
</span><span id=__span-15-108><a id=__codelineno-15-108 name=__codelineno-15-108 href=#__codelineno-15-108></a>
</span><span id=__span-15-109><a id=__codelineno-15-109 name=__codelineno-15-109 href=#__codelineno-15-109></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_netif_init</span><span class=p>());</span>
</span><span id=__span-15-110><a id=__codelineno-15-110 name=__codelineno-15-110 href=#__codelineno-15-110></a><span class=w>    </span><span class=n>wifi_event_group</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>xEventGroupCreate</span><span class=p>();</span>
</span><span id=__span-15-111><a id=__codelineno-15-111 name=__codelineno-15-111 href=#__codelineno-15-111></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=n>esp_event_loop_create_default</span><span class=p>());</span>
</span><span id=__span-15-112><a id=__codelineno-15-112 name=__codelineno-15-112 href=#__codelineno-15-112></a><span class=w>    </span><span class=n>sta_netif</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>esp_netif_create_default_wifi_sta</span><span class=p>();</span>
</span><span id=__span-15-113><a id=__codelineno-15-113 name=__codelineno-15-113 href=#__codelineno-15-113></a><span class=w>    </span><span class=n>assert</span><span class=p>(</span><span class=n>sta_netif</span><span class=p>);</span>
</span><span id=__span-15-114><a id=__codelineno-15-114 name=__codelineno-15-114 href=#__codelineno-15-114></a>
</span><span id=__span-15-115><a id=__codelineno-15-115 name=__codelineno-15-115 href=#__codelineno-15-115></a><span class=w>    </span><span class=n>wifi_init_config_t</span><span class=w> </span><span class=n>cfg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WIFI_INIT_CONFIG_DEFAULT</span><span class=p>();</span>
</span><span id=__span-15-116><a id=__codelineno-15-116 name=__codelineno-15-116 href=#__codelineno-15-116></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_init</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cfg</span><span class=p>)</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-117><a id=__codelineno-15-117 name=__codelineno-15-117 href=#__codelineno-15-117></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_event_handler_register</span><span class=p>(</span><span class=n>WIFI_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>ESP_EVENT_ANY_ID</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>event_handler</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>)</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-118><a id=__codelineno-15-118 name=__codelineno-15-118 href=#__codelineno-15-118></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_event_handler_register</span><span class=p>(</span><span class=n>IP_EVENT</span><span class=p>,</span><span class=w> </span><span class=n>IP_EVENT_STA_GOT_IP</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>event_handler</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>)</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-119><a id=__codelineno-15-119 name=__codelineno-15-119 href=#__codelineno-15-119></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_set_storage</span><span class=p>(</span><span class=n>WIFI_STORAGE_RAM</span><span class=p>)</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-120><a id=__codelineno-15-120 name=__codelineno-15-120 href=#__codelineno-15-120></a><span class=w>    </span><span class=n>wifi_config_t</span><span class=w> </span><span class=n>wifi_config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-121><a id=__codelineno-15-121 name=__codelineno-15-121 href=#__codelineno-15-121></a><span class=w>        </span><span class=p>.</span><span class=n>sta</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-122><a id=__codelineno-15-122 name=__codelineno-15-122 href=#__codelineno-15-122></a><span class=w>            </span><span class=p>.</span><span class=n>ssid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>EXAMPLE_WIFI_SSID</span><span class=p>,</span>
</span><span id=__span-15-123><a id=__codelineno-15-123 name=__codelineno-15-123 href=#__codelineno-15-123></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-15-124><a id=__codelineno-15-124 name=__codelineno-15-124 href=#__codelineno-15-124></a><span class=w>    </span><span class=p>};</span>
</span><span id=__span-15-125><a id=__codelineno-15-125 name=__codelineno-15-125 href=#__codelineno-15-125></a><span class=w>    </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Setting WiFi configuration SSID %s...&quot;</span><span class=p>,</span><span class=w> </span><span class=n>wifi_config</span><span class=p>.</span><span class=n>sta</span><span class=p>.</span><span class=n>ssid</span><span class=p>);</span>
</span><span id=__span-15-126><a id=__codelineno-15-126 name=__codelineno-15-126 href=#__codelineno-15-126></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_set_mode</span><span class=p>(</span><span class=n>WIFI_MODE_STA</span><span class=p>)</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-127><a id=__codelineno-15-127 name=__codelineno-15-127 href=#__codelineno-15-127></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_set_config</span><span class=p>(</span><span class=n>ESP_IF_WIFI_STA</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>wifi_config</span><span class=p>)</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-128><a id=__codelineno-15-128 name=__codelineno-15-128 href=#__codelineno-15-128></a><span class=w>    </span><span class=c1>// ESP_ERROR_CHECK( esp_wifi_sta_wpa2_ent_set_identity((uint8_t *)EXAMPLE_EAP_ID, strlen(EXAMPLE_EAP_ID)) );</span>
</span><span id=__span-15-129><a id=__codelineno-15-129 name=__codelineno-15-129 href=#__codelineno-15-129></a>
</span><span id=__span-15-130><a id=__codelineno-15-130 name=__codelineno-15-130 href=#__codelineno-15-130></a><span class=cp>#ifdef CONFIG_EXAMPLE_VALIDATE_SERVER_CERT</span>
</span><span id=__span-15-131><a id=__codelineno-15-131 name=__codelineno-15-131 href=#__codelineno-15-131></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_sta_wpa2_ent_set_ca_cert</span><span class=p>(</span><span class=n>ca_pem_start</span><span class=p>,</span><span class=w> </span><span class=n>ca_pem_bytes</span><span class=p>)</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-132><a id=__codelineno-15-132 name=__codelineno-15-132 href=#__codelineno-15-132></a><span class=cp>#endif </span><span class=cm>/* CONFIG_EXAMPLE_VALIDATE_SERVER_CERT */</span>
</span><span id=__span-15-133><a id=__codelineno-15-133 name=__codelineno-15-133 href=#__codelineno-15-133></a>
</span><span id=__span-15-134><a id=__codelineno-15-134 name=__codelineno-15-134 href=#__codelineno-15-134></a><span class=cp>#ifdef CONFIG_EXAMPLE_EAP_METHOD_TLS</span>
</span><span id=__span-15-135><a id=__codelineno-15-135 name=__codelineno-15-135 href=#__codelineno-15-135></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_sta_wpa2_ent_set_cert_key</span><span class=p>(</span><span class=n>client_crt_start</span><span class=p>,</span><span class=w> </span><span class=n>client_crt_bytes</span><span class=p>,</span>\
</span><span id=__span-15-136><a id=__codelineno-15-136 name=__codelineno-15-136 href=#__codelineno-15-136></a><span class=w>            </span><span class=n>client_key_start</span><span class=p>,</span><span class=w> </span><span class=n>client_key_bytes</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-137><a id=__codelineno-15-137 name=__codelineno-15-137 href=#__codelineno-15-137></a><span class=cp>#endif </span><span class=cm>/* CONFIG_EXAMPLE_EAP_METHOD_TLS */</span>
</span><span id=__span-15-138><a id=__codelineno-15-138 name=__codelineno-15-138 href=#__codelineno-15-138></a>
</span><span id=__span-15-139><a id=__codelineno-15-139 name=__codelineno-15-139 href=#__codelineno-15-139></a><span class=cp>#if defined CONFIG_EXAMPLE_EAP_METHOD_PEAP || CONFIG_EXAMPLE_EAP_METHOD_TTLS</span>
</span><span id=__span-15-140><a id=__codelineno-15-140 name=__codelineno-15-140 href=#__codelineno-15-140></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_sta_wpa2_ent_set_username</span><span class=p>((</span><span class=kt>uint8_t</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=n>EXAMPLE_EAP_USERNAME</span><span class=p>,</span><span class=w> </span><span class=n>strlen</span><span class=p>(</span><span class=n>EXAMPLE_EAP_USERNAME</span><span class=p>))</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-141><a id=__codelineno-15-141 name=__codelineno-15-141 href=#__codelineno-15-141></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_sta_wpa2_ent_set_password</span><span class=p>((</span><span class=kt>uint8_t</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=n>EXAMPLE_EAP_PASSWORD</span><span class=p>,</span><span class=w> </span><span class=n>strlen</span><span class=p>(</span><span class=n>EXAMPLE_EAP_PASSWORD</span><span class=p>))</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-142><a id=__codelineno-15-142 name=__codelineno-15-142 href=#__codelineno-15-142></a><span class=cp>#endif </span><span class=cm>/* CONFIG_EXAMPLE_EAP_METHOD_PEAP || CONFIG_EXAMPLE_EAP_METHOD_TTLS */</span>
</span><span id=__span-15-143><a id=__codelineno-15-143 name=__codelineno-15-143 href=#__codelineno-15-143></a>
</span><span id=__span-15-144><a id=__codelineno-15-144 name=__codelineno-15-144 href=#__codelineno-15-144></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_sta_wpa2_ent_enable</span><span class=p>()</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-145><a id=__codelineno-15-145 name=__codelineno-15-145 href=#__codelineno-15-145></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>esp_wifi_start</span><span class=p>()</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-146><a id=__codelineno-15-146 name=__codelineno-15-146 href=#__codelineno-15-146></a><span class=p>}</span>
</span><span id=__span-15-147><a id=__codelineno-15-147 name=__codelineno-15-147 href=#__codelineno-15-147></a>
</span><span id=__span-15-148><a id=__codelineno-15-148 name=__codelineno-15-148 href=#__codelineno-15-148></a><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>wpa2_enterprise_example_task</span><span class=p>(</span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>pvParameters</span><span class=p>)</span>
</span><span id=__span-15-149><a id=__codelineno-15-149 name=__codelineno-15-149 href=#__codelineno-15-149></a><span class=p>{</span>
</span><span id=__span-15-150><a id=__codelineno-15-150 name=__codelineno-15-150 href=#__codelineno-15-150></a><span class=w>    </span><span class=n>esp_netif_ip_info_t</span><span class=w> </span><span class=n>ip</span><span class=p>;</span>
</span><span id=__span-15-151><a id=__codelineno-15-151 name=__codelineno-15-151 href=#__codelineno-15-151></a><span class=w>    </span><span class=n>memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ip</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>esp_netif_ip_info_t</span><span class=p>));</span>
</span><span id=__span-15-152><a id=__codelineno-15-152 name=__codelineno-15-152 href=#__codelineno-15-152></a><span class=w>    </span><span class=n>vTaskDelay</span><span class=p>(</span><span class=mi>2000</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>portTICK_PERIOD_MS</span><span class=p>);</span>
</span><span id=__span-15-153><a id=__codelineno-15-153 name=__codelineno-15-153 href=#__codelineno-15-153></a>
</span><span id=__span-15-154><a id=__codelineno-15-154 name=__codelineno-15-154 href=#__codelineno-15-154></a><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-155><a id=__codelineno-15-155 name=__codelineno-15-155 href=#__codelineno-15-155></a><span class=w>        </span><span class=n>vTaskDelay</span><span class=p>(</span><span class=mi>2000</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>portTICK_PERIOD_MS</span><span class=p>);</span>
</span><span id=__span-15-156><a id=__codelineno-15-156 name=__codelineno-15-156 href=#__codelineno-15-156></a>
</span><span id=__span-15-157><a id=__codelineno-15-157 name=__codelineno-15-157 href=#__codelineno-15-157></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>esp_netif_get_ip_info</span><span class=p>(</span><span class=n>sta_netif</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>ip</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-158><a id=__codelineno-15-158 name=__codelineno-15-158 href=#__codelineno-15-158></a><span class=w>            </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span><span class=w> </span><span class=s>&quot;~~~~~~~~~~~&quot;</span><span class=p>);</span>
</span><span id=__span-15-159><a id=__codelineno-15-159 name=__codelineno-15-159 href=#__codelineno-15-159></a><span class=w>            </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span><span class=w> </span><span class=s>&quot;IP:&quot;</span><span class=n>IPSTR</span><span class=p>,</span><span class=w> </span><span class=n>IP2STR</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ip</span><span class=p>.</span><span class=n>ip</span><span class=p>));</span>
</span><span id=__span-15-160><a id=__codelineno-15-160 name=__codelineno-15-160 href=#__codelineno-15-160></a><span class=w>            </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span><span class=w> </span><span class=s>&quot;MASK:&quot;</span><span class=n>IPSTR</span><span class=p>,</span><span class=w> </span><span class=n>IP2STR</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ip</span><span class=p>.</span><span class=n>netmask</span><span class=p>));</span>
</span><span id=__span-15-161><a id=__codelineno-15-161 name=__codelineno-15-161 href=#__codelineno-15-161></a><span class=w>            </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span><span class=w> </span><span class=s>&quot;GW:&quot;</span><span class=n>IPSTR</span><span class=p>,</span><span class=w> </span><span class=n>IP2STR</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ip</span><span class=p>.</span><span class=n>gw</span><span class=p>));</span>
</span><span id=__span-15-162><a id=__codelineno-15-162 name=__codelineno-15-162 href=#__codelineno-15-162></a><span class=w>            </span><span class=n>ESP_LOGI</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span><span class=w> </span><span class=s>&quot;~~~~~~~~~~~&quot;</span><span class=p>);</span>
</span><span id=__span-15-163><a id=__codelineno-15-163 name=__codelineno-15-163 href=#__codelineno-15-163></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-15-164><a id=__codelineno-15-164 name=__codelineno-15-164 href=#__codelineno-15-164></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-15-165><a id=__codelineno-15-165 name=__codelineno-15-165 href=#__codelineno-15-165></a><span class=p>}</span>
</span><span id=__span-15-166><a id=__codelineno-15-166 name=__codelineno-15-166 href=#__codelineno-15-166></a>
</span><span id=__span-15-167><a id=__codelineno-15-167 name=__codelineno-15-167 href=#__codelineno-15-167></a><span class=kt>void</span><span class=w> </span><span class=nf>app_main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span><span id=__span-15-168><a id=__codelineno-15-168 name=__codelineno-15-168 href=#__codelineno-15-168></a><span class=p>{</span>
</span><span id=__span-15-169><a id=__codelineno-15-169 name=__codelineno-15-169 href=#__codelineno-15-169></a><span class=w>    </span><span class=n>ESP_ERROR_CHECK</span><span class=p>(</span><span class=w> </span><span class=n>nvs_flash_init</span><span class=p>()</span><span class=w> </span><span class=p>);</span>
</span><span id=__span-15-170><a id=__codelineno-15-170 name=__codelineno-15-170 href=#__codelineno-15-170></a><span class=w>    </span><span class=n>initialise_wifi</span><span class=p>();</span>
</span><span id=__span-15-171><a id=__codelineno-15-171 name=__codelineno-15-171 href=#__codelineno-15-171></a><span class=w>    </span><span class=n>xTaskCreate</span><span class=p>(</span><span class=o>&amp;</span><span class=n>wpa2_enterprise_example_task</span><span class=p>,</span><span class=w> </span><span class=s>&quot;wpa2_enterprise_example_task&quot;</span><span class=p>,</span><span class=w> </span><span class=mi>4096</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>);</span>
</span><span id=__span-15-172><a id=__codelineno-15-172 name=__codelineno-15-172 href=#__codelineno-15-172></a><span class=p>}</span>
</span></code></pre></div> As shown below.</p> <p><img alt src=../csw-wifi.png></p> <!-- ### 3.3 WIFI Static IP Configuration

Code link:

> https://github.com/DuRuofu/ESP32_Learning/tree/master/05.wifi/wifi_sta_static_ip

<div class="language-c highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;freertos/FreeRTOS.h&quot;</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;freertos/event_groups.h&quot;</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_wifi.h&quot;</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_log.h&quot;</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_event.h&quot;</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;nvs_flash.h&quot;</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_mac.h&quot;</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_netif.h&quot;</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;lwip/inet.h&quot;</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="cp">#define ESP_WIFI_STA_SSID &quot;CSW@CEE&quot;</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="cp">#define ESP_WIFI_STA_PASSWD &quot;88888888&quot;</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="kt">void</span><span class="w"> </span><span class="nf">WIFI_CallBack</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">event_handler_arg</span><span class="p">,</span><span class="w"> </span><span class="n">esp_event_base_t</span><span class="w"> </span><span class="n">event_base</span><span class="p">,</span><span class="w"> </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">event_id</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">event_data</span><span class="p">)</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="p">{</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">connect_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="w">    </span><span class="c1">// WIFI started successfully</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event_base</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WIFI_EVENT</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">event_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WIFI_EVENT_STA_START</span><span class="p">)</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="s">&quot;WIFI_EVENT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WIFI_EVENT_STA_START&quot;</span><span class="p">);</span>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="w">        </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_connect</span><span class="p">());</span>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="w">    </span><span class="c1">// WIFI connection failed</span>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event_base</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WIFI_EVENT</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">event_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WIFI_EVENT_STA_DISCONNECTED</span><span class="p">)</span>
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="s">&quot;WIFI_EVENT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WIFI_EVENT_STA_DISCONNECTED&quot;</span><span class="p">);</span>
</span><span id="__span-16-29"><a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="w">        </span><span class="n">connect_count</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-16-30"><a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">connect_count</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span>
</span><span id="__span-16-31"><a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-16-32"><a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a><span class="w">            </span><span class="n">vTaskDelay</span><span class="p">(</span><span class="mi">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">portTICK_PERIOD_MS</span><span class="p">);</span>
</span><span id="__span-16-33"><a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a><span class="w">            </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_connect</span><span class="p">());</span>
</span><span id="__span-16-34"><a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-16-35"><a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a><span class="w">        </span><span class="k">else</span>
</span><span id="__span-16-36"><a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-16-37"><a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a><span class="w">            </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="s">&quot;WIFI_EVENT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WIFI_EVENT_STA_DISCONNECTED 10 times&quot;</span><span class="p">);</span>
</span><span id="__span-16-38"><a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-16-39"><a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-40"><a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a><span class="w">    </span><span class="c1">// WIFI connection successful (got IP)</span>
</span><span id="__span-16-41"><a id="__codelineno-16-41" name="__codelineno-16-41" href="#__codelineno-16-41"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event_base</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">IP_EVENT</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">event_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">IP_EVENT_STA_GOT_IP</span><span class="p">)</span>
</span><span id="__span-16-42"><a id="__codelineno-16-42" name="__codelineno-16-42" href="#__codelineno-16-42"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-16-43"><a id="__codelineno-16-43" name="__codelineno-16-43" href="#__codelineno-16-43"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="s">&quot;WIFI_EVENT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WIFI_EVENT_STA_GOT_IP&quot;</span><span class="p">);</span>
</span><span id="__span-16-44"><a id="__codelineno-16-44" name="__codelineno-16-44" href="#__codelineno-16-44"></a><span class="w">        </span><span class="n">ip_event_got_ip_t</span><span class="w"> </span><span class="o">*</span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ip_event_got_ip_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">event_data</span><span class="p">;</span>
</span><span id="__span-16-45"><a id="__codelineno-16-45" name="__codelineno-16-45" href="#__codelineno-16-45"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="s">&quot;WIFI_EVENT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;got ip:&quot;</span><span class="w"> </span><span class="n">IPSTR</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">IP2STR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">ip_info</span><span class="p">.</span><span class="n">ip</span><span class="p">));</span>
</span><span id="__span-16-46"><a id="__codelineno-16-46" name="__codelineno-16-46" href="#__codelineno-16-46"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-47"><a id="__codelineno-16-47" name="__codelineno-16-47" href="#__codelineno-16-47"></a><span class="p">}</span>
</span><span id="__span-16-48"><a id="__codelineno-16-48" name="__codelineno-16-48" href="#__codelineno-16-48"></a>
</span><span id="__span-16-49"><a id="__codelineno-16-49" name="__codelineno-16-49" href="#__codelineno-16-49"></a><span class="kt">void</span><span class="w"> </span><span class="nf">app_main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span id="__span-16-50"><a id="__codelineno-16-50" name="__codelineno-16-50" href="#__codelineno-16-50"></a><span class="p">{</span>
</span><span id="__span-16-51"><a id="__codelineno-16-51" name="__codelineno-16-51" href="#__codelineno-16-51"></a><span class="w">    </span><span class="c1">//---------------- Preparation Phase -------------------</span>
</span><span id="__span-16-52"><a id="__codelineno-16-52" name="__codelineno-16-52" href="#__codelineno-16-52"></a><span class="w">    </span><span class="c1">// Initialize NVS</span>
</span><span id="__span-16-53"><a id="__codelineno-16-53" name="__codelineno-16-53" href="#__codelineno-16-53"></a><span class="w">    </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvs_flash_init</span><span class="p">();</span>
</span><span id="__span-16-54"><a id="__codelineno-16-54" name="__codelineno-16-54" href="#__codelineno-16-54"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_ERR_NVS_NO_FREE_PAGES</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_ERR_NVS_NEW_VERSION_FOUND</span><span class="p">)</span>
</span><span id="__span-16-55"><a id="__codelineno-16-55" name="__codelineno-16-55" href="#__codelineno-16-55"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-16-56"><a id="__codelineno-16-56" name="__codelineno-16-56" href="#__codelineno-16-56"></a><span class="w">        </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">nvs_flash_erase</span><span class="p">());</span>
</span><span id="__span-16-57"><a id="__codelineno-16-57" name="__codelineno-16-57" href="#__codelineno-16-57"></a><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvs_flash_init</span><span class="p">();</span>
</span><span id="__span-16-58"><a id="__codelineno-16-58" name="__codelineno-16-58" href="#__codelineno-16-58"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-59"><a id="__codelineno-16-59" name="__codelineno-16-59" href="#__codelineno-16-59"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
</span><span id="__span-16-60"><a id="__codelineno-16-60" name="__codelineno-16-60" href="#__codelineno-16-60"></a>
</span><span id="__span-16-61"><a id="__codelineno-16-61" name="__codelineno-16-61" href="#__codelineno-16-61"></a><span class="w">    </span><span class="c1">//---------------- Initialization Phase -------------------</span>
</span><span id="__span-16-62"><a id="__codelineno-16-62" name="__codelineno-16-62" href="#__codelineno-16-62"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_netif_init</span><span class="p">());</span>
</span><span id="__span-16-63"><a id="__codelineno-16-63" name="__codelineno-16-63" href="#__codelineno-16-63"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_event_loop_create_default</span><span class="p">());</span>
</span><span id="__span-16-64"><a id="__codelineno-16-64" name="__codelineno-16-64" href="#__codelineno-16-64"></a>
</span><span id="__span-16-65"><a id="__codelineno-16-65" name="__codelineno-16-65" href="#__codelineno-16-65"></a><span class="w">    </span><span class="c1">// Register event: WIFI started successfully</span>
</span><span id="__span-16-66"><a id="__codelineno-16-66" name="__codelineno-16-66" href="#__codelineno-16-66"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_event_handler_instance_register</span><span class="p">(</span><span class="n">WIFI_EVENT</span><span class="p">,</span><span class="w"> </span><span class="n">WIFI_EVENT_STA_START</span><span class="p">,</span><span class="w"> </span><span class="n">WIFI_CallBack</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">));</span>
</span><span id="__span-16-67"><a id="__codelineno-16-67" name="__codelineno-16-67" href="#__codelineno-16-67"></a><span class="w">    </span><span class="c1">// Register event: WIFI connection failed</span>
</span><span id="__span-16-68"><a id="__codelineno-16-68" name="__codelineno-16-68" href="#__codelineno-16-68"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_event_handler_instance_register</span><span class="p">(</span><span class="n">WIFI_EVENT</span><span class="p">,</span><span class="w"> </span><span class="n">WIFI_EVENT_STA_DISCONNECTED</span><span class="p">,</span><span class="w"> </span><span class="n">WIFI_CallBack</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">));</span>
</span><span id="__span-16-69"><a id="__codelineno-16-69" name="__codelineno-16-69" href="#__codelineno-16-69"></a><span class="w">    </span><span class="c1">// Register event: WIFI got IP</span>
</span><span id="__span-16-70"><a id="__codelineno-16-70" name="__codelineno-16-70" href="#__codelineno-16-70"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_event_handler_instance_register</span><span class="p">(</span><span class="n">IP_EVENT</span><span class="p">,</span><span class="w"> </span><span class="n">IP_EVENT_STA_GOT_IP</span><span class="p">,</span><span class="w"> </span><span class="n">WIFI_CallBack</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">));</span>
</span><span id="__span-16-71"><a id="__codelineno-16-71" name="__codelineno-16-71" href="#__codelineno-16-71"></a>
</span><span id="__span-16-72"><a id="__codelineno-16-72" name="__codelineno-16-72" href="#__codelineno-16-72"></a><span class="w">    </span><span class="c1">// Initialize STA interface</span>
</span><span id="__span-16-73"><a id="__codelineno-16-73" name="__codelineno-16-73" href="#__codelineno-16-73"></a><span class="w">    </span><span class="n">esp_netif_t</span><span class="w"> </span><span class="o">*</span><span class="n">esp_netif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_netif_create_default_wifi_sta</span><span class="p">();</span>
</span><span id="__span-16-74"><a id="__codelineno-16-74" name="__codelineno-16-74" href="#__codelineno-16-74"></a>
</span><span id="__span-16-75"><a id="__codelineno-16-75" name="__codelineno-16-75" href="#__codelineno-16-75"></a><span class="w">    </span><span class="c1">// ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span>
</span><span id="__span-16-76"><a id="__codelineno-16-76" name="__codelineno-16-76" href="#__codelineno-16-76"></a><span class="w">    </span><span class="c1">//******************* Configure Static IP *************************</span>
</span><span id="__span-16-77"><a id="__codelineno-16-77" name="__codelineno-16-77" href="#__codelineno-16-77"></a><span class="w">    </span><span class="n">esp_netif_dhcpc_stop</span><span class="p">(</span><span class="n">esp_netif</span><span class="p">);</span>
</span><span id="__span-16-78"><a id="__codelineno-16-78" name="__codelineno-16-78" href="#__codelineno-16-78"></a><span class="w">    </span><span class="n">esp_netif_ip_info_t</span><span class="w"> </span><span class="n">ipInfo</span><span class="p">;</span>
</span><span id="__span-16-79"><a id="__codelineno-16-79" name="__codelineno-16-79" href="#__codelineno-16-79"></a><span class="w">    </span><span class="n">ipInfo</span><span class="p">.</span><span class="n">ip</span><span class="p">.</span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inet_addr</span><span class="p">(</span><span class="s">&quot;192.168.138.2&quot;</span><span class="p">);</span>
</span><span id="__span-16-80"><a id="__codelineno-16-80" name="__codelineno-16-80" href="#__codelineno-16-80"></a><span class="w">    </span><span class="n">ipInfo</span><span class="p">.</span><span class="n">netmask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inet_addr</span><span class="p">(</span><span class="s">&quot;255.255.255.0&quot;</span><span class="p">);</span>
</span><span id="__span-16-81"><a id="__codelineno-16-81" name="__codelineno-16-81" href="#__codelineno-16-81"></a><span class="w">    </span><span class="n">ipInfo</span><span class="p">.</span><span class="n">gw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inet_addr</span><span class="p">(</span><span class="s">&quot;192.168.138.2&quot;</span><span class="p">);</span>
</span><span id="__span-16-82"><a id="__codelineno-16-82" name="__codelineno-16-82" href="#__codelineno-16-82"></a>
</span><span id="__span-16-83"><a id="__codelineno-16-83" name="__codelineno-16-83" href="#__codelineno-16-83"></a><span class="w">    </span><span class="n">esp_netif_set_ip_info</span><span class="p">(</span><span class="n">esp_netif</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ipInfo</span><span class="p">);</span>
</span><span id="__span-16-84"><a id="__codelineno-16-84" name="__codelineno-16-84" href="#__codelineno-16-84"></a><span class="w">    </span><span class="n">esp_netif_dhcpc_start</span><span class="p">(</span><span class="n">esp_netif</span><span class="p">);</span>
</span><span id="__span-16-85"><a id="__codelineno-16-85" name="__codelineno-16-85" href="#__codelineno-16-85"></a><span class="w">    </span><span class="c1">//******************* Configure Static IP *************************</span>
</span><span id="__span-16-86"><a id="__codelineno-16-86" name="__codelineno-16-86" href="#__codelineno-16-86"></a><span class="w">    </span><span class="c1">// ↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span>
</span><span id="__span-16-87"><a id="__codelineno-16-87" name="__codelineno-16-87" href="#__codelineno-16-87"></a>
</span><span id="__span-16-88"><a id="__codelineno-16-88" name="__codelineno-16-88" href="#__codelineno-16-88"></a><span class="w">    </span><span class="cm">/* Initialize WiFi */</span>
</span><span id="__span-16-89"><a id="__codelineno-16-89" name="__codelineno-16-89" href="#__codelineno-16-89"></a><span class="w">    </span><span class="n">wifi_init_config_t</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WIFI_INIT_CONFIG_DEFAULT</span><span class="p">();</span>
</span><span id="__span-16-90"><a id="__codelineno-16-90" name="__codelineno-16-90" href="#__codelineno-16-90"></a><span class="w">    </span><span class="c1">// WIFI_INIT_CONFIG_DEFAULT is a macro for the default configuration</span>
</span><span id="__span-16-91"><a id="__codelineno-16-91" name="__codelineno-16-91" href="#__codelineno-16-91"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cfg</span><span class="p">));</span>
</span><span id="__span-16-92"><a id="__codelineno-16-92" name="__codelineno-16-92" href="#__codelineno-16-92"></a>
</span><span id="__span-16-93"><a id="__codelineno-16-93" name="__codelineno-16-93" href="#__codelineno-16-93"></a><span class="w">    </span><span class="c1">//---------------- Configuration Phase -------------------</span>
</span><span id="__span-16-94"><a id="__codelineno-16-94" name="__codelineno-16-94" href="#__codelineno-16-94"></a><span class="w">    </span><span class="c1">// Set to STA mode</span>
</span><span id="__span-16-95"><a id="__codelineno-16-95" name="__codelineno-16-95" href="#__codelineno-16-95"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_set_mode</span><span class="p">(</span><span class="n">WIFI_MODE_STA</span><span class="p">));</span>
</span><span id="__span-16-96"><a id="__codelineno-16-96" name="__codelineno-16-96" href="#__codelineno-16-96"></a>
</span><span id="__span-16-97"><a id="__codelineno-16-97" name="__codelineno-16-97" href="#__codelineno-16-97"></a><span class="w">    </span><span class="c1">// Detailed STA configuration</span>
</span><span id="__span-16-98"><a id="__codelineno-16-98" name="__codelineno-16-98" href="#__codelineno-16-98"></a><span class="w">    </span><span class="n">wifi_config_t</span><span class="w"> </span><span class="n">sta_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-99"><a id="__codelineno-16-99" name="__codelineno-16-99" href="#__codelineno-16-99"></a><span class="w">        </span><span class="p">.</span><span class="n">sta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-100"><a id="__codelineno-16-100" name="__codelineno-16-100" href="#__codelineno-16-100"></a><span class="w">            </span><span class="p">.</span><span class="n">ssid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_WIFI_STA_SSID</span><span class="p">,</span>
</span><span id="__span-16-101"><a id="__codelineno-16-101" name="__codelineno-16-101" href="#__codelineno-16-101"></a><span class="w">            </span><span class="p">.</span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_WIFI_STA_PASSWD</span><span class="p">,</span>
</span><span id="__span-16-102"><a id="__codelineno-16-102" name="__codelineno-16-102" href="#__codelineno-16-102"></a><span class="w">            </span><span class="p">.</span><span class="n">bssid_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span>
</span><span id="__span-16-103"><a id="__codelineno-16-103" name="__codelineno-16-103" href="#__codelineno-16-103"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-16-104"><a id="__codelineno-16-104" name="__codelineno-16-104" href="#__codelineno-16-104"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-16-105"><a id="__codelineno-16-105" name="__codelineno-16-105" href="#__codelineno-16-105"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_set_config</span><span class="p">(</span><span class="n">WIFI_IF_STA</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sta_config</span><span class="p">));</span>
</span><span id="__span-16-106"><a id="__codelineno-16-106" name="__codelineno-16-106" href="#__codelineno-16-106"></a>
</span><span id="__span-16-107"><a id="__codelineno-16-107" name="__codelineno-16-107" href="#__codelineno-16-107"></a><span class="w">    </span><span class="c1">//---------------- Startup Phase -------------------</span>
</span><span id="__span-16-108"><a id="__codelineno-16-108" name="__codelineno-16-108" href="#__codelineno-16-108"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_start</span><span class="p">());</span>
</span><span id="__span-16-109"><a id="__codelineno-16-109" name="__codelineno-16-109" href="#__codelineno-16-109"></a>
</span><span id="__span-16-110"><a id="__codelineno-16-110" name="__codelineno-16-110" href="#__codelineno-16-110"></a><span class="w">    </span><span class="c1">//---------------- Configure Power Saving Mode -------------------</span>
</span><span id="__span-16-111"><a id="__codelineno-16-111" name="__codelineno-16-111" href="#__codelineno-16-111"></a><span class="w">    </span><span class="c1">// No power saving (data transmission will be faster)</span>
</span><span id="__span-16-112"><a id="__codelineno-16-112" name="__codelineno-16-112" href="#__codelineno-16-112"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_set_ps</span><span class="p">(</span><span class="n">WIFI_PS_NONE</span><span class="p">));</span>
</span><span id="__span-16-113"><a id="__codelineno-16-113" name="__codelineno-16-113" href="#__codelineno-16-113"></a><span class="p">}</span>
</span></code></pre></div>

### 3.4 WIFI Scan

Code link:

> https://github.com/DuRuofu/ESP32_Learning/tree/master/05.wifi/wifi_scan

<div class="language-c highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;freertos/FreeRTOS.h&quot;</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;freertos/event_groups.h&quot;</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_wifi.h&quot;</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_log.h&quot;</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_event.h&quot;</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;nvs_flash.h&quot;</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_mac.h&quot;</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_netif.h&quot;</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="cp">#define ESP_WIFI_STA_SSID &quot;CSW@CEE&quot;</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="cp">#define ESP_WIFI_STA_PASSWD &quot;88888888&quot;</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="c1">// Scan list size</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="cp">#define DEFAULT_SCAN_LIST_SIZE 10</span>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">TAG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;wifi_scan&quot;</span><span class="p">;</span>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="c1">// Function to print the authentication mode</span>
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">print_auth_mode</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">authmode</span><span class="p">)</span>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="p">{</span>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">authmode</span><span class="p">)</span>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_OPEN</span><span class="p">:</span>
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_OPEN&quot;</span><span class="p">);</span>
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-28"><a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_OWE</span><span class="p">:</span>
</span><span id="__span-17-29"><a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_OWE&quot;</span><span class="p">);</span>
</span><span id="__span-17-30"><a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-31"><a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_WEP</span><span class="p">:</span>
</span><span id="__span-17-32"><a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_WEP&quot;</span><span class="p">);</span>
</span><span id="__span-17-33"><a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-34"><a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_WPA_PSK</span><span class="p">:</span>
</span><span id="__span-17-35"><a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_WPA_PSK&quot;</span><span class="p">);</span>
</span><span id="__span-17-36"><a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-37"><a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_WPA2_PSK</span><span class="p">:</span>
</span><span id="__span-17-38"><a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_WPA2_PSK&quot;</span><span class="p">);</span>
</span><span id="__span-17-39"><a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-40"><a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_WPA_WPA2_PSK</span><span class="p">:</span>
</span><span id="__span-17-41"><a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_WPA_WPA2_PSK&quot;</span><span class="p">);</span>
</span><span id="__span-17-42"><a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-43"><a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_WPA2_ENTERPRISE</span><span class="p">:</span>
</span><span id="__span-17-44"><a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_WPA2_ENTERPRISE&quot;</span><span class="p">);</span>
</span><span id="__span-17-45"><a id="__codelineno-17-45" name="__codelineno-17-45" href="#__codelineno-17-45"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-46"><a id="__codelineno-17-46" name="__codelineno-17-46" href="#__codelineno-17-46"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_WPA3_PSK</span><span class="p">:</span>
</span><span id="__span-17-47"><a id="__codelineno-17-47" name="__codelineno-17-47" href="#__codelineno-17-47"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_WPA3_PSK&quot;</span><span class="p">);</span>
</span><span id="__span-17-48"><a id="__codelineno-17-48" name="__codelineno-17-48" href="#__codelineno-17-48"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-49"><a id="__codelineno-17-49" name="__codelineno-17-49" href="#__codelineno-17-49"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_AUTH_WPA2_WPA3_PSK</span><span class="p">:</span>
</span><span id="__span-17-50"><a id="__codelineno-17-50" name="__codelineno-17-50" href="#__codelineno-17-50"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_WPA2_WPA3_PSK&quot;</span><span class="p">);</span>
</span><span id="__span-17-51"><a id="__codelineno-17-51" name="__codelineno-17-51" href="#__codelineno-17-51"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-52"><a id="__codelineno-17-52" name="__codelineno-17-52" href="#__codelineno-17-52"></a><span class="w">    </span><span class="k">default</span><span class="o">:</span>
</span><span id="__span-17-53"><a id="__codelineno-17-53" name="__codelineno-17-53" href="#__codelineno-17-53"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Authmode </span><span class="se">\t</span><span class="s">WIFI_AUTH_UNKNOWN&quot;</span><span class="p">);</span>
</span><span id="__span-17-54"><a id="__codelineno-17-54" name="__codelineno-17-54" href="#__codelineno-17-54"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-55"><a id="__codelineno-17-55" name="__codelineno-17-55" href="#__codelineno-17-55"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-56"><a id="__codelineno-17-56" name="__codelineno-17-56" href="#__codelineno-17-56"></a><span class="p">}</span>
</span><span id="__span-17-57"><a id="__codelineno-17-57" name="__codelineno-17-57" href="#__codelineno-17-57"></a>
</span><span id="__span-17-58"><a id="__codelineno-17-58" name="__codelineno-17-58" href="#__codelineno-17-58"></a><span class="c1">// Function to print the cipher types</span>
</span><span id="__span-17-59"><a id="__codelineno-17-59" name="__codelineno-17-59" href="#__codelineno-17-59"></a><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">print_cipher_type</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pairwise_cipher</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">group_cipher</span><span class="p">)</span>
</span><span id="__span-17-60"><a id="__codelineno-17-60" name="__codelineno-17-60" href="#__codelineno-17-60"></a><span class="p">{</span>
</span><span id="__span-17-61"><a id="__codelineno-17-61" name="__codelineno-17-61" href="#__codelineno-17-61"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">pairwise_cipher</span><span class="p">)</span>
</span><span id="__span-17-62"><a id="__codelineno-17-62" name="__codelineno-17-62" href="#__codelineno-17-62"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-17-63"><a id="__codelineno-17-63" name="__codelineno-17-63" href="#__codelineno-17-63"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_NONE</span><span class="p">:</span>
</span><span id="__span-17-64"><a id="__codelineno-17-64" name="__codelineno-17-64" href="#__codelineno-17-64"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pairwise Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_NONE&quot;</span><span class="p">);</span>
</span><span id="__span-17-65"><a id="__codelineno-17-65" name="__codelineno-17-65" href="#__codelineno-17-65"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-66"><a id="__codelineno-17-66" name="__codelineno-17-66" href="#__codelineno-17-66"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_WEP40</span><span class="p">:</span>
</span><span id="__span-17-67"><a id="__codelineno-17-67" name="__codelineno-17-67" href="#__codelineno-17-67"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pairwise Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_WEP40&quot;</span><span class="p">);</span>
</span><span id="__span-17-68"><a id="__codelineno-17-68" name="__codelineno-17-68" href="#__codelineno-17-68"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-69"><a id="__codelineno-17-69" name="__codelineno-17-69" href="#__codelineno-17-69"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_WEP104</span><span class="p">:</span>
</span><span id="__span-17-70"><a id="__codelineno-17-70" name="__codelineno-17-70" href="#__codelineno-17-70"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pairwise Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_WEP104&quot;</span><span class="p">);</span>
</span><span id="__span-17-71"><a id="__codelineno-17-71" name="__codelineno-17-71" href="#__codelineno-17-71"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-72"><a id="__codelineno-17-72" name="__codelineno-17-72" href="#__codelineno-17-72"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_TKIP</span><span class="p">:</span>
</span><span id="__span-17-73"><a id="__codelineno-17-73" name="__codelineno-17-73" href="#__codelineno-17-73"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pairwise Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_TKIP&quot;</span><span class="p">);</span>
</span><span id="__span-17-74"><a id="__codelineno-17-74" name="__codelineno-17-74" href="#__codelineno-17-74"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-75"><a id="__codelineno-17-75" name="__codelineno-17-75" href="#__codelineno-17-75"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_CCMP</span><span class="p">:</span>
</span><span id="__span-17-76"><a id="__codelineno-17-76" name="__codelineno-17-76" href="#__codelineno-17-76"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pairwise Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_CCMP&quot;</span><span class="p">);</span>
</span><span id="__span-17-77"><a id="__codelineno-17-77" name="__codelineno-17-77" href="#__codelineno-17-77"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-78"><a id="__codelineno-17-78" name="__codelineno-17-78" href="#__codelineno-17-78"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_TKIP_CCMP</span><span class="p">:</span>
</span><span id="__span-17-79"><a id="__codelineno-17-79" name="__codelineno-17-79" href="#__codelineno-17-79"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pairwise Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_TKIP_CCMP&quot;</span><span class="p">);</span>
</span><span id="__span-17-80"><a id="__codelineno-17-80" name="__codelineno-17-80" href="#__codelineno-17-80"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-81"><a id="__codelineno-17-81" name="__codelineno-17-81" href="#__codelineno-17-81"></a><span class="w">    </span><span class="k">default</span><span class="o">:</span>
</span><span id="__span-17-82"><a id="__codelineno-17-82" name="__codelineno-17-82" href="#__codelineno-17-82"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pairwise Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_UNKNOWN&quot;</span><span class="p">);</span>
</span><span id="__span-17-83"><a id="__codelineno-17-83" name="__codelineno-17-83" href="#__codelineno-17-83"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-84"><a id="__codelineno-17-84" name="__codelineno-17-84" href="#__codelineno-17-84"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-85"><a id="__codelineno-17-85" name="__codelineno-17-85" href="#__codelineno-17-85"></a>
</span><span id="__span-17-86"><a id="__codelineno-17-86" name="__codelineno-17-86" href="#__codelineno-17-86"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">group_cipher</span><span class="p">)</span>
</span><span id="__span-17-87"><a id="__codelineno-17-87" name="__codelineno-17-87" href="#__codelineno-17-87"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-17-88"><a id="__codelineno-17-88" name="__codelineno-17-88" href="#__codelineno-17-88"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_NONE</span><span class="p">:</span>
</span><span id="__span-17-89"><a id="__codelineno-17-89" name="__codelineno-17-89" href="#__codelineno-17-89"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Group Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_NONE&quot;</span><span class="p">);</span>
</span><span id="__span-17-90"><a id="__codelineno-17-90" name="__codelineno-17-90" href="#__codelineno-17-90"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-91"><a id="__codelineno-17-91" name="__codelineno-17-91" href="#__codelineno-17-91"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_WEP40</span><span class="p">:</span>
</span><span id="__span-17-92"><a id="__codelineno-17-92" name="__codelineno-17-92" href="#__codelineno-17-92"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Group Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_WEP40&quot;</span><span class="p">);</span>
</span><span id="__span-17-93"><a id="__codelineno-17-93" name="__codelineno-17-93" href="#__codelineno-17-93"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-94"><a id="__codelineno-17-94" name="__codelineno-17-94" href="#__codelineno-17-94"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_WEP104</span><span class="p">:</span>
</span><span id="__span-17-95"><a id="__codelineno-17-95" name="__codelineno-17-95" href="#__codelineno-17-95"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Group Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_WEP104&quot;</span><span class="p">);</span>
</span><span id="__span-17-96"><a id="__codelineno-17-96" name="__codelineno-17-96" href="#__codelineno-17-96"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-97"><a id="__codelineno-17-97" name="__codelineno-17-97" href="#__codelineno-17-97"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_TKIP</span><span class="p">:</span>
</span><span id="__span-17-98"><a id="__codelineno-17-98" name="__codelineno-17-98" href="#__codelineno-17-98"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Group Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_TKIP&quot;</span><span class="p">);</span>
</span><span id="__span-17-99"><a id="__codelineno-17-99" name="__codelineno-17-99" href="#__codelineno-17-99"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-100"><a id="__codelineno-17-100" name="__codelineno-17-100" href="#__codelineno-17-100"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_CCMP</span><span class="p">:</span>
</span><span id="__span-17-101"><a id="__codelineno-17-101" name="__codelineno-17-101" href="#__codelineno-17-101"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Group Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_CCMP&quot;</span><span class="p">);</span>
</span><span id="__span-17-102"><a id="__codelineno-17-102" name="__codelineno-17-102" href="#__codelineno-17-102"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-103"><a id="__codelineno-17-103" name="__codelineno-17-103" href="#__codelineno-17-103"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">WIFI_CIPHER_TYPE_TKIP_CCMP</span><span class="p">:</span>
</span><span id="__span-17-104"><a id="__codelineno-17-104" name="__codelineno-17-104" href="#__codelineno-17-104"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Group Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_TKIP_CCMP&quot;</span><span class="p">);</span>
</span><span id="__span-17-105"><a id="__codelineno-17-105" name="__codelineno-17-105" href="#__codelineno-17-105"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-106"><a id="__codelineno-17-106" name="__codelineno-17-106" href="#__codelineno-17-106"></a><span class="w">    </span><span class="k">default</span><span class="o">:</span>
</span><span id="__span-17-107"><a id="__codelineno-17-107" name="__codelineno-17-107" href="#__codelineno-17-107"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Group Cipher </span><span class="se">\t</span><span class="s">WIFI_CIPHER_TYPE_UNKNOWN&quot;</span><span class="p">);</span>
</span><span id="__span-17-108"><a id="__codelineno-17-108" name="__codelineno-17-108" href="#__codelineno-17-108"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-17-109"><a id="__codelineno-17-109" name="__codelineno-17-109" href="#__codelineno-17-109"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-110"><a id="__codelineno-17-110" name="__codelineno-17-110" href="#__codelineno-17-110"></a><span class="p">}</span>
</span><span id="__span-17-111"><a id="__codelineno-17-111" name="__codelineno-17-111" href="#__codelineno-17-111"></a>
</span><span id="__span-17-112"><a id="__codelineno-17-112" name="__codelineno-17-112" href="#__codelineno-17-112"></a><span class="kt">void</span><span class="w"> </span><span class="nf">app_main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span id="__span-17-113"><a id="__codelineno-17-113" name="__codelineno-17-113" href="#__codelineno-17-113"></a><span class="p">{</span>
</span><span id="__span-17-114"><a id="__codelineno-17-114" name="__codelineno-17-114" href="#__codelineno-17-114"></a><span class="w">    </span><span class="c1">//---------------- Preparation Phase -------------------</span>
</span><span id="__span-17-115"><a id="__codelineno-17-115" name="__codelineno-17-115" href="#__codelineno-17-115"></a><span class="w">    </span><span class="c1">// Initialize NVS</span>
</span><span id="__span-17-116"><a id="__codelineno-17-116" name="__codelineno-17-116" href="#__codelineno-17-116"></a><span class="w">    </span><span class="n">esp_err_t</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvs_flash_init</span><span class="p">();</span>
</span><span id="__span-17-117"><a id="__codelineno-17-117" name="__codelineno-17-117" href="#__codelineno-17-117"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_ERR_NVS_NO_FREE_PAGES</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ESP_ERR_NVS_NEW_VERSION_FOUND</span><span class="p">)</span>
</span><span id="__span-17-118"><a id="__codelineno-17-118" name="__codelineno-17-118" href="#__codelineno-17-118"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-17-119"><a id="__codelineno-17-119" name="__codelineno-17-119" href="#__codelineno-17-119"></a><span class="w">        </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">nvs_flash_erase</span><span class="p">());</span>
</span><span id="__span-17-120"><a id="__codelineno-17-120" name="__codelineno-17-120" href="#__codelineno-17-120"></a><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvs_flash_init</span><span class="p">();</span>
</span><span id="__span-17-121"><a id="__codelineno-17-121" name="__codelineno-17-121" href="#__codelineno-17-121"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-122"><a id="__codelineno-17-122" name="__codelineno-17-122" href="#__codelineno-17-122"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
</span><span id="__span-17-123"><a id="__codelineno-17-123" name="__codelineno-17-123" href="#__codelineno-17-123"></a>
</span><span id="__span-17-124"><a id="__codelineno-17-124" name="__codelineno-17-124" href="#__codelineno-17-124"></a><span class="w">    </span><span class="c1">//---------------- Initialization Phase -------------------</span>
</span><span id="__span-17-125"><a id="__codelineno-17-125" name="__codelineno-17-125" href="#__codelineno-17-125"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_netif_init</span><span class="p">());</span>
</span><span id="__span-17-126"><a id="__codelineno-17-126" name="__codelineno-17-126" href="#__codelineno-17-126"></a>
</span><span id="__span-17-127"><a id="__codelineno-17-127" name="__codelineno-17-127" href="#__codelineno-17-127"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_event_loop_create_default</span><span class="p">());</span>
</span><span id="__span-17-128"><a id="__codelineno-17-128" name="__codelineno-17-128" href="#__codelineno-17-128"></a>
</span><span id="__span-17-129"><a id="__codelineno-17-129" name="__codelineno-17-129" href="#__codelineno-17-129"></a><span class="w">    </span><span class="c1">// Initialize WiFi device (allocates resources for the WiFi driver, such as control structures, RX/TX buffers, and NVS structures. This also starts the WiFi task. This API must be called before any other WiFi API)</span>
</span><span id="__span-17-130"><a id="__codelineno-17-130" name="__codelineno-17-130" href="#__codelineno-17-130"></a><span class="w">    </span><span class="n">esp_netif_t</span><span class="w"> </span><span class="o">*</span><span class="n">sta_netif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_netif_create_default_wifi_sta</span><span class="p">();</span>
</span><span id="__span-17-131"><a id="__codelineno-17-131" name="__codelineno-17-131" href="#__codelineno-17-131"></a><span class="w">    </span><span class="n">assert</span><span class="p">(</span><span class="n">sta_netif</span><span class="p">);</span>
</span><span id="__span-17-132"><a id="__codelineno-17-132" name="__codelineno-17-132" href="#__codelineno-17-132"></a>
</span><span id="__span-17-133"><a id="__codelineno-17-133" name="__codelineno-17-133" href="#__codelineno-17-133"></a><span class="w">    </span><span class="cm">/* Initialize WiFi */</span>
</span><span id="__span-17-134"><a id="__codelineno-17-134" name="__codelineno-17-134" href="#__codelineno-17-134"></a><span class="w">    </span><span class="n">wifi_init_config_t</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WIFI_INIT_CONFIG_DEFAULT</span><span class="p">();</span>
</span><span id="__span-17-135"><a id="__codelineno-17-135" name="__codelineno-17-135" href="#__codelineno-17-135"></a><span class="w">    </span><span class="c1">// WIFI_INIT_CONFIG_DEFAULT is a macro for the default configuration</span>
</span><span id="__span-17-136"><a id="__codelineno-17-136" name="__codelineno-17-136" href="#__codelineno-17-136"></a>
</span><span id="__span-17-137"><a id="__codelineno-17-137" name="__codelineno-17-137" href="#__codelineno-17-137"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cfg</span><span class="p">));</span>
</span><span id="__span-17-138"><a id="__codelineno-17-138" name="__codelineno-17-138" href="#__codelineno-17-138"></a>
</span><span id="__span-17-139"><a id="__codelineno-17-139" name="__codelineno-17-139" href="#__codelineno-17-139"></a><span class="w">    </span><span class="c1">//---------------- Configuration Phase -------------------</span>
</span><span id="__span-17-140"><a id="__codelineno-17-140" name="__codelineno-17-140" href="#__codelineno-17-140"></a><span class="w">    </span><span class="c1">// Set to STA mode</span>
</span><span id="__span-17-141"><a id="__codelineno-17-141" name="__codelineno-17-141" href="#__codelineno-17-141"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_set_mode</span><span class="p">(</span><span class="n">WIFI_MODE_STA</span><span class="p">));</span>
</span><span id="__span-17-142"><a id="__codelineno-17-142" name="__codelineno-17-142" href="#__codelineno-17-142"></a>
</span><span id="__span-17-143"><a id="__codelineno-17-143" name="__codelineno-17-143" href="#__codelineno-17-143"></a><span class="w">    </span><span class="c1">// Detailed STA configuration</span>
</span><span id="__span-17-144"><a id="__codelineno-17-144" name="__codelineno-17-144" href="#__codelineno-17-144"></a><span class="w">    </span><span class="n">wifi_config_t</span><span class="w"> </span><span class="n">sta_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-145"><a id="__codelineno-17-145" name="__codelineno-17-145" href="#__codelineno-17-145"></a><span class="w">        </span><span class="p">.</span><span class="n">sta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-146"><a id="__codelineno-17-146" name="__codelineno-17-146" href="#__codelineno-17-146"></a><span class="w">            </span><span class="p">.</span><span class="n">ssid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_WIFI_STA_SSID</span><span class="p">,</span>
</span><span id="__span-17-147"><a id="__codelineno-17-147" name="__codelineno-17-147" href="#__codelineno-17-147"></a><span class="w">            </span><span class="p">.</span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESP_WIFI_STA_PASSWD</span><span class="p">,</span>
</span><span id="__span-17-148"><a id="__codelineno-17-148" name="__codelineno-17-148" href="#__codelineno-17-148"></a><span class="w">            </span><span class="p">.</span><span class="n">bssid_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span>
</span><span id="__span-17-149"><a id="__codelineno-17-149" name="__codelineno-17-149" href="#__codelineno-17-149"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-17-150"><a id="__codelineno-17-150" name="__codelineno-17-150" href="#__codelineno-17-150"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-17-151"><a id="__codelineno-17-151" name="__codelineno-17-151" href="#__codelineno-17-151"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_set_config</span><span class="p">(</span><span class="n">WIFI_IF_STA</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sta_config</span><span class="p">));</span>
</span><span id="__span-17-152"><a id="__codelineno-17-152" name="__codelineno-17-152" href="#__codelineno-17-152"></a>
</span><span id="__span-17-153"><a id="__codelineno-17-153" name="__codelineno-17-153" href="#__codelineno-17-153"></a><span class="w">    </span><span class="c1">//---------------- Startup Phase -------------------</span>
</span><span id="__span-17-154"><a id="__codelineno-17-154" name="__codelineno-17-154" href="#__codelineno-17-154"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_start</span><span class="p">());</span>
</span><span id="__span-17-155"><a id="__codelineno-17-155" name="__codelineno-17-155" href="#__codelineno-17-155"></a>
</span><span id="__span-17-156"><a id="__codelineno-17-156" name="__codelineno-17-156" href="#__codelineno-17-156"></a><span class="w">    </span><span class="c1">//---------------- Configure Power Saving Mode -------------------</span>
</span><span id="__span-17-157"><a id="__codelineno-17-157" name="__codelineno-17-157" href="#__codelineno-17-157"></a><span class="w">    </span><span class="c1">// No power saving (data transmission will be faster)</span>
</span><span id="__span-17-158"><a id="__codelineno-17-158" name="__codelineno-17-158" href="#__codelineno-17-158"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_set_ps</span><span class="p">(</span><span class="n">WIFI_PS_NONE</span><span class="p">));</span>
</span><span id="__span-17-159"><a id="__codelineno-17-159" name="__codelineno-17-159" href="#__codelineno-17-159"></a>
</span><span id="__span-17-160"><a id="__codelineno-17-160" name="__codelineno-17-160" href="#__codelineno-17-160"></a><span class="w">    </span><span class="c1">//---------------- WIFI Scan -------------------</span>
</span><span id="__span-17-161"><a id="__codelineno-17-161" name="__codelineno-17-161" href="#__codelineno-17-161"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DEFAULT_SCAN_LIST_SIZE</span><span class="p">;</span>
</span><span id="__span-17-162"><a id="__codelineno-17-162" name="__codelineno-17-162" href="#__codelineno-17-162"></a><span class="w">    </span><span class="n">wifi_ap_record_t</span><span class="w"> </span><span class="n">ap_info</span><span class="p">[</span><span class="n">DEFAULT_SCAN_LIST_SIZE</span><span class="p">];</span>
</span><span id="__span-17-163"><a id="__codelineno-17-163" name="__codelineno-17-163" href="#__codelineno-17-163"></a><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">ap_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-17-164"><a id="__codelineno-17-164" name="__codelineno-17-164" href="#__codelineno-17-164"></a><span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">ap_info</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">ap_info</span><span class="p">));</span>
</span><span id="__span-17-165"><a id="__codelineno-17-165" name="__codelineno-17-165" href="#__codelineno-17-165"></a><span class="w">    </span><span class="c1">// Scan all available APs in blocking mode</span>
</span><span id="__span-17-166"><a id="__codelineno-17-166" name="__codelineno-17-166" href="#__codelineno-17-166"></a><span class="w">    </span><span class="n">esp_wifi_scan_start</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
</span><span id="__span-17-167"><a id="__codelineno-17-167" name="__codelineno-17-167" href="#__codelineno-17-167"></a><span class="w">    </span><span class="c1">// Get the list of APs found in the last scan</span>
</span><span id="__span-17-168"><a id="__codelineno-17-168" name="__codelineno-17-168" href="#__codelineno-17-168"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_scan_get_ap_records</span><span class="p">(</span><span class="o">&amp;</span><span class="n">number</span><span class="p">,</span><span class="w"> </span><span class="n">ap_info</span><span class="p">));</span>
</span><span id="__span-17-169"><a id="__codelineno-17-169" name="__codelineno-17-169" href="#__codelineno-17-169"></a><span class="w">    </span><span class="c1">// Get the number of APs found in the last scan</span>
</span><span id="__span-17-170"><a id="__codelineno-17-170" name="__codelineno-17-170" href="#__codelineno-17-170"></a><span class="w">    </span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">esp_wifi_scan_get_ap_num</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ap_count</span><span class="p">));</span>
</span><span id="__span-17-171"><a id="__codelineno-17-171" name="__codelineno-17-171" href="#__codelineno-17-171"></a><span class="w">    </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Total APs scanned = %u&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ap_count</span><span class="p">);</span>
</span><span id="__span-17-172"><a id="__codelineno-17-172" name="__codelineno-17-172" href="#__codelineno-17-172"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">DEFAULT_SCAN_LIST_SIZE</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ap_count</span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-17-173"><a id="__codelineno-17-173" name="__codelineno-17-173" href="#__codelineno-17-173"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-17-174"><a id="__codelineno-17-174" name="__codelineno-17-174" href="#__codelineno-17-174"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SSID </span><span class="se">\t\t</span><span class="s">%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ap_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ssid</span><span class="p">);</span><span class="w">          </span><span class="c1">// Name</span>
</span><span id="__span-17-175"><a id="__codelineno-17-175" name="__codelineno-17-175" href="#__codelineno-17-175"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RSSI </span><span class="se">\t\t</span><span class="s">%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ap_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rssi</span><span class="p">);</span><span class="w">            </span><span class="c1">// Signal strength</span>
</span><span id="__span-17-176"><a id="__codelineno-17-176" name="__codelineno-17-176" href="#__codelineno-17-176"></a><span class="w">        </span><span class="n">print_auth_mode</span><span class="p">(</span><span class="n">ap_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">authmode</span><span class="p">);</span><span class="w">                     </span><span class="c1">// WiFi encryption mode</span>
</span><span id="__span-17-177"><a id="__codelineno-17-177" name="__codelineno-17-177" href="#__codelineno-17-177"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ap_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">authmode</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">WIFI_AUTH_WEP</span><span class="p">)</span>
</span><span id="__span-17-178"><a id="__codelineno-17-178" name="__codelineno-17-178" href="#__codelineno-17-178"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-17-179"><a id="__codelineno-17-179" name="__codelineno-17-179" href="#__codelineno-17-179"></a><span class="w">            </span><span class="n">print_cipher_type</span><span class="p">(</span><span class="n">ap_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pairwise_cipher</span><span class="p">,</span><span class="w"> </span><span class="n">ap_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">group_cipher</span><span class="p">);</span>
</span><span id="__span-17-180"><a id="__codelineno-17-180" name="__codelineno-17-180" href="#__codelineno-17-180"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-17-181"><a id="__codelineno-17-181" name="__codelineno-17-181" href="#__codelineno-17-181"></a><span class="w">        </span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Channel </span><span class="se">\t\t</span><span class="s">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ap_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">primary</span><span class="p">);</span><span class="w">     </span><span class="c1">// Channel</span>
</span><span id="__span-17-182"><a id="__codelineno-17-182" name="__codelineno-17-182" href="#__codelineno-17-182"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-183"><a id="__codelineno-17-183" name="__codelineno-17-183" href="#__codelineno-17-183"></a><span class="p">}</span>
</span></code></pre></div>

Effect:

![](20240315100518.png) --> <h1 id=reference-links>Reference Links<a class=headerlink href=#reference-links title="Permanent link">&para;</a></h1> <ol> <li><a href="https://www.bilibili.com/video/BV1au411E7K1?p=7&vd_source=ef5a0ab0106372751602034cdd9ab98e">https://www.bilibili.com/video/BV1au411E7K1?p=7&amp;vd_source=ef5a0ab0106372751602034cdd9ab98e</a></li> <li><a href="https://www.bilibili.com/video/BV1au411E7K1?p=8&vd_source=ef5a0ab0106372751602034cdd9ab98e">https://www.bilibili.com/video/BV1au411E7K1?p=8&amp;vd_source=ef5a0ab0106372751602034cdd9ab98e</a></li> <li><a href=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-guides/wifi.html>https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-guides/wifi.html</a></li> </ol> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href=... target=_blank rel=noopener>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../../BLUETOOTH/bluetooth/ class="md-footer__link md-footer__link--prev" aria-label="Previous: BLUETOOTH"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 320 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> BLUETOOTH </div> </div> </a> <a href=../../MQTT/mqtt/ class="md-footer__link md-footer__link--next" aria-label="Next: MQTT"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> MQTT </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 320 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 ~ now | 🚀 Shuaiwen Cui (Shaun) </div> </div> <div class=md-social> <a href=http://www.cuishuaiwen.com/ target=_blank rel=noopener title=www.cuishuaiwen.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1v16.2c0 22.1-17.9 40-40 40h-16c-1.1 0-2.2 0-3.3-.1-1.4.1-2.8.1-4.2.1L416 512h-24c-22.1 0-40-17.9-40-40v-88c0-17.7-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32v88c0 22.1-17.9 40-40 40h-55.9c-1.5 0-3-.1-4.5-.2-1.2.1-2.4.2-3.6.2h-16c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9.1-2.8v-69.7h-32c-18 0-32-14-32-32.1 0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7l255.4 224.5c8 7 12 15 11 24"/></svg> </a> <a href=https://github.com/Shuaiwen-Cui target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://www.linkedin.com/in/shaun-shuaiwen-cui/ target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://www.researchgate.net/profile/Shuaiwen-Cui target=_blank rel=noopener title=www.researchgate.net class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 32v448h448V32zm262.2 334.4c-6.6 3-33.2 6-50-14.2-9.2-10.6-25.3-33.3-42.2-63.6-8.9 0-14.7 0-21.4-.6v46.4c0 23.5 6 21.2 25.8 23.9v8.1c-6.9-.3-23.1-.8-35.6-.8-13.1 0-26.1.6-33.6.8v-8.1c15.5-2.9 22-1.3 22-23.9V225c0-22.6-6.4-21-22-23.9V193c25.8 1 53.1-.6 70.9-.6 31.7 0 55.9 14.4 55.9 45.6 0 21.1-16.7 42.2-39.2 47.5 13.6 24.2 30 45.6 42.2 58.9 7.2 7.8 17.2 14.7 27.2 14.7zm22.9-135c-23.3 0-32.2-15.7-32.2-32.2V167c0-12.2 8.8-30.4 34-30.4s30.4 17.9 30.4 17.9l-10.7 7.2s-5.5-12.5-19.7-12.5c-7.9 0-19.7 7.3-19.7 19.7v26.8c0 13.4 6.6 23.3 17.9 23.3 14.1 0 21.5-10.9 21.5-26.8h-17.9v-10.7h30.4c0 20.5 4.7 49.9-34 49.9m-116.5 44.7c-9.4 0-13.6-.3-20-.8v-69.7c6.4-.6 15-.6 22.5-.6 23.3 0 37.2 12.2 37.2 34.5 0 21.9-15 36.6-39.7 36.6"/></svg> </a> <a href=https://orcid.org/0000-0003-4447-6687 target=_blank rel=noopener title=orcid.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M294.75 188.19h-45.92V342h47.47c67.62 0 83.12-51.34 83.12-76.91 0-41.64-26.54-76.9-84.67-76.9M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8m-80.79 360.76h-29.84v-207.5h29.84zm-14.92-231.14a19.57 19.57 0 1 1 19.57-19.57 19.64 19.64 0 0 1-19.57 19.57M300 369h-81V161.26h80.6c76.73 0 110.44 54.83 110.44 103.85C410 318.39 368.38 369 300 369"/></svg> </a> <a href=https://twitter.com/ShuaiwenC target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "header.autohide", "navigation.footer", "navigation.indexes", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.6ce7567c.min.js", "tags": {"Default": "default-tag", "Hardware": "hardware-tag", "Software": "software-tag"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../../assets/javascripts/bundle.83f73b43.min.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>